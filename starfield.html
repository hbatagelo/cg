<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.5 Efeito starfield | MCTA008-17 Computação Gráfica</title>
  <meta name="description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="8.5 Efeito starfield | MCTA008-17 Computação Gráfica" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="github-repo" content="hbatagelo/cgbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.5 Efeito starfield | MCTA008-17 Computação Gráfica" />
  
  <meta name="twitter:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="viewer1.html"/>
<link rel="next" href="referências.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computação Gráfica</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Apresentação</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html"><i class="fa fa-check"></i>Pré-requisitos</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#atividades-práticas"><i class="fa fa-check"></i>Atividades práticas</a></li>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#visualizando-este-site"><i class="fa fa-check"></i>Visualizando este site</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="config.html"><a href="config.html"><i class="fa fa-check"></i><b>1</b> Configuração do ambiente</a>
<ul>
<li class="chapter" data-level="1.1" data-path="linux.html"><a href="linux.html"><i class="fa fa-check"></i><b>1.1</b> Linux</a>
<ul>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#habilitando-o-opengl"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#atualizando-o-gcc"><i class="fa fa-check"></i>Atualizando o GCC</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#instalando-o-emscripten"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="macos.html"><a href="macos.html"><i class="fa fa-check"></i><b>1.2</b> macOS</a>
<ul>
<li class="chapter" data-level="" data-path="macos.html"><a href="macos.html#instalando-o-emscripten-1"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="windows.html"><a href="windows.html"><i class="fa fa-check"></i><b>1.3</b> Windows</a>
<ul>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#habilitando-o-opengl-1"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#instalando-o-emscripten-2"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="vscode.html"><a href="vscode.html"><i class="fa fa-check"></i><b>1.4</b> Visual Studio Code</a></li>
<li class="chapter" data-level="1.5" data-path="abcg.html"><a href="abcg.html"><i class="fa fa-check"></i><b>1.5</b> ABCg</a>
<ul>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#instalação"><i class="fa fa-check"></i>Instalação</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-em-linha-de-comando"><i class="fa fa-check"></i>Compilando em linha de comando</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-no-visual-studio-code"><i class="fa fa-check"></i>Compilando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#depurando-no-visual-studio-code"><i class="fa fa-check"></i>Depurando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-para-webassembly"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introdução</a>
<ul>
<li class="chapter" data-level="2.1" data-path="áreas-correlatas.html"><a href="áreas-correlatas.html"><i class="fa fa-check"></i><b>2.1</b> Áreas correlatas</a></li>
<li class="chapter" data-level="2.2" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html"><i class="fa fa-check"></i><b>2.2</b> Linha do tempo</a>
<ul>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section"><i class="fa fa-check"></i>1950</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-1"><i class="fa fa-check"></i>1960</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-2"><i class="fa fa-check"></i>1970</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-3"><i class="fa fa-check"></i>1980</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-4"><i class="fa fa-check"></i>1990</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-5"><i class="fa fa-check"></i>2000</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-6"><i class="fa fa-check"></i>2010</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-7"><i class="fa fa-check"></i>2020</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="firstapp.html"><a href="firstapp.html"><i class="fa fa-check"></i><b>2.3</b> Primeiro programa</a>
<ul>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#configuração-inicial"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#main.cpp"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.hpp"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.cpp"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#compilando-para-webassembly-1"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphicssystem.html"><a href="graphicssystem.html"><i class="fa fa-check"></i><b>3</b> Sistemas gráficos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vectorxraster.html"><a href="vectorxraster.html"><i class="fa fa-check"></i><b>3.1</b> Vetorial <em>x</em> matricial</a>
<ul>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-vetorial"><i class="fa fa-check"></i>Representação vetorial</a></li>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-matricial"><i class="fa fa-check"></i>Representação matricial</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="es.html"><a href="es.html"><i class="fa fa-check"></i><b>3.2</b> Dispositivos de E/S</a>
<ul>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-entrada"><i class="fa fa-check"></i>Dispositivos de entrada</a></li>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-saída"><i class="fa fa-check"></i>Dispositivos de saída</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="framebuffer.html"><a href="framebuffer.html"><i class="fa fa-check"></i><b>3.3</b> Framebuffer</a>
<ul>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#screen-tearing"><i class="fa fa-check"></i>Screen tearing</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#vsync"><i class="fa fa-check"></i>Vsync</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#backbuffering"><i class="fa fa-check"></i>Backbuffering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sierpinski.html"><a href="sierpinski.html"><i class="fa fa-check"></i><b>3.4</b> Triângulo de Sierpinski</a>
<ul>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#configuração-inicial-1"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#main.cpp-1"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.hpp-1"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.cpp-1"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>4</b> Pipeline gráfico</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dados-gráficos.html"><a href="dados-gráficos.html"><i class="fa fa-check"></i><b>4.1</b> Dados gráficos</a></li>
<li class="chapter" data-level="4.2" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html"><i class="fa fa-check"></i><b>4.2</b> Ray casting <em>x</em> rasterização</a>
<ul>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#ray-casting"><i class="fa fa-check"></i>Ray casting</a></li>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#rasterização"><i class="fa fa-check"></i>Rasterização</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="glpipeline.html"><a href="glpipeline.html"><i class="fa fa-check"></i><b>4.3</b> Pipeline do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#aplicação"><i class="fa fa-check"></i>Aplicação</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#vertex-shader"><i class="fa fa-check"></i>Vertex shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#montagem-de-primitivas"><i class="fa fa-check"></i>Montagem de primitivas</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#recorte"><i class="fa fa-check"></i>Recorte</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#rasterização-1"><i class="fa fa-check"></i>Rasterização</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#fragment-shader"><i class="fa fa-check"></i>Fragment shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#operações-de-fragmentos"><i class="fa fa-check"></i>Operações de fragmentos</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="coloredtriangles.html"><a href="coloredtriangles.html"><i class="fa fa-check"></i><b>4.4</b> Triângulos coloridos</a>
<ul>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#configuração-inicial-2"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#main.cpp-2"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.hpp-2"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.cpp-2"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="game.html"><a href="game.html"><i class="fa fa-check"></i><b>5</b> Desenvolvendo um jogo 2D</a>
<ul>
<li class="chapter" data-level="5.1" data-path="regularpolygons.html"><a href="regularpolygons.html"><i class="fa fa-check"></i><b>5.1</b> Polígonos regulares</a>
<ul>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#configuração-inicial-3"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#main.cpp-3"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.hpp-3"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.cpp-3"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="asteroids.html"><a href="asteroids.html"><i class="fa fa-check"></i><b>5.2</b> Asteroids</a>
<ul>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#organização-do-projeto"><i class="fa fa-check"></i>Organização do projeto</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#configuração-inicial-4"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#nave"><i class="fa fa-check"></i>Nave</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#estrelas"><i class="fa fa-check"></i>Estrelas</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#asteroides"><i class="fa fa-check"></i>Asteroides</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#tiros-e-colisões"><i class="fa fa-check"></i>Tiros e colisões</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="geometry.html"><a href="geometry.html"><i class="fa fa-check"></i><b>6</b> Espaços e geometria</a>
<ul>
<li class="chapter" data-level="6.1" data-path="vector.html"><a href="vector.html"><i class="fa fa-check"></i><b>6.1</b> Espaço vetorial</a>
<ul>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#combinação-e-independência-linear"><i class="fa fa-check"></i>Combinação e independência linear</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#dimensão-e-base"><i class="fa fa-check"></i>Dimensão e base</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#vetores-geométricos"><i class="fa fa-check"></i>Vetores geométricos</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="affine.html"><a href="affine.html"><i class="fa fa-check"></i><b>6.2</b> Espaço afim</a>
<ul>
<li class="chapter" data-level="" data-path="affine.html"><a href="affine.html#combinação-afim"><i class="fa fa-check"></i>Combinação afim</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="euclidean.html"><a href="euclidean.html"><i class="fa fa-check"></i><b>6.3</b> Espaço euclidiano</a>
<ul>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#frames"><i class="fa fa-check"></i>Frames</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-escalar"><i class="fa fa-check"></i>Produto escalar</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ortogonalidade"><i class="fa fa-check"></i>Ortogonalidade</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#comprimento-e-distância"><i class="fa fa-check"></i>Comprimento e distância</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#normalização"><i class="fa fa-check"></i>Normalização</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ângulo-entre-vetores"><i class="fa fa-check"></i>Ângulo entre vetores</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#projeção-ortogonal"><i class="fa fa-check"></i>Projeção ortogonal</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-vetorial"><i class="fa fa-check"></i>Produto vetorial</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#vetor-normal"><i class="fa fa-check"></i>Vetor normal</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="objmodel.html"><a href="objmodel.html"><i class="fa fa-check"></i><b>6.4</b> Lendo um modelo 3D</a>
<ul>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#orientação-e-face-culling"><i class="fa fa-check"></i>Orientação e face culling</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#configuração-inicial-5"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#main.cpp-5"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.vert"><i class="fa fa-check"></i>loadmodel.vert</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.frag"><i class="fa fa-check"></i>loadmodel.frag</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.hpp-5"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.cpp-5"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>7</b> Matrizes e transformações</a>
<ul>
<li class="chapter" data-level="7.1" data-path="matrix.html"><a href="matrix.html"><i class="fa fa-check"></i><b>7.1</b> Matrizes</a>
<ul>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-transposta"><i class="fa fa-check"></i>Matriz transposta</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-quadrada"><i class="fa fa-check"></i>Matriz quadrada</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-linhacoluna"><i class="fa fa-check"></i>Matriz linha/coluna</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-identidade"><i class="fa fa-check"></i>Matriz identidade</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#operações"><i class="fa fa-check"></i>Operações</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-inversa"><i class="fa fa-check"></i>Matriz inversa</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-ortogonal"><i class="fa fa-check"></i>Matriz ortogonal</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#propriedades"><i class="fa fa-check"></i>Propriedades</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#transformação"><i class="fa fa-check"></i>Transformação</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="homogeneous.html"><a href="homogeneous.html"><i class="fa fa-check"></i><b>7.2</b> Coordenadas homogêneas</a></li>
<li class="chapter" data-level="7.3" data-path="concat.html"><a href="concat.html"><i class="fa fa-check"></i><b>7.3</b> Concatenação de transformações</a></li>
<li class="chapter" data-level="7.4" data-path="transforms.html"><a href="transforms.html"><i class="fa fa-check"></i><b>7.4</b> Transformações</a>
<ul>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#identidade"><i class="fa fa-check"></i>Identidade</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#translação"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#escala"><i class="fa fa-check"></i>Escala</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#rotação"><i class="fa fa-check"></i>Rotação</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="glspaces.html"><a href="glspaces.html"><i class="fa fa-check"></i><b>7.5</b> Espaços do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-objeto"><i class="fa fa-check"></i>Espaço do objeto</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-mundo"><i class="fa fa-check"></i>Espaço do mundo</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-da-câmera"><i class="fa fa-check"></i>Espaço da câmera</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#concatenação-das-matrizes-de-modelo-e-visão"><i class="fa fa-check"></i>Concatenação das matrizes de modelo e visão</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="lookat.html"><a href="lookat.html"><i class="fa fa-check"></i><b>7.6</b> Câmera LookAt</a>
<ul>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-n"><i class="fa fa-check"></i>Construindo o vetor n</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-u"><i class="fa fa-check"></i>Construindo o vetor u</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-v"><i class="fa fa-check"></i>Construindo o vetor v</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-a-matriz-de-visão"><i class="fa fa-check"></i>Construindo a matriz de visão</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="lookatproject.html"><a href="lookatproject.html"><i class="fa fa-check"></i><b>7.7</b> LookAt na prática</a>
<ul>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#configuração-inicial-6"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#main.cpp-6"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.vert"><i class="fa fa-check"></i>lookat.vert</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.frag"><i class="fa fa-check"></i>lookat.frag</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.hpp"><i class="fa fa-check"></i>camera.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.cpp"><i class="fa fa-check"></i>camera.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.hpp-6"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.cpp-6"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.hpp"><i class="fa fa-check"></i>ground.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.cpp"><i class="fa fa-check"></i>ground.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projections.html"><a href="projections.html"><i class="fa fa-check"></i><b>8</b> Projeções e trackball virtual</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ortho.html"><a href="ortho.html"><i class="fa fa-check"></i><b>8.1</b> Projeção ortográfica</a>
<ul>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#translação-1"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#escala-e-reflexão"><i class="fa fa-check"></i>Escala e reflexão</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#matriz-de-projeção"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="perspective.html"><a href="perspective.html"><i class="fa fa-check"></i><b>8.2</b> Projeção perspectiva</a>
<ul>
<li class="chapter" data-level="" data-path="perspective.html"><a href="perspective.html#matriz-de-projeção-1"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="vtrackball1.html"><a href="vtrackball1.html"><i class="fa fa-check"></i><b>8.3</b> Trackball virtual</a>
<ul>
<li class="chapter" data-level="" data-path="vtrackball1.html"><a href="vtrackball1.html#rotação-em-torno-de-um-eixo-arbitrário"><i class="fa fa-check"></i>Rotação em torno de um eixo arbitrário</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="viewer1.html"><a href="viewer1.html"><i class="fa fa-check"></i><b>8.4</b> Visualizador 3D</a>
<ul>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#configuração-inicial-7"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#main.cpp-7"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.vert"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.frag"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.hpp"><i class="fa fa-check"></i>model.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.cpp"><i class="fa fa-check"></i>model.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.hpp"><i class="fa fa-check"></i>trackball.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.cpp"><i class="fa fa-check"></i>trackball.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.hpp-7"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.cpp-7"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="starfield.html"><a href="starfield.html"><i class="fa fa-check"></i><b>8.5</b> Efeito starfield</a>
<ul>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#configuração-inicial-8"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#main.cpp-8"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.vert-1"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.frag-1"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.hpp-8"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.cpp-8"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li>
<a href="mailto:harlen.batagelo@ufabc.edu.br" target="blank">Harlen Batagelo</a>
<a href="mailto:bruno.marques@ufabc.edu.br" target="blank">Bruno Marques</a>
<br>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCTA008-17 Computação Gráfica</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="starfield" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Efeito starfield</h2>
<p>Nesta seção aplicaremos a transformação de projeção perspectiva para produzir um interessante efeito de “campo estelar” (starfield) formado por cubos giratórios.</p>
<p>A aplicação permitirá alterar o ângulo de abertura do campo de visão, bem como alternar entre projeção perspectiva e projeção ortográfica.</p>
<p>O resultado ficará como a seguir.</p>
<iframe
  src="https://hbatagelo.github.io/abcgapps/starfield/index.html"
  allow="gamepad" frameborder="0" allowfullscreen="true" allowtransparency="true" emscriptenheight="740"
  ></iframe>
<p>Veja como o uso de projeção perspectiva é essencial para produzir o efeito desejado (compare com a projeção ortográfica).</p>
<div id="configuração-inicial-8" class="section level3 unnumbered">
<h3>Configuração inicial</h3>
<ul>
<li><p>No arquivo <code>abcg/examples/CMakeLists.txt</code>, inclua a linha:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb294-1"><a href="starfield.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(starfield)</span></code></pre></div></li>
<li><p>Crie o subdiretório <code>abcg/examples/starfield</code> e o arquivo <code>abcg/examples/starfield/CMakeLists.txt</code> com o seguinte conteúdo:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb295-1"><a href="starfield.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="kw">project</span>(starfield)</span>
<span id="cb295-2"><a href="starfield.html#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="kw">add_executable</span>(<span class="dv">${PROJECT_NAME}</span> main.cpp model.cpp openglwindow.cpp)</span>
<span id="cb295-3"><a href="starfield.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="fu">enable_abcg</span>(<span class="dv">${PROJECT_NAME}</span>)</span></code></pre></div></li>
<li><p>Crie os seguintes arquivos vazios:</p>
<ul>
<li><code>main.cpp</code>;</li>
<li><code>openglwindow.cpp</code> e <code>openglwindow.hpp</code>.</li>
<li><code>trackball.cpp</code> e <code>trackball.hpp</code>.</li>
</ul></li>
<li><p>Copie os arquivos <code>model.cpp</code> e <code>model.hpp</code> do projeto da seção anterior (seção <a href="viewer1.html#viewer1">8.4</a>), pois eles serão utilizados sem modificações.</p></li>
<li><p>Crie o subdiretório <code>abcg/examples/starfield/assets</code> e, dentro dele, crie os arquivos vazios <code>depth.frag</code> e <code>depth.vert</code>. Além disso, copie para este subdiretório o modelo <code>box.obj</code> disponível <a href="https://hbatagelo.github.io/abcgapps/data/objmodels.zip">neste link</a>.</p></li>
</ul>
<p>A estrutura de <code>abcg/examples/starfield</code> ficará assim:</p>
<pre><code>starfield/
│   CMakeLists.txt
│   main.cpp
│   model.hpp
│   model.cpp
│   openglwindow.hpp
│   openglwindow.cpp
│
└───assets/
    │   box.obj
    │   depth.frag    
    └   depth.vert</code></pre>
</div>
<div id="main.cpp-8" class="section level3 unnumbered">
<h3>main.cpp</h3>
<p>O conteúdo é igual ao do projeto anterior. Só mudamos o título da janela:</p>
<div class="sourceCode" id="cb297" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb297-1"><a href="starfield.html#cb297-1"></a><span class="pp">#include </span><span class="im">&lt;fmt/core.h&gt;</span></span>
<span id="cb297-2"><a href="starfield.html#cb297-2"></a></span>
<span id="cb297-3"><a href="starfield.html#cb297-3"></a><span class="pp">#include </span><span class="im">&quot;abcg.hpp&quot;</span></span>
<span id="cb297-4"><a href="starfield.html#cb297-4"></a><span class="pp">#include </span><span class="im">&quot;openglwindow.hpp&quot;</span></span>
<span id="cb297-5"><a href="starfield.html#cb297-5"></a></span>
<span id="cb297-6"><a href="starfield.html#cb297-6"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv) {</span>
<span id="cb297-7"><a href="starfield.html#cb297-7"></a>  <span class="cf">try</span> {</span>
<span id="cb297-8"><a href="starfield.html#cb297-8"></a>    abcg::Application app(argc, argv);</span>
<span id="cb297-9"><a href="starfield.html#cb297-9"></a></span>
<span id="cb297-10"><a href="starfield.html#cb297-10"></a>    <span class="kw">auto</span> window{<span class="bu">std::</span>make_unique&lt;OpenGLWindow&gt;()};</span>
<span id="cb297-11"><a href="starfield.html#cb297-11"></a>    window-&gt;setOpenGLSettings({.samples = <span class="dv">4</span>});</span>
<span id="cb297-12"><a href="starfield.html#cb297-12"></a>    window-&gt;setWindowSettings(</span>
<span id="cb297-13"><a href="starfield.html#cb297-13"></a>        {.width = <span class="dv">600</span>, .height = <span class="dv">600</span>, .title = <span class="st">&quot;Starfield Effect&quot;</span>});</span>
<span id="cb297-14"><a href="starfield.html#cb297-14"></a></span>
<span id="cb297-15"><a href="starfield.html#cb297-15"></a>    app.run(<span class="bu">std::</span>move(window));</span>
<span id="cb297-16"><a href="starfield.html#cb297-16"></a>  } <span class="cf">catch</span> (<span class="at">const</span> abcg::Exception &amp;exception) {</span>
<span id="cb297-17"><a href="starfield.html#cb297-17"></a>    fmt::print(stderr, <span class="st">&quot;</span><span class="sc">{}\n</span><span class="st">&quot;</span>, exception.what());</span>
<span id="cb297-18"><a href="starfield.html#cb297-18"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb297-19"><a href="starfield.html#cb297-19"></a>  }</span>
<span id="cb297-20"><a href="starfield.html#cb297-20"></a>  <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb297-21"><a href="starfield.html#cb297-21"></a>}</span></code></pre></div>
</div>
<div id="depth.vert-1" class="section level3 unnumbered">
<h3>depth.vert</h3>
<p>O vertex shader também é igual ao do projeto anterior. Só precisamos alterar <code>-posEyeSpace.z / 3.0</code> para <code>-posEyeSpace.z / 100.0</code> para que a intensidade da cor seja zero apenas quando <span class="math inline">\(z&lt;-100\)</span> no espaço da câmera.</p>
<div class="sourceCode" id="cb298" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb298-1"><a href="starfield.html#cb298-1"></a><span class="pp">#version 410</span></span>
<span id="cb298-2"><a href="starfield.html#cb298-2"></a></span>
<span id="cb298-3"><a href="starfield.html#cb298-3"></a><span class="kw">layout</span>(<span class="dt">location</span> = <span class="dv">0</span>) <span class="dt">in</span> <span class="dt">vec3</span> inPosition;</span>
<span id="cb298-4"><a href="starfield.html#cb298-4"></a></span>
<span id="cb298-5"><a href="starfield.html#cb298-5"></a><span class="kw">uniform</span> <span class="dt">vec4</span> color;</span>
<span id="cb298-6"><a href="starfield.html#cb298-6"></a><span class="kw">uniform</span> <span class="dt">mat4</span> modelMatrix;</span>
<span id="cb298-7"><a href="starfield.html#cb298-7"></a><span class="kw">uniform</span> <span class="dt">mat4</span> viewMatrix;</span>
<span id="cb298-8"><a href="starfield.html#cb298-8"></a><span class="kw">uniform</span> <span class="dt">mat4</span> projMatrix;</span>
<span id="cb298-9"><a href="starfield.html#cb298-9"></a></span>
<span id="cb298-10"><a href="starfield.html#cb298-10"></a><span class="dt">out</span> <span class="dt">vec4</span> fragColor;</span>
<span id="cb298-11"><a href="starfield.html#cb298-11"></a></span>
<span id="cb298-12"><a href="starfield.html#cb298-12"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb298-13"><a href="starfield.html#cb298-13"></a>  <span class="dt">vec4</span> posEyeSpace = viewMatrix * modelMatrix * <span class="dt">vec4</span>(inPosition, <span class="dv">1</span>);</span>
<span id="cb298-14"><a href="starfield.html#cb298-14"></a></span>
<span id="cb298-15"><a href="starfield.html#cb298-15"></a>  <span class="dt">float</span> i = <span class="fl">1.0</span> - (-posEyeSpace.<span class="fu">z</span> / <span class="fl">100.0</span>);</span>
<span id="cb298-16"><a href="starfield.html#cb298-16"></a>  fragColor = <span class="dt">vec4</span>(i, i, i, <span class="dv">1</span>) * color;</span>
<span id="cb298-17"><a href="starfield.html#cb298-17"></a></span>
<span id="cb298-18"><a href="starfield.html#cb298-18"></a>  <span class="bu">gl_Position</span> = projMatrix * posEyeSpace;</span>
<span id="cb298-19"><a href="starfield.html#cb298-19"></a>}</span></code></pre></div>
</div>
<div id="depth.frag-1" class="section level3 unnumbered">
<h3>depth.frag</h3>
<p>O conteúdo do fragment shader é mais simples que o <code>depth.frag</code> do projeto anterior. A cor recebida no atributo de entrada (<code>fragColor</code>) é enviada sem modificações para o atributo de saída (<code>outColor</code>):</p>
<div class="sourceCode" id="cb299" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb299-1"><a href="starfield.html#cb299-1"></a><span class="pp">#version 410</span></span>
<span id="cb299-2"><a href="starfield.html#cb299-2"></a></span>
<span id="cb299-3"><a href="starfield.html#cb299-3"></a><span class="dt">in</span> <span class="dt">vec4</span> fragColor;</span>
<span id="cb299-4"><a href="starfield.html#cb299-4"></a><span class="dt">out</span> <span class="dt">vec4</span> outColor;</span>
<span id="cb299-5"><a href="starfield.html#cb299-5"></a></span>
<span id="cb299-6"><a href="starfield.html#cb299-6"></a><span class="dt">void</span> <span class="fu">main</span>() { outColor = fragColor; }</span></code></pre></div>
</div>
<div id="openglwindow.hpp-8" class="section level3 unnumbered">
<h3>openglwindow.hpp</h3>
<p>A definição da classe <code>OpenGLWindow</code> ficará assim:</p>
<div class="sourceCode" id="cb300" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb300-1"><a href="starfield.html#cb300-1"></a><span class="pp">#ifndef OPENGLWINDOW_HPP_</span></span>
<span id="cb300-2"><a href="starfield.html#cb300-2"></a><span class="pp">#define OPENGLWINDOW_HPP_</span></span>
<span id="cb300-3"><a href="starfield.html#cb300-3"></a></span>
<span id="cb300-4"><a href="starfield.html#cb300-4"></a><span class="pp">#include </span><span class="im">&lt;random&gt;</span></span>
<span id="cb300-5"><a href="starfield.html#cb300-5"></a></span>
<span id="cb300-6"><a href="starfield.html#cb300-6"></a><span class="pp">#include </span><span class="im">&quot;abcg.hpp&quot;</span></span>
<span id="cb300-7"><a href="starfield.html#cb300-7"></a><span class="pp">#include </span><span class="im">&quot;model.hpp&quot;</span></span>
<span id="cb300-8"><a href="starfield.html#cb300-8"></a></span>
<span id="cb300-9"><a href="starfield.html#cb300-9"></a><span class="kw">class</span> OpenGLWindow : <span class="kw">public</span> abcg::OpenGLWindow {</span>
<span id="cb300-10"><a href="starfield.html#cb300-10"></a> <span class="kw">protected</span>:</span>
<span id="cb300-11"><a href="starfield.html#cb300-11"></a>  <span class="dt">void</span> initializeGL() <span class="kw">override</span>;</span>
<span id="cb300-12"><a href="starfield.html#cb300-12"></a>  <span class="dt">void</span> paintGL() <span class="kw">override</span>;</span>
<span id="cb300-13"><a href="starfield.html#cb300-13"></a>  <span class="dt">void</span> paintUI() <span class="kw">override</span>;</span>
<span id="cb300-14"><a href="starfield.html#cb300-14"></a>  <span class="dt">void</span> resizeGL(<span class="dt">int</span> width, <span class="dt">int</span> height) <span class="kw">override</span>;</span>
<span id="cb300-15"><a href="starfield.html#cb300-15"></a>  <span class="dt">void</span> terminateGL() <span class="kw">override</span>;</span>
<span id="cb300-16"><a href="starfield.html#cb300-16"></a></span>
<span id="cb300-17"><a href="starfield.html#cb300-17"></a> <span class="kw">private</span>:</span>
<span id="cb300-18"><a href="starfield.html#cb300-18"></a>  <span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> <span class="va">m_numStars</span>{<span class="dv">500</span>};</span>
<span id="cb300-19"><a href="starfield.html#cb300-19"></a></span>
<span id="cb300-20"><a href="starfield.html#cb300-20"></a>  GLuint <span class="va">m_program</span>{};</span>
<span id="cb300-21"><a href="starfield.html#cb300-21"></a></span>
<span id="cb300-22"><a href="starfield.html#cb300-22"></a>  <span class="dt">int</span> <span class="va">m_viewportWidth</span>{};</span>
<span id="cb300-23"><a href="starfield.html#cb300-23"></a>  <span class="dt">int</span> <span class="va">m_viewportHeight</span>{};</span>
<span id="cb300-24"><a href="starfield.html#cb300-24"></a></span>
<span id="cb300-25"><a href="starfield.html#cb300-25"></a>  <span class="bu">std::</span>default_random_engine <span class="va">m_randomEngine</span>;</span>
<span id="cb300-26"><a href="starfield.html#cb300-26"></a></span>
<span id="cb300-27"><a href="starfield.html#cb300-27"></a>  Model <span class="va">m_model</span>;</span>
<span id="cb300-28"><a href="starfield.html#cb300-28"></a></span>
<span id="cb300-29"><a href="starfield.html#cb300-29"></a>  <span class="bu">std::</span>array&lt;glm::vec3, <span class="va">m_numStars</span>&gt; <span class="va">m_starPositions</span>;</span>
<span id="cb300-30"><a href="starfield.html#cb300-30"></a>  <span class="bu">std::</span>array&lt;glm::vec3, <span class="va">m_numStars</span>&gt; <span class="va">m_starRotations</span>;</span>
<span id="cb300-31"><a href="starfield.html#cb300-31"></a>  <span class="dt">float</span> <span class="va">m_angle</span>{};</span>
<span id="cb300-32"><a href="starfield.html#cb300-32"></a></span>
<span id="cb300-33"><a href="starfield.html#cb300-33"></a>  glm::mat4 <span class="va">m_viewMatrix</span>{<span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb300-34"><a href="starfield.html#cb300-34"></a>  glm::mat4 <span class="va">m_projMatrix</span>{<span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb300-35"><a href="starfield.html#cb300-35"></a>  <span class="dt">float</span> <span class="va">m_FOV</span>{<span class="fl">30.0</span><span class="bu">f</span>};</span>
<span id="cb300-36"><a href="starfield.html#cb300-36"></a></span>
<span id="cb300-37"><a href="starfield.html#cb300-37"></a>  <span class="dt">void</span> randomizeStar(glm::vec3 &amp;position, glm::vec3 &amp;rotation);</span>
<span id="cb300-38"><a href="starfield.html#cb300-38"></a>  <span class="dt">void</span> update();</span>
<span id="cb300-39"><a href="starfield.html#cb300-39"></a>};</span>
<span id="cb300-40"><a href="starfield.html#cb300-40"></a></span>
<span id="cb300-41"><a href="starfield.html#cb300-41"></a><span class="pp">#endif</span></span></code></pre></div>
<p>O objeto <code>m_model</code>, definido na linha 27, é utilizado para armazenar o VBO/EBO e VAO que representa a estrela do campo estrelado. No nosso caso, a estrela será um cubo centralizado na origem, definido pelo arquivo <code>box.obj</code>. A cena 3D será formada por 500 instâncias do cubo. Esse número é definido pela constante <code>m_numStars</code> na linha 18.</p>
<p>Nas linhas 29 e 30 são definidos arranjos de 500 posições aleatórias (<code>m_starPositions</code>) e 500 eixos aleatórios de rotação (<code>m_starRotations</code>), um para cada cubo da cena. Através desses atributos podemos criar uma matriz de modelo para cada cubo. Cada matriz de modelo será definida como uma concatenação</p>
<p><span class="math display">\[
\mathbf{M}_{\textrm{model}}=\mathbf{T}\mathbf{S}\mathbf{R},
\]</span></p>
<p>onde <span class="math inline">\(\mathbf{R}\)</span> é uma rotação que faz o cubo centralizado na origem girar em torno de um eixo especificado em <code>m_starRotations</code>, <span class="math inline">\(\mathbf{S}\)</span> é um fator de escala uniforme (usaremos <span class="math inline">\(s=0.2\)</span> para todos os cubos) e <span class="math inline">\(\mathbf{T}\)</span> é a translação que faz com que o cubo rotacionado seja posicionado no espaço do mundo na posição indicada em <code>m_starPositions</code>.</p>
<p>Na linha 31, <code>m_angle</code> é um ângulo de rotação em radianos que será utilizado para rodar cada cubo por seu respectivo eixo de rotação (os cubos rodam pelo mesmo ângulo, mas cada um tem seu próprio eixo aleatório de rotação).</p>
<p>Nas linhas 33 e 34 são definidas as matrizes de visão (<code>m_viewMatrix</code>) e de projeção (<code>m_projMatrix</code>). Aqui elas estão como matrizes identidade, mas serão definidas posteriormente em <code>OpenGLWindow::initializeGL</code> e <code>OpenGLWindow::paintUI</code>.</p>
<p>Na linha 35, o atributo <code>m_FOV</code> é o ângulo de abertura vertical do campo de visão da projeção perspectiva. Esse valor poderá ser controlado por um slider da ImGui, variando de <span class="math inline">\(5^\circ\)</span> a <span class="math inline">\(179^\circ\)</span>.</p>
<p>A função <code>OpenGLWindow::randomizeStar</code> (linha 37) usa o gerador de números pseudoaleatórios <code>m_randomEngine</code> (linha 25) para sortear uma posição e eixo de rotação. O resultado é armazenado nos parâmetros <code>position</code> e <code>rotation</code> passados por referência.</p>
</div>
<div id="openglwindow.cpp-8" class="section level3 unnumbered">
<h3>openglwindow.cpp</h3>
<p>O arquivo <code>openglwindow.cpp</code> começa com a definição de <code>OpenGLWindow::initializeGL</code>:</p>
<div class="sourceCode" id="cb301" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb301-1"><a href="starfield.html#cb301-1"></a><span class="pp">#include </span><span class="im">&quot;openglwindow.hpp&quot;</span></span>
<span id="cb301-2"><a href="starfield.html#cb301-2"></a></span>
<span id="cb301-3"><a href="starfield.html#cb301-3"></a><span class="pp">#include </span><span class="im">&lt;imgui.h&gt;</span></span>
<span id="cb301-4"><a href="starfield.html#cb301-4"></a></span>
<span id="cb301-5"><a href="starfield.html#cb301-5"></a><span class="pp">#include </span><span class="im">&lt;cppitertools/itertools.hpp&gt;</span></span>
<span id="cb301-6"><a href="starfield.html#cb301-6"></a><span class="pp">#include </span><span class="im">&lt;glm/gtx/fast_trigonometry.hpp&gt;</span></span>
<span id="cb301-7"><a href="starfield.html#cb301-7"></a></span>
<span id="cb301-8"><a href="starfield.html#cb301-8"></a><span class="dt">void</span> OpenGLWindow::initializeGL() {</span>
<span id="cb301-9"><a href="starfield.html#cb301-9"></a>  abcg::glClearColor(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb301-10"><a href="starfield.html#cb301-10"></a></span>
<span id="cb301-11"><a href="starfield.html#cb301-11"></a>  <span class="co">// Enable depth buffering</span></span>
<span id="cb301-12"><a href="starfield.html#cb301-12"></a>  abcg::glEnable(GL_DEPTH_TEST);</span>
<span id="cb301-13"><a href="starfield.html#cb301-13"></a></span>
<span id="cb301-14"><a href="starfield.html#cb301-14"></a>  <span class="co">// Create program</span></span>
<span id="cb301-15"><a href="starfield.html#cb301-15"></a>  <span class="va">m_program</span> = createProgramFromFile(getAssetsPath() + <span class="st">&quot;depth.vert&quot;</span>,</span>
<span id="cb301-16"><a href="starfield.html#cb301-16"></a>                                    getAssetsPath() + <span class="st">&quot;depth.frag&quot;</span>);</span>
<span id="cb301-17"><a href="starfield.html#cb301-17"></a></span>
<span id="cb301-18"><a href="starfield.html#cb301-18"></a>  <span class="co">// Load model</span></span>
<span id="cb301-19"><a href="starfield.html#cb301-19"></a>  <span class="va">m_model</span>.loadObj(getAssetsPath() + <span class="st">&quot;box.obj&quot;</span>);</span>
<span id="cb301-20"><a href="starfield.html#cb301-20"></a></span>
<span id="cb301-21"><a href="starfield.html#cb301-21"></a>  <span class="va">m_model</span>.setupVAO(<span class="va">m_program</span>);</span>
<span id="cb301-22"><a href="starfield.html#cb301-22"></a></span>
<span id="cb301-23"><a href="starfield.html#cb301-23"></a>  <span class="co">// Camera at (0,0,0) and looking towards the negative z</span></span>
<span id="cb301-24"><a href="starfield.html#cb301-24"></a>  <span class="va">m_viewMatrix</span> =</span>
<span id="cb301-25"><a href="starfield.html#cb301-25"></a>      glm::lookAt(glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>), glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>, -<span class="fl">1.0</span><span class="bu">f</span>),</span>
<span id="cb301-26"><a href="starfield.html#cb301-26"></a>                  glm::vec3(<span class="fl">0.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>));</span>
<span id="cb301-27"><a href="starfield.html#cb301-27"></a></span>
<span id="cb301-28"><a href="starfield.html#cb301-28"></a>  <span class="co">// Setup stars</span></span>
<span id="cb301-29"><a href="starfield.html#cb301-29"></a>  <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span> index : iter::range(<span class="va">m_numStars</span>)) {</span>
<span id="cb301-30"><a href="starfield.html#cb301-30"></a>    <span class="kw">auto</span> &amp;position{<span class="va">m_starPositions</span>.at(index)};</span>
<span id="cb301-31"><a href="starfield.html#cb301-31"></a>    <span class="kw">auto</span> &amp;rotation{<span class="va">m_starRotations</span>.at(index)};</span>
<span id="cb301-32"><a href="starfield.html#cb301-32"></a></span>
<span id="cb301-33"><a href="starfield.html#cb301-33"></a>    randomizeStar(position, rotation);</span>
<span id="cb301-34"><a href="starfield.html#cb301-34"></a>  }</span>
<span id="cb301-35"><a href="starfield.html#cb301-35"></a>}</span></code></pre></div>
<p>Nas linhas 24 a 26 é definida a matriz de visão como uma câmera LookAt que está na origem do espaço do mundo e está olhando na direção do eixo <span class="math inline">\(z\)</span> negativo. Durante a execução, a câmera permanecerá fixa nessa posição e orientação. As estrelas (cubos) é que mudarão de posição para produzir o efeito de animação.</p>
<p>O laço das linhas 29 a 34 itera sobre cada elemento do arranjo <code>m_starPositions</code> e <code>m_starRotations</code>, e chama <code>OpenGLWindow::randomizeStar</code> para sortear uma posição inicial e eixo de rotação inicial para cada estrela.</p>
<p>A definição de <code>OpenGLWindow::randomizeStar</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb302" startFrom="37"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 36;"><span id="cb302-37"><a href="starfield.html#cb302-37"></a><span class="dt">void</span> OpenGLWindow::randomizeStar(glm::vec3 &amp;position, glm::vec3 &amp;rotation) {</span>
<span id="cb302-38"><a href="starfield.html#cb302-38"></a>  <span class="co">// Get random position</span></span>
<span id="cb302-39"><a href="starfield.html#cb302-39"></a>  <span class="co">// x and y coordinates in the range [-20, 20]</span></span>
<span id="cb302-40"><a href="starfield.html#cb302-40"></a>  <span class="co">// z coordinates in the range [-100, 0]</span></span>
<span id="cb302-41"><a href="starfield.html#cb302-41"></a>  <span class="bu">std::</span>uniform_real_distribution&lt;<span class="dt">float</span>&gt; distPosXY(-<span class="fl">20.0</span><span class="bu">f</span>, <span class="fl">20.0</span><span class="bu">f</span>);</span>
<span id="cb302-42"><a href="starfield.html#cb302-42"></a>  <span class="bu">std::</span>uniform_real_distribution&lt;<span class="dt">float</span>&gt; distPosZ(-<span class="fl">100.0</span><span class="bu">f</span>, <span class="fl">0.0</span><span class="bu">f</span>);</span>
<span id="cb302-43"><a href="starfield.html#cb302-43"></a></span>
<span id="cb302-44"><a href="starfield.html#cb302-44"></a>  position = glm::vec3(distPosXY(<span class="va">m_randomEngine</span>), distPosXY(<span class="va">m_randomEngine</span>),</span>
<span id="cb302-45"><a href="starfield.html#cb302-45"></a>                       distPosZ(<span class="va">m_randomEngine</span>));</span>
<span id="cb302-46"><a href="starfield.html#cb302-46"></a></span>
<span id="cb302-47"><a href="starfield.html#cb302-47"></a>  <span class="co">//  Get random rotation axis</span></span>
<span id="cb302-48"><a href="starfield.html#cb302-48"></a>  <span class="bu">std::</span>uniform_real_distribution&lt;<span class="dt">float</span>&gt; distRotAxis(-<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);</span>
<span id="cb302-49"><a href="starfield.html#cb302-49"></a></span>
<span id="cb302-50"><a href="starfield.html#cb302-50"></a>  rotation = glm::normalize(glm::vec3(distRotAxis(<span class="va">m_randomEngine</span>),</span>
<span id="cb302-51"><a href="starfield.html#cb302-51"></a>                                      distRotAxis(<span class="va">m_randomEngine</span>),</span>
<span id="cb302-52"><a href="starfield.html#cb302-52"></a>                                      distRotAxis(<span class="va">m_randomEngine</span>)));</span>
<span id="cb302-53"><a href="starfield.html#cb302-53"></a>}</span></code></pre></div>
<p>Para a escolha da posição aleatória <span class="math inline">\((x,y,z)\)</span>:</p>
<ul>
<li>As coordenadas <span class="math inline">\(x\)</span> e <span class="math inline">\(y\)</span> são escolhidas do intervalo <span class="math inline">\([-20, 20]\)</span>;</li>
<li>A coordenada <span class="math inline">\(z\)</span> é escolhida do intervalo <span class="math inline">\([-100, 0]\)</span>.</li>
</ul>
<p>Assim, o campo estrelado é a região cuboide que vai de <span class="math inline">\((-20,-20,-100)\)</span> a <span class="math inline">\((20,20,0)\)</span>. Lembre-se que a câmera está em <span class="math inline">\(z=0\)</span>, olhando para <span class="math inline">\(z\)</span> negativo. Logo, a câmera pode enxergar potencialmente toda essa região, a depender das configurações de projeção.</p>
<p>Para a escolha do eixo de rotação aleatório, criamos um vetor com coordenadas aleatórias do intervalo <span class="math inline">\([-1,1]\)</span> em ponto flutuante e então normalizamos o vetor.</p>
<p>Vamos agora à definição de <code>OpenGLWindow::paintGL</code>:</p>
<div class="sourceCode" id="cb303" startFrom="55"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 54;"><span id="cb303-55"><a href="starfield.html#cb303-55"></a><span class="dt">void</span> OpenGLWindow::paintGL() {</span>
<span id="cb303-56"><a href="starfield.html#cb303-56"></a>  update();</span>
<span id="cb303-57"><a href="starfield.html#cb303-57"></a></span>
<span id="cb303-58"><a href="starfield.html#cb303-58"></a>  <span class="co">// Clear color buffer and depth buffer</span></span>
<span id="cb303-59"><a href="starfield.html#cb303-59"></a>  abcg::glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span>
<span id="cb303-60"><a href="starfield.html#cb303-60"></a></span>
<span id="cb303-61"><a href="starfield.html#cb303-61"></a>  abcg::glViewport(<span class="dv">0</span>, <span class="dv">0</span>, <span class="va">m_viewportWidth</span>, <span class="va">m_viewportHeight</span>);</span>
<span id="cb303-62"><a href="starfield.html#cb303-62"></a></span>
<span id="cb303-63"><a href="starfield.html#cb303-63"></a>  abcg::glUseProgram(<span class="va">m_program</span>);</span>
<span id="cb303-64"><a href="starfield.html#cb303-64"></a></span>
<span id="cb303-65"><a href="starfield.html#cb303-65"></a>  <span class="co">// Get location of uniform variables (could be precomputed)</span></span>
<span id="cb303-66"><a href="starfield.html#cb303-66"></a>  GLint viewMatrixLoc{abcg::glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;viewMatrix&quot;</span>)};</span>
<span id="cb303-67"><a href="starfield.html#cb303-67"></a>  GLint projMatrixLoc{abcg::glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;projMatrix&quot;</span>)};</span>
<span id="cb303-68"><a href="starfield.html#cb303-68"></a>  GLint modelMatrixLoc{abcg::glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;modelMatrix&quot;</span>)};</span>
<span id="cb303-69"><a href="starfield.html#cb303-69"></a>  GLint colorLoc{abcg::glGetUniformLocation(<span class="va">m_program</span>, <span class="st">&quot;color&quot;</span>)};</span>
<span id="cb303-70"><a href="starfield.html#cb303-70"></a></span>
<span id="cb303-71"><a href="starfield.html#cb303-71"></a>  <span class="co">// Set uniform variables used by every scene object</span></span>
<span id="cb303-72"><a href="starfield.html#cb303-72"></a>  abcg::glUniformMatrix4fv(viewMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_viewMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb303-73"><a href="starfield.html#cb303-73"></a>  abcg::glUniformMatrix4fv(projMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_projMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb303-74"><a href="starfield.html#cb303-74"></a>  abcg::glUniform4f(colorLoc, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>);  <span class="co">// White</span></span>
<span id="cb303-75"><a href="starfield.html#cb303-75"></a></span>
<span id="cb303-76"><a href="starfield.html#cb303-76"></a>  <span class="co">// Render each star</span></span>
<span id="cb303-77"><a href="starfield.html#cb303-77"></a>  <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span> index : iter::range(<span class="va">m_numStars</span>)) {</span>
<span id="cb303-78"><a href="starfield.html#cb303-78"></a>    <span class="at">const</span> <span class="kw">auto</span> &amp;position{<span class="va">m_starPositions</span>.at(index)};</span>
<span id="cb303-79"><a href="starfield.html#cb303-79"></a>    <span class="at">const</span> <span class="kw">auto</span> &amp;rotation{<span class="va">m_starRotations</span>.at(index)};</span>
<span id="cb303-80"><a href="starfield.html#cb303-80"></a></span>
<span id="cb303-81"><a href="starfield.html#cb303-81"></a>    <span class="co">// Compute model matrix of the current star</span></span>
<span id="cb303-82"><a href="starfield.html#cb303-82"></a>    glm::mat4 modelMatrix{<span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb303-83"><a href="starfield.html#cb303-83"></a>    modelMatrix = glm::translate(modelMatrix, position);</span>
<span id="cb303-84"><a href="starfield.html#cb303-84"></a>    modelMatrix = glm::scale(modelMatrix, glm::vec3(<span class="fl">0.2</span><span class="bu">f</span>));</span>
<span id="cb303-85"><a href="starfield.html#cb303-85"></a>    modelMatrix = glm::rotate(modelMatrix, <span class="va">m_angle</span>, rotation);</span>
<span id="cb303-86"><a href="starfield.html#cb303-86"></a></span>
<span id="cb303-87"><a href="starfield.html#cb303-87"></a>    <span class="co">// Set uniform variable</span></span>
<span id="cb303-88"><a href="starfield.html#cb303-88"></a>    abcg::glUniformMatrix4fv(modelMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;modelMatrix[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb303-89"><a href="starfield.html#cb303-89"></a></span>
<span id="cb303-90"><a href="starfield.html#cb303-90"></a>    <span class="va">m_model</span>.render();</span>
<span id="cb303-91"><a href="starfield.html#cb303-91"></a>  }</span>
<span id="cb303-92"><a href="starfield.html#cb303-92"></a></span>
<span id="cb303-93"><a href="starfield.html#cb303-93"></a>  glUseProgram(<span class="dv">0</span>);</span>
<span id="cb303-94"><a href="starfield.html#cb303-94"></a>}</span></code></pre></div>
<p>Logo no início, a função <code>OpenGLWindow::update</code> é chamada (linha 56) para atualizar a posição e rotação das estrelas de modo a produzir o efeito de animação.</p>
<p>Nas linhas 72 a 74 são definidos os valores das variáveis uniformes compartilhadas por todas as estrelas. Em particular, todas as estrelas usam a mesma matriz de visão e projeção. Além disso, todas usam a mesma cor (branca).</p>
<p>No laço da linha 77, cada estrela é renderizada. A matriz de modelo é construída nas linhas 81 a 85 usando as informações da estrela em <code>m_starPositions</code> e <code>m_starRotations</code>.</p>
<p>A matriz de modelo é copiada para o vertex shader na linha 88. Em seguida, na linha 90, a função <code>Model::render</code> é chamada para renderizar o objeto que representa a estrela, isto é, o cubo.</p>
<p>É importante observar que, embora o mesmo cubo seja renderizado 500 vezes, cada iteração utiliza uma matriz de modelo diferente. Podemos fazer isso pois todas as estrelas usam a mesma malha de triângulos (8 vértices e 12 triângulos). O que muda é a posição e orientação. Atributos como posição, orientação e escala da malha podem ser modificados no vertex shader por matrizes de transformação, que é o que estamos fazendo.</p>
<p>A definição de <code>OpenGLWindow::paintUI</code> ficará assim:</p>
<div class="sourceCode" id="cb304" startFrom="96"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 95;"><span id="cb304-96"><a href="starfield.html#cb304-96"></a><span class="dt">void</span> OpenGLWindow::paintUI() {</span>
<span id="cb304-97"><a href="starfield.html#cb304-97"></a>  abcg::OpenGLWindow::paintUI();</span>
<span id="cb304-98"><a href="starfield.html#cb304-98"></a></span>
<span id="cb304-99"><a href="starfield.html#cb304-99"></a>  {</span>
<span id="cb304-100"><a href="starfield.html#cb304-100"></a>    <span class="at">const</span> <span class="kw">auto</span> widgetSize{ImVec2(<span class="dv">218</span>, <span class="dv">62</span>)};</span>
<span id="cb304-101"><a href="starfield.html#cb304-101"></a>    ImGui::SetNextWindowPos(ImVec2(<span class="va">m_viewportWidth</span> - widgetSize.x - <span class="dv">5</span>, <span class="dv">5</span>));</span>
<span id="cb304-102"><a href="starfield.html#cb304-102"></a>    ImGui::SetNextWindowSize(widgetSize);</span>
<span id="cb304-103"><a href="starfield.html#cb304-103"></a>    ImGui::Begin(<span class="st">&quot;Widget window&quot;</span>, <span class="kw">nullptr</span>, ImGuiWindowFlags_NoDecoration);</span>
<span id="cb304-104"><a href="starfield.html#cb304-104"></a></span>
<span id="cb304-105"><a href="starfield.html#cb304-105"></a>    {</span>
<span id="cb304-106"><a href="starfield.html#cb304-106"></a>      ImGui::PushItemWidth(<span class="dv">120</span>);</span>
<span id="cb304-107"><a href="starfield.html#cb304-107"></a>      <span class="at">static</span> <span class="bu">std::</span>size_t currentIndex{};</span>
<span id="cb304-108"><a href="starfield.html#cb304-108"></a>      <span class="at">const</span> <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>string&gt; comboItems{<span class="st">&quot;Perspective&quot;</span>, <span class="st">&quot;Orthographic&quot;</span>};</span>
<span id="cb304-109"><a href="starfield.html#cb304-109"></a></span>
<span id="cb304-110"><a href="starfield.html#cb304-110"></a>      <span class="cf">if</span> (ImGui::BeginCombo(<span class="st">&quot;Projection&quot;</span>,</span>
<span id="cb304-111"><a href="starfield.html#cb304-111"></a>                            comboItems.at(currentIndex).c_str())) {</span>
<span id="cb304-112"><a href="starfield.html#cb304-112"></a>        <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span> index : iter::range(comboItems.size())) {</span>
<span id="cb304-113"><a href="starfield.html#cb304-113"></a>          <span class="at">const</span> <span class="dt">bool</span> isSelected{currentIndex == index};</span>
<span id="cb304-114"><a href="starfield.html#cb304-114"></a>          <span class="cf">if</span> (ImGui::Selectable(comboItems.at(index).c_str(), isSelected))</span>
<span id="cb304-115"><a href="starfield.html#cb304-115"></a>            currentIndex = index;</span>
<span id="cb304-116"><a href="starfield.html#cb304-116"></a>          <span class="cf">if</span> (isSelected) ImGui::SetItemDefaultFocus();</span>
<span id="cb304-117"><a href="starfield.html#cb304-117"></a>        }</span>
<span id="cb304-118"><a href="starfield.html#cb304-118"></a>        ImGui::EndCombo();</span>
<span id="cb304-119"><a href="starfield.html#cb304-119"></a>      }</span>
<span id="cb304-120"><a href="starfield.html#cb304-120"></a>      ImGui::PopItemWidth();</span>
<span id="cb304-121"><a href="starfield.html#cb304-121"></a></span>
<span id="cb304-122"><a href="starfield.html#cb304-122"></a>      ImGui::PushItemWidth(<span class="dv">170</span>);</span>
<span id="cb304-123"><a href="starfield.html#cb304-123"></a>      <span class="at">const</span> <span class="kw">auto</span> aspect{<span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(<span class="va">m_viewportWidth</span>) /</span>
<span id="cb304-124"><a href="starfield.html#cb304-124"></a>                        <span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(<span class="va">m_viewportHeight</span>)};</span>
<span id="cb304-125"><a href="starfield.html#cb304-125"></a>      <span class="cf">if</span> (currentIndex == <span class="dv">0</span>) {</span>
<span id="cb304-126"><a href="starfield.html#cb304-126"></a>        <span class="va">m_projMatrix</span> =</span>
<span id="cb304-127"><a href="starfield.html#cb304-127"></a>            glm::perspective(glm::radians(<span class="va">m_FOV</span>), aspect, <span class="fl">0.01</span><span class="bu">f</span>, <span class="fl">100.0</span><span class="bu">f</span>);</span>
<span id="cb304-128"><a href="starfield.html#cb304-128"></a></span>
<span id="cb304-129"><a href="starfield.html#cb304-129"></a>        ImGui::SliderFloat(<span class="st">&quot;FOV&quot;</span>, &amp;<span class="va">m_FOV</span>, <span class="fl">5.0</span><span class="bu">f</span>, <span class="fl">179.0</span><span class="bu">f</span>, <span class="st">&quot;</span><span class="sc">%.0f</span><span class="st"> degrees&quot;</span>);</span>
<span id="cb304-130"><a href="starfield.html#cb304-130"></a>      } <span class="cf">else</span> {</span>
<span id="cb304-131"><a href="starfield.html#cb304-131"></a>        <span class="va">m_projMatrix</span> = glm::ortho(-<span class="fl">20.0</span><span class="bu">f</span> * aspect, <span class="fl">20.0</span><span class="bu">f</span> * aspect, -<span class="fl">20.0</span><span class="bu">f</span>,</span>
<span id="cb304-132"><a href="starfield.html#cb304-132"></a>                                  <span class="fl">20.0</span><span class="bu">f</span>, <span class="fl">0.01</span><span class="bu">f</span>, <span class="fl">100.0</span><span class="bu">f</span>);</span>
<span id="cb304-133"><a href="starfield.html#cb304-133"></a>      }</span>
<span id="cb304-134"><a href="starfield.html#cb304-134"></a>      ImGui::PopItemWidth();</span>
<span id="cb304-135"><a href="starfield.html#cb304-135"></a>    }</span>
<span id="cb304-136"><a href="starfield.html#cb304-136"></a></span>
<span id="cb304-137"><a href="starfield.html#cb304-137"></a>    ImGui::End();</span>
<span id="cb304-138"><a href="starfield.html#cb304-138"></a>  }</span>
<span id="cb304-139"><a href="starfield.html#cb304-139"></a>}</span></code></pre></div>
<p>Esse é o código que define os widgets da ImGui. Assim como fizemos no projeto anterior, a matriz de projeção (<code>m_projMatrix</code>) é definida como projeção perspectiva ou ortográfica de acordo com a seleção do usuário.</p>
<p>O restante de <code>openglwindow.cpp</code> ficará assim:</p>
<div class="sourceCode" id="cb305" startFrom="141"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 140;"><span id="cb305-141"><a href="starfield.html#cb305-141"></a><span class="dt">void</span> OpenGLWindow::resizeGL(<span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb305-142"><a href="starfield.html#cb305-142"></a>  <span class="va">m_viewportWidth</span> = width;</span>
<span id="cb305-143"><a href="starfield.html#cb305-143"></a>  <span class="va">m_viewportHeight</span> = height;</span>
<span id="cb305-144"><a href="starfield.html#cb305-144"></a>}</span>
<span id="cb305-145"><a href="starfield.html#cb305-145"></a></span>
<span id="cb305-146"><a href="starfield.html#cb305-146"></a><span class="dt">void</span> OpenGLWindow::terminateGL() {</span>
<span id="cb305-147"><a href="starfield.html#cb305-147"></a>  <span class="va">m_model</span>.terminateGL();</span>
<span id="cb305-148"><a href="starfield.html#cb305-148"></a>  abcg::glDeleteProgram(<span class="va">m_program</span>);</span>
<span id="cb305-149"><a href="starfield.html#cb305-149"></a>}</span>
<span id="cb305-150"><a href="starfield.html#cb305-150"></a></span>
<span id="cb305-151"><a href="starfield.html#cb305-151"></a><span class="dt">void</span> OpenGLWindow::update() {</span>
<span id="cb305-152"><a href="starfield.html#cb305-152"></a>  <span class="co">// Animate angle by 90 degrees per second</span></span>
<span id="cb305-153"><a href="starfield.html#cb305-153"></a>  <span class="at">const</span> <span class="dt">float</span> deltaTime{<span class="kw">static_cast</span>&lt;<span class="dt">float</span>&gt;(getDeltaTime())};</span>
<span id="cb305-154"><a href="starfield.html#cb305-154"></a>  <span class="va">m_angle</span> = glm::wrapAngle(<span class="va">m_angle</span> + glm::radians(<span class="fl">90.0</span><span class="bu">f</span>) * deltaTime);</span>
<span id="cb305-155"><a href="starfield.html#cb305-155"></a></span>
<span id="cb305-156"><a href="starfield.html#cb305-156"></a>  <span class="co">// Update stars</span></span>
<span id="cb305-157"><a href="starfield.html#cb305-157"></a>  <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span> index : iter::range(<span class="va">m_numStars</span>)) {</span>
<span id="cb305-158"><a href="starfield.html#cb305-158"></a>    <span class="kw">auto</span> &amp;position{<span class="va">m_starPositions</span>.at(index)};</span>
<span id="cb305-159"><a href="starfield.html#cb305-159"></a>    <span class="kw">auto</span> &amp;rotation{<span class="va">m_starRotations</span>.at(index)};</span>
<span id="cb305-160"><a href="starfield.html#cb305-160"></a></span>
<span id="cb305-161"><a href="starfield.html#cb305-161"></a>    <span class="co">// Z coordinate increases by 10 units per second</span></span>
<span id="cb305-162"><a href="starfield.html#cb305-162"></a>    position.z += deltaTime * <span class="fl">10.0</span><span class="bu">f</span>;</span>
<span id="cb305-163"><a href="starfield.html#cb305-163"></a></span>
<span id="cb305-164"><a href="starfield.html#cb305-164"></a>    <span class="co">// If this star is behind the camera, select a new random position and</span></span>
<span id="cb305-165"><a href="starfield.html#cb305-165"></a>    <span class="co">// orientation, and move it back to -100</span></span>
<span id="cb305-166"><a href="starfield.html#cb305-166"></a>    <span class="cf">if</span> (position.z &gt; <span class="fl">0.1</span><span class="bu">f</span>) {</span>
<span id="cb305-167"><a href="starfield.html#cb305-167"></a>      randomizeStar(position, rotation);</span>
<span id="cb305-168"><a href="starfield.html#cb305-168"></a>      position.z = -<span class="fl">100.0</span><span class="bu">f</span>;  <span class="co">// Back to -100</span></span>
<span id="cb305-169"><a href="starfield.html#cb305-169"></a>    }</span>
<span id="cb305-170"><a href="starfield.html#cb305-170"></a>  }</span>
<span id="cb305-171"><a href="starfield.html#cb305-171"></a>}</span></code></pre></div>
<p>Em <code>OpenGLWindow::update</code>, incrementamos <code>m_angle</code> a uma taxa de <span class="math inline">\(90^\circ\)</span> por segundo (linha 154).</p>
<p>Além disso, iteramos sobre todas as estrelas no laço da linha 157. A coordenada <span class="math inline">\(z\)</span> da posição de cada estrela é incrementada a uma taxa de 10 unidades por segundo (linha 162). Assim, uma estrela que começa em <span class="math inline">\(z=-100\)</span> (distância máxima em relação à câmera) chega até <span class="math inline">\(z=0\)</span> (onde está a câmera) em 10 segundos.</p>
<p>A condicional da linha 166 verifica se a estrela já passou para trás da câmera. Verificamos se a coordenada <span class="math inline">\(z\)</span> da posição é maior que <span class="math inline">\(0.1\)</span> pois a estrela é um cubo unitário que foi reduzido em tamanho por um fator de escala <span class="math inline">\(0.2\)</span>. Logo, quando o cubo está em <span class="math inline">\(z=0\)</span> (isto é, na posição <span class="math inline">\(z\)</span> da câmera), ainda está com metade da malha triangular (metade do cubo) no espaço <span class="math inline">\(z&lt;0\)</span>. Isso significa que o cubo ainda pode ser visto pela câmera, pois a câmera está olhando na direção de <span class="math inline">\(z\)</span> negativo e a distância do plano de recorte próximo foi definida como <span class="math inline">\(0.01\)</span> (veja a chamada a <code>glm::perspective</code> na linha 127). Se <span class="math inline">\(z&gt;0.1\)</span>, então com certeza o cubo está totalmente atrás da câmera. Quando isso acontece, <code>OpenGLWindow::randomizeStar</code> é chamada novamente para sortear uma nova posição e eixo de rotação para a estrela. Além disso, a estrela é deslocada para <span class="math inline">\(z=-100\)</span> para começar um novo percurso em direção ao plano <span class="math inline">\(z=0\)</span> da câmera.</p>
<p>Isso conclui o projeto <code>starfield</code>!</p>
<p>Baixe o código completo usando <a href="https://hbatagelo.github.io/abcgapps/src/starfield.zip">este link</a>.</p>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="viewer1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referências.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_float": true,
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
