<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10.4 Texturização na prática | MCTA008-17 Computação Gráfica</title>
  <meta name="description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="10.4 Texturização na prática | MCTA008-17 Computação Gráfica" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="github-repo" content="hbatagelo/cgbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10.4 Texturização na prática | MCTA008-17 Computação Gráfica" />
  
  <meta name="twitter:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="texfiltering.html"/>
<link rel="next" href="normalmapping.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computação Gráfica</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Apresentação</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html"><i class="fa fa-check"></i>Pré-requisitos</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#atividades-práticas"><i class="fa fa-check"></i>Atividades práticas</a></li>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#visualizando-este-site"><i class="fa fa-check"></i>Visualizando este site</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="config.html"><a href="config.html"><i class="fa fa-check"></i><b>1</b> Configuração do ambiente</a>
<ul>
<li class="chapter" data-level="1.1" data-path="linux.html"><a href="linux.html"><i class="fa fa-check"></i><b>1.1</b> Linux</a>
<ul>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#habilitando-o-opengl"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#atualizando-o-gcc"><i class="fa fa-check"></i>Atualizando o GCC</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#instalando-o-emscripten"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="macos.html"><a href="macos.html"><i class="fa fa-check"></i><b>1.2</b> macOS</a>
<ul>
<li class="chapter" data-level="" data-path="macos.html"><a href="macos.html#instalando-o-emscripten-1"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="windows.html"><a href="windows.html"><i class="fa fa-check"></i><b>1.3</b> Windows</a>
<ul>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#habilitando-o-opengl-1"><i class="fa fa-check"></i>Habilitando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#instalando-o-emscripten-2"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="vscode.html"><a href="vscode.html"><i class="fa fa-check"></i><b>1.4</b> Visual Studio Code</a></li>
<li class="chapter" data-level="1.5" data-path="abcg.html"><a href="abcg.html"><i class="fa fa-check"></i><b>1.5</b> ABCg</a>
<ul>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#instalação"><i class="fa fa-check"></i>Instalação</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-em-linha-de-comando"><i class="fa fa-check"></i>Compilando em linha de comando</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-no-visual-studio-code"><i class="fa fa-check"></i>Compilando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#depurando-no-visual-studio-code"><i class="fa fa-check"></i>Depurando no Visual Studio Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-para-webassembly"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introdução</a>
<ul>
<li class="chapter" data-level="2.1" data-path="áreas-correlatas.html"><a href="áreas-correlatas.html"><i class="fa fa-check"></i><b>2.1</b> Áreas correlatas</a></li>
<li class="chapter" data-level="2.2" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html"><i class="fa fa-check"></i><b>2.2</b> Linha do tempo</a>
<ul>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section"><i class="fa fa-check"></i>1950</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-1"><i class="fa fa-check"></i>1960</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-2"><i class="fa fa-check"></i>1970</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-3"><i class="fa fa-check"></i>1980</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-4"><i class="fa fa-check"></i>1990</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-5"><i class="fa fa-check"></i>2000</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-6"><i class="fa fa-check"></i>2010</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-7"><i class="fa fa-check"></i>2020</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="firstapp.html"><a href="firstapp.html"><i class="fa fa-check"></i><b>2.3</b> Primeiro programa</a>
<ul>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#configuração-inicial"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#main.cpp"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.hpp"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#openglwindow.cpp"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#compilando-para-webassembly-1"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphicssystem.html"><a href="graphicssystem.html"><i class="fa fa-check"></i><b>3</b> Sistemas gráficos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vectorxraster.html"><a href="vectorxraster.html"><i class="fa fa-check"></i><b>3.1</b> Vetorial <em>x</em> matricial</a>
<ul>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-vetorial"><i class="fa fa-check"></i>Representação vetorial</a></li>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-matricial"><i class="fa fa-check"></i>Representação matricial</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="es.html"><a href="es.html"><i class="fa fa-check"></i><b>3.2</b> Dispositivos de E/S</a>
<ul>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-entrada"><i class="fa fa-check"></i>Dispositivos de entrada</a></li>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-saída"><i class="fa fa-check"></i>Dispositivos de saída</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="framebuffer.html"><a href="framebuffer.html"><i class="fa fa-check"></i><b>3.3</b> Framebuffer</a>
<ul>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#screen-tearing"><i class="fa fa-check"></i>Screen tearing</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#vsync"><i class="fa fa-check"></i>Vsync</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#backbuffering"><i class="fa fa-check"></i>Backbuffering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sierpinski.html"><a href="sierpinski.html"><i class="fa fa-check"></i><b>3.4</b> Triângulo de Sierpinski</a>
<ul>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#configuração-inicial-1"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#main.cpp-1"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.hpp-1"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#openglwindow.cpp-1"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>4</b> Pipeline gráfico</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dados-gráficos.html"><a href="dados-gráficos.html"><i class="fa fa-check"></i><b>4.1</b> Dados gráficos</a></li>
<li class="chapter" data-level="4.2" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html"><i class="fa fa-check"></i><b>4.2</b> Ray casting <em>x</em> rasterização</a>
<ul>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#ray-casting"><i class="fa fa-check"></i>Ray casting</a></li>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#rasterização"><i class="fa fa-check"></i>Rasterização</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="glpipeline.html"><a href="glpipeline.html"><i class="fa fa-check"></i><b>4.3</b> Pipeline do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#aplicação"><i class="fa fa-check"></i>Aplicação</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#vertex-shader"><i class="fa fa-check"></i>Vertex shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#montagem-de-primitivas"><i class="fa fa-check"></i>Montagem de primitivas</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#recorte"><i class="fa fa-check"></i>Recorte</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#rasterização-1"><i class="fa fa-check"></i>Rasterização</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#fragment-shader"><i class="fa fa-check"></i>Fragment shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#operações-de-fragmentos"><i class="fa fa-check"></i>Operações de fragmentos</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="coloredtriangles.html"><a href="coloredtriangles.html"><i class="fa fa-check"></i><b>4.4</b> Triângulos coloridos</a>
<ul>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#configuração-inicial-2"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#main.cpp-2"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.hpp-2"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#openglwindow.cpp-2"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="game.html"><a href="game.html"><i class="fa fa-check"></i><b>5</b> Desenvolvendo um jogo 2D</a>
<ul>
<li class="chapter" data-level="5.1" data-path="regularpolygons.html"><a href="regularpolygons.html"><i class="fa fa-check"></i><b>5.1</b> Polígonos regulares</a>
<ul>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#configuração-inicial-3"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#main.cpp-3"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.hpp-3"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#openglwindow.cpp-3"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="asteroids.html"><a href="asteroids.html"><i class="fa fa-check"></i><b>5.2</b> Asteroids</a>
<ul>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#organização-do-projeto"><i class="fa fa-check"></i>Organização do projeto</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#configuração-inicial-4"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#nave"><i class="fa fa-check"></i>Nave</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#estrelas"><i class="fa fa-check"></i>Estrelas</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#asteroides"><i class="fa fa-check"></i>Asteroides</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#tiros-e-colisões"><i class="fa fa-check"></i>Tiros e colisões</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="geometry.html"><a href="geometry.html"><i class="fa fa-check"></i><b>6</b> Espaços e geometria</a>
<ul>
<li class="chapter" data-level="6.1" data-path="vector.html"><a href="vector.html"><i class="fa fa-check"></i><b>6.1</b> Espaço vetorial</a>
<ul>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#combinação-e-independência-linear"><i class="fa fa-check"></i>Combinação e independência linear</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#dimensão-e-base"><i class="fa fa-check"></i>Dimensão e base</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#vetores-geométricos"><i class="fa fa-check"></i>Vetores geométricos</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="affine.html"><a href="affine.html"><i class="fa fa-check"></i><b>6.2</b> Espaço afim</a>
<ul>
<li class="chapter" data-level="" data-path="affine.html"><a href="affine.html#combinação-afim"><i class="fa fa-check"></i>Combinação afim</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="euclidean.html"><a href="euclidean.html"><i class="fa fa-check"></i><b>6.3</b> Espaço euclidiano</a>
<ul>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#frames"><i class="fa fa-check"></i>Frames</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-escalar"><i class="fa fa-check"></i>Produto escalar</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ortogonalidade"><i class="fa fa-check"></i>Ortogonalidade</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#comprimento-e-distância"><i class="fa fa-check"></i>Comprimento e distância</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#normalização"><i class="fa fa-check"></i>Normalização</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ângulo-entre-vetores"><i class="fa fa-check"></i>Ângulo entre vetores</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#projeção-ortogonal"><i class="fa fa-check"></i>Projeção ortogonal</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-vetorial"><i class="fa fa-check"></i>Produto vetorial</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#vetor-normal"><i class="fa fa-check"></i>Vetor normal</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="objmodel.html"><a href="objmodel.html"><i class="fa fa-check"></i><b>6.4</b> Lendo um modelo 3D</a>
<ul>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#orientação-e-face-culling"><i class="fa fa-check"></i>Orientação e face culling</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#configuração-inicial-5"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#main.cpp-5"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.vert"><i class="fa fa-check"></i>loadmodel.vert</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.frag"><i class="fa fa-check"></i>loadmodel.frag</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.hpp-5"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#openglwindow.cpp-5"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>7</b> Matrizes e transformações</a>
<ul>
<li class="chapter" data-level="7.1" data-path="matrix.html"><a href="matrix.html"><i class="fa fa-check"></i><b>7.1</b> Matrizes</a>
<ul>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-transposta"><i class="fa fa-check"></i>Matriz transposta</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-quadrada"><i class="fa fa-check"></i>Matriz quadrada</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-linhacoluna"><i class="fa fa-check"></i>Matriz linha/coluna</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-identidade"><i class="fa fa-check"></i>Matriz identidade</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#operações"><i class="fa fa-check"></i>Operações</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-inversa"><i class="fa fa-check"></i>Matriz inversa</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-ortogonal"><i class="fa fa-check"></i>Matriz ortogonal</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#propriedades"><i class="fa fa-check"></i>Propriedades</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#transformação"><i class="fa fa-check"></i>Transformação</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="homogeneous.html"><a href="homogeneous.html"><i class="fa fa-check"></i><b>7.2</b> Coordenadas homogêneas</a></li>
<li class="chapter" data-level="7.3" data-path="concat.html"><a href="concat.html"><i class="fa fa-check"></i><b>7.3</b> Concatenação de transformações</a></li>
<li class="chapter" data-level="7.4" data-path="transforms.html"><a href="transforms.html"><i class="fa fa-check"></i><b>7.4</b> Transformações</a>
<ul>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#identidade"><i class="fa fa-check"></i>Identidade</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#translação"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#escala"><i class="fa fa-check"></i>Escala</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#rotação"><i class="fa fa-check"></i>Rotação</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="glspaces.html"><a href="glspaces.html"><i class="fa fa-check"></i><b>7.5</b> Espaços do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-objeto"><i class="fa fa-check"></i>Espaço do objeto</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-mundo"><i class="fa fa-check"></i>Espaço do mundo</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-da-câmera"><i class="fa fa-check"></i>Espaço da câmera</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#concatenação-das-matrizes-de-modelo-e-visão"><i class="fa fa-check"></i>Concatenação das matrizes de modelo e visão</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="lookat.html"><a href="lookat.html"><i class="fa fa-check"></i><b>7.6</b> Câmera LookAt</a>
<ul>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-n"><i class="fa fa-check"></i>Construindo o vetor n</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-u"><i class="fa fa-check"></i>Construindo o vetor u</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-v"><i class="fa fa-check"></i>Construindo o vetor v</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-a-matriz-de-visão"><i class="fa fa-check"></i>Construindo a matriz de visão</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="lookatproject.html"><a href="lookatproject.html"><i class="fa fa-check"></i><b>7.7</b> LookAt na prática</a>
<ul>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#configuração-inicial-6"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#main.cpp-6"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.vert"><i class="fa fa-check"></i>lookat.vert</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.frag"><i class="fa fa-check"></i>lookat.frag</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.hpp"><i class="fa fa-check"></i>camera.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.cpp"><i class="fa fa-check"></i>camera.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.hpp-6"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#openglwindow.cpp-6"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.hpp"><i class="fa fa-check"></i>ground.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.cpp"><i class="fa fa-check"></i>ground.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projections.html"><a href="projections.html"><i class="fa fa-check"></i><b>8</b> Projeções e trackball virtual</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ortho.html"><a href="ortho.html"><i class="fa fa-check"></i><b>8.1</b> Projeção ortográfica</a>
<ul>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#translação-1"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#escala-e-reflexão"><i class="fa fa-check"></i>Escala e reflexão</a></li>
<li class="chapter" data-level="" data-path="ortho.html"><a href="ortho.html#matriz-de-projeção"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="perspective.html"><a href="perspective.html"><i class="fa fa-check"></i><b>8.2</b> Projeção perspectiva</a>
<ul>
<li class="chapter" data-level="" data-path="perspective.html"><a href="perspective.html#matriz-de-projeção-1"><i class="fa fa-check"></i>Matriz de projeção</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="vtrackball1.html"><a href="vtrackball1.html"><i class="fa fa-check"></i><b>8.3</b> Trackball virtual</a>
<ul>
<li class="chapter" data-level="" data-path="vtrackball1.html"><a href="vtrackball1.html#rotação-em-torno-de-um-eixo-arbitrário"><i class="fa fa-check"></i>Rotação em torno de um eixo arbitrário</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="viewer1.html"><a href="viewer1.html"><i class="fa fa-check"></i><b>8.4</b> Visualizador 3D</a>
<ul>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#configuração-inicial-7"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#main.cpp-7"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.vert"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#depth.frag"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.hpp"><i class="fa fa-check"></i>model.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#model.cpp"><i class="fa fa-check"></i>model.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.hpp"><i class="fa fa-check"></i>trackball.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#trackball.cpp"><i class="fa fa-check"></i>trackball.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.hpp-7"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer1.html"><a href="viewer1.html#openglwindow.cpp-7"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="starfield.html"><a href="starfield.html"><i class="fa fa-check"></i><b>8.5</b> Efeito starfield</a>
<ul>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#configuração-inicial-8"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#main.cpp-8"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.vert-1"><i class="fa fa-check"></i>depth.vert</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#depth.frag-1"><i class="fa fa-check"></i>depth.frag</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.hpp-8"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="starfield.html"><a href="starfield.html#openglwindow.cpp-8"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lighting.html"><a href="lighting.html"><i class="fa fa-check"></i><b>9</b> Iluminação</a>
<ul>
<li class="chapter" data-level="9.1" data-path="renderingequation.html"><a href="renderingequation.html"><i class="fa fa-check"></i><b>9.1</b> Equação de renderização</a></li>
<li class="chapter" data-level="9.2" data-path="phongmodel.html"><a href="phongmodel.html"><i class="fa fa-check"></i><b>9.2</b> Modelo de reflexão de Phong</a>
<ul>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-ambiente"><i class="fa fa-check"></i>Reflexão ambiente</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-difusa"><i class="fa fa-check"></i>Reflexão difusa</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#reflexão-especular"><i class="fa fa-check"></i>Reflexão especular</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#modelo-completo"><i class="fa fa-check"></i>Modelo completo</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#iluminação-colorida"><i class="fa fa-check"></i>Iluminação colorida</a></li>
<li class="chapter" data-level="" data-path="phongmodel.html"><a href="phongmodel.html#fontes-de-luz"><i class="fa fa-check"></i>Fontes de luz</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="blinnphongmodel.html"><a href="blinnphongmodel.html"><i class="fa fa-check"></i><b>9.3</b> Modelo de Blinn–Phong</a></li>
<li class="chapter" data-level="9.4" data-path="shading.html"><a href="shading.html"><i class="fa fa-check"></i><b>9.4</b> Sombreamento</a>
<ul>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#flat"><i class="fa fa-check"></i>Flat</a></li>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#gouraud"><i class="fa fa-check"></i>Gouraud</a></li>
<li class="chapter" data-level="" data-path="shading.html"><a href="shading.html#phong"><i class="fa fa-check"></i>Phong</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="viewer2.html"><a href="viewer2.html"><i class="fa fa-check"></i><b>9.5</b> Normais como cores</a>
<ul>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#configuração-inicial-9"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#model.hpp-1"><i class="fa fa-check"></i>model.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#model.cpp-1"><i class="fa fa-check"></i>model.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#openglwindow.hpp-9"><i class="fa fa-check"></i>openglwindow.hpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#openglwindow.cpp-9"><i class="fa fa-check"></i>openglwindow.cpp</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#normal.frag"><i class="fa fa-check"></i>normal.frag</a></li>
<li class="chapter" data-level="" data-path="viewer2.html"><a href="viewer2.html#normal.vert"><i class="fa fa-check"></i>normal.vert</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="viewer3.html"><a href="viewer3.html"><i class="fa fa-check"></i><b>9.6</b> Iluminação na prática</a>
<ul>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#phong-com-sombreamento-de-gouraud"><i class="fa fa-check"></i>Phong com sombreamento de Gouraud</a></li>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#phong-com-sombreamento-de-phong"><i class="fa fa-check"></i>Phong com sombreamento de Phong</a></li>
<li class="chapter" data-level="" data-path="viewer3.html"><a href="viewer3.html#blinn-phong-com-sombreamento-de-phong"><i class="fa fa-check"></i>Blinn-Phong com sombreamento de Phong</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="texturing.html"><a href="texturing.html"><i class="fa fa-check"></i><b>10</b> Texturização</a>
<ul>
<li class="chapter" data-level="10.1" data-path="texmapping.html"><a href="texmapping.html"><i class="fa fa-check"></i><b>10.1</b> Mapeamento</a>
<ul>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-planar"><i class="fa fa-check"></i>Mapeamento planar</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-cilíndrico"><i class="fa fa-check"></i>Mapeamento cilíndrico</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-esférico"><i class="fa fa-check"></i>Mapeamento esférico</a></li>
<li class="chapter" data-level="" data-path="texmapping.html"><a href="texmapping.html#mapeamento-uv-unwrap"><i class="fa fa-check"></i>Mapeamento UV unwrap</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="texwrapping.html"><a href="texwrapping.html"><i class="fa fa-check"></i><b>10.2</b> Empacotamento</a></li>
<li class="chapter" data-level="10.3" data-path="texfiltering.html"><a href="texfiltering.html"><i class="fa fa-check"></i><b>10.3</b> Filtragem</a>
<ul>
<li class="chapter" data-level="" data-path="texfiltering.html"><a href="texfiltering.html#magnificação"><i class="fa fa-check"></i>Magnificação</a></li>
<li class="chapter" data-level="" data-path="texfiltering.html"><a href="texfiltering.html#minificação"><i class="fa fa-check"></i>Minificação</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="viewer4.html"><a href="viewer4.html"><i class="fa fa-check"></i><b>10.4</b> Texturização na prática</a>
<ul>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#carregando-texturas"><i class="fa fa-check"></i>Carregando texturas</a></li>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#carregando-modelos-com-textura"><i class="fa fa-check"></i>Carregando modelos com textura</a></li>
<li class="chapter" data-level="" data-path="viewer4.html"><a href="viewer4.html#renderizando"><i class="fa fa-check"></i>Renderizando</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="normalmapping.html"><a href="normalmapping.html"><i class="fa fa-check"></i><b>10.5</b> Mapeamento de normais</a>
<ul>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#espaço-tangente"><i class="fa fa-check"></i>Espaço tangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#transformação-para-o-espaço-tangente"><i class="fa fa-check"></i>Transformação para o espaço tangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#vetor-tangente-e-bitangente"><i class="fa fa-check"></i>Vetor tangente e bitangente</a></li>
<li class="chapter" data-level="" data-path="normalmapping.html"><a href="normalmapping.html#mapeamento-de-normais-na-prática"><i class="fa fa-check"></i>Mapeamento de normais na prática</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li>
<a href="mailto:harlen.batagelo@ufabc.edu.br" target="blank">Harlen Batagelo</a>
<a href="mailto:bruno.marques@ufabc.edu.br" target="blank">Bruno Marques</a>
<br>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCTA008-17 Computação Gráfica</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="viewer4" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Texturização na prática</h2>
<p>Nesta seção, daremos continuidade ao projeto do visualizador de modelos 3D apresentado na seção <a href="viewer3.html#viewer3">9.6</a>.</p>
<p>Esta será a versão 4 do visualizador (<code>viewer4</code>) e terá um shader que usa uma textura para modificar as propriedades de reflexão difusa (<span class="math inline">\(\kappa_d\)</span>) e ambiente (<span class="math inline">\(\kappa_a\)</span>) do material utilizado no modelo de reflexão de Blinn–Phong.</p>
<p>Se o objeto lido do arquivo OBJ já vier com coordenadas de textura definidas em seus vértices (mapeamento UV unwrap), o visualizador usará essas coordenadas para amostrar a textura. Entretanto, também poderemos selecionar, através da interface da ImGui, um mapeamento pré-definido: triplanar, cilíndrico ou esférico.</p>
<p>Nesta nova versão, o botão “Load 3D Model” será transformado em um item do menu “File.” Há também uma opção de menu para carregar uma textura como um arquivo de imagem no formato PNG ou JPEG.</p>
<p>O resultado ficará como a seguir:</p>
<iframe
  src="https://hbatagelo.github.io/abcgapps/viewer4/index.html"
  allow="gamepad" frameborder="0" allowfullscreen="true" allowtransparency="true" emscriptenheight="740"
  ></iframe>
<p>Como o código dessa versão contém apenas mudanças incrementais em relação ao anterior, nosso foco será apenas nessas mudanças.</p>
<p>Baixe o código completo <a href="https://hbatagelo.github.io/abcgapps/src/viewer4.zip">deste link</a>.</p>
<div id="carregando-texturas" class="section level3 unnumbered">
<h3>Carregando texturas</h3>
<p>Para carregar uma textura no OpenGL, primeiro devemos chamar a função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glGenTextures.xhtml"><code>glGenTextures</code></a> para criar um recurso de textura. Por exemplo, para criar apenas uma textura, podemos fazer</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb352-1"><a href="viewer4.html#cb352-1" aria-hidden="true" tabindex="-1"></a>glGenTextures(<span class="dv">1</span>, &amp;textureID);</span></code></pre></div>
<p>onde <code>textureID</code> é uma variável do tipo <code>GLuint</code> que será preenchida com o identificador do recurso de textura criado pelo OpenGL.</p>
<p>Em seguida, devemos ligar o recurso de textura a um “alvo de textura,” que é <code>GL_TEXTURE_2D</code> para texturas 2D:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb353-1"><a href="viewer4.html#cb353-1" aria-hidden="true" tabindex="-1"></a>glBindTexture(GL_TEXTURE_2D, textureID);</span></code></pre></div>
<p>Neste momento, a textura ainda está vazia. Para definir seu conteúdo, devemos ter um mapa de bits que descreve o conteúdo de uma imagem. Podemos carregar o conteúdo do mapa de bits através da função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glTexImage2D.xhtml"><code>glTexImage2D</code></a>. Por exemplo, considere o código a seguir:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb354-1"><a href="viewer4.html#cb354-1" aria-hidden="true" tabindex="-1"></a>glTexImage2D(GL_TEXTURE_2D, <span class="dv">0</span>, GL_RGBA, <span class="dv">800</span>, <span class="dv">600</span>, </span>
<span id="cb354-2"><a href="viewer4.html#cb354-2" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>, GL_RGBA, GL_UNSIGNED_BYTE, pixels);</span></code></pre></div>
<p><code>glTexImage2D</code> copia o mapa de bits contido no ponteiro <code>pixels</code>, supondo que o mapa é um arranjo de <span class="math inline">\(800 \times 600\)</span> pixels. A função considera que cada pixel é uma tupla de valores RGBA (<code>GL_RGBA</code>), e que cada componente de cor é um byte sem sinal (<code>GL_UNSIGNED_BYTE</code>).</p>
<p>Não é necessário entrarmos em detalhes sobre os diferentes parâmetros de <code>glTexImage2D</code>, pois usaremos a função <code>abcg::opengl::loadTexture</code> da ABCg que se encarrega de fazer todo o procedimento de criação de textura a partir de um arquivo de imagem. Essa função é definida em <code>abcg/abcg_image.cpp</code> e tem a seguinte assinatura:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb355-1"><a href="viewer4.html#cb355-1" aria-hidden="true" tabindex="-1"></a>[[<span class="at">nodiscard</span>]] GLuint loadTexture(<span class="bu">std::</span>string_view path,</span>
<span id="cb355-2"><a href="viewer4.html#cb355-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="dt">bool</span> generateMipmaps = <span class="kw">true</span>);</span></code></pre></div>
<p>Internamente, essa função usa funções da SDL para converter os dados do arquivo de imagem em um mapa de bits, e então chama as funções do OpenGL para criar o identificador de textura. Assim, para criar uma textura a partir de um arquivo <code>imagem.png</code>, podemos fazer simplesmente:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb356-1"><a href="viewer4.html#cb356-1" aria-hidden="true" tabindex="-1"></a>textureID = abcg::opengl::loadTexture(<span class="st">&quot;imagem.png&quot;</span>);</span></code></pre></div>
<p>Por padrão, <code>abcg::opengl::loadTexture</code> cria também o mipmap da textura e usa o filtro de minificação <code>GL_LINEAR_MIPMAP_LINEAR</code>. Se quisermos que o mipmap não seja gerado, basta usarmos <code>false</code> como segundo argumento:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb357-1"><a href="viewer4.html#cb357-1" aria-hidden="true" tabindex="-1"></a>textureID = abcg::opengl::loadTexture(<span class="st">&quot;imagem.png&quot;</span>, <span class="kw">false</span>);</span></code></pre></div>
<p>Para destruir a textura e liberar seus recursos, devemos chamar manualmente <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glDeleteTextures.xhtml"><code>glDeleteTextures</code></a>. Por exemplo, o seguinte código libera a textura <code>textureID</code> criada com <code>abcg::opengl::loadTexture</code>.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb358-1"><a href="viewer4.html#cb358-1" aria-hidden="true" tabindex="-1"></a>glDeleteTextures(<span class="dv">1</span>, &amp;textureID);</span></code></pre></div>
<p>Nessa nova versão do visualizador, a classe <code>Model</code> implementa a função membro <code>Model::loadDiffuseTexture</code>, que carrega um arquivo de imagem e gera um identificador de recurso de textura difusa na variável <code>m_diffuseTexture</code>. A função é definida como a seguir (em <code>model.cpp</code>):</p>
<div class="sourceCode" id="cb359" startFrom="77"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 76;"><span id="cb359-77"><a href="viewer4.html#cb359-77"></a><span class="dt">void</span> Model::loadDiffuseTexture(<span class="bu">std::</span>string_view path) {</span>
<span id="cb359-78"><a href="viewer4.html#cb359-78"></a>  <span class="cf">if</span> (!<span class="bu">std::</span>filesystem<span class="bu">::</span>exists(path)) <span class="cf">return</span>;</span>
<span id="cb359-79"><a href="viewer4.html#cb359-79"></a></span>
<span id="cb359-80"><a href="viewer4.html#cb359-80"></a>  abcg::glDeleteTextures(<span class="dv">1</span>, &amp;<span class="va">m_diffuseTexture</span>);</span>
<span id="cb359-81"><a href="viewer4.html#cb359-81"></a>  <span class="va">m_diffuseTexture</span> = abcg::opengl::loadTexture(path);</span>
<span id="cb359-82"><a href="viewer4.html#cb359-82"></a>}</span></code></pre></div>
<p>Essa função recebe em <code>path</code> o caminho contendo o nome do arquivo de imagem PNG ou JPEG. Se o arquivo não existir, a função retorna sem fazer nada (linha 78). Caso contrário, o recurso de textura anterior é liberado e <code>abcg::opengl::loadTexture</code> é chamada para criar a nova textura.</p>
</div>
<div id="carregando-modelos-com-textura" class="section level3 unnumbered">
<h3>Carregando modelos com textura</h3>
<p>Um arquivo OBJ pode vir acompanhado de um arquivo <code>.mtl</code> opcional que contém a descrição das propriedades dos materiais de cada objeto<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>. Por exemplo, o arquivo <code>roman_lamp.obj</code> (lâmpada romana da figura <a href="texmapping.html#fig:texturing7">10.11</a>) vem acompanhado do arquivo <code>roman_lamp.mtl</code> que tem o seguinte conteúdo:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb360-1"><a href="viewer4.html#cb360-1" aria-hidden="true" tabindex="-1"></a>newmtl roman_lamp</span>
<span id="cb360-2"><a href="viewer4.html#cb360-2" aria-hidden="true" tabindex="-1"></a>    Ns 25.0000</span>
<span id="cb360-3"><a href="viewer4.html#cb360-3" aria-hidden="true" tabindex="-1"></a>    Ni 1.5000</span>
<span id="cb360-4"><a href="viewer4.html#cb360-4" aria-hidden="true" tabindex="-1"></a>    Tr 0.0000</span>
<span id="cb360-5"><a href="viewer4.html#cb360-5" aria-hidden="true" tabindex="-1"></a>    Tf 1.0000 1.0000 1.0000 </span>
<span id="cb360-6"><a href="viewer4.html#cb360-6" aria-hidden="true" tabindex="-1"></a>    illum 2</span>
<span id="cb360-7"><a href="viewer4.html#cb360-7" aria-hidden="true" tabindex="-1"></a>    Ka 0.2000 0.2000 0.2000</span>
<span id="cb360-8"><a href="viewer4.html#cb360-8" aria-hidden="true" tabindex="-1"></a>    Kd 1.0000 1.0000 1.0000</span>
<span id="cb360-9"><a href="viewer4.html#cb360-9" aria-hidden="true" tabindex="-1"></a>    Ks 0.6000 0.6000 0.6000</span>
<span id="cb360-10"><a href="viewer4.html#cb360-10" aria-hidden="true" tabindex="-1"></a>    Ke 0.0000 0.0000 0.0000</span>
<span id="cb360-11"><a href="viewer4.html#cb360-11" aria-hidden="true" tabindex="-1"></a>    map_Ka maps/roman_lamp_diffuse.jpg</span>
<span id="cb360-12"><a href="viewer4.html#cb360-12" aria-hidden="true" tabindex="-1"></a>    map_Kd maps/roman_lamp_diffuse.jpg</span>
<span id="cb360-13"><a href="viewer4.html#cb360-13" aria-hidden="true" tabindex="-1"></a>    map_bump maps/roman_lamp_normal.jpg</span>
<span id="cb360-14"><a href="viewer4.html#cb360-14" aria-hidden="true" tabindex="-1"></a>    bump maps/roman_lamp_normal.jpg</span></code></pre></div>
<p>Entre outras coisas, o arquivo especifica o parâmetro de brilho especular (<code>Ns</code>) do material e as propriedades de reflexão ambiente (<code>Ka</code>), difusa (<code>Kd</code>) e especular (<code>Ks</code>). Além disso, o arquivo contém o nome do mapa de textura que deve ser utilizado para modificar a reflexão ambiente (<code>map_Ka</code>) e reflexão difusa (<code>map_Kd</code>). Há outras propriedades, mas elas não serão utilizadas no momento.</p>
<p>Nossa implementação de <code>Model::loadObj</code>, que utiliza funções da <a href="https://github.com/tinyobjloader/tinyobjloader"><code>TinyObjLoader</code></a>, carrega automaticamente a textura difusa, se houver. A definição completa dessa versão atualizada de <code>Model::loadObj</code> é mostrada seguir (arquivo <code>model.cpp</code>).</p>
<div class="sourceCode" id="cb361" startFrom="84"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 83;"><span id="cb361-84"><a href="viewer4.html#cb361-84"></a><span class="dt">void</span> Model::loadObj(<span class="bu">std::</span>string_view path, <span class="dt">bool</span> standardize) {</span>
<span id="cb361-85"><a href="viewer4.html#cb361-85"></a>  <span class="at">const</span> <span class="kw">auto</span> basePath{<span class="bu">std::</span>filesystem<span class="bu">::</span>path{path}.parent_path().string() + <span class="st">&quot;/&quot;</span>};</span>
<span id="cb361-86"><a href="viewer4.html#cb361-86"></a></span>
<span id="cb361-87"><a href="viewer4.html#cb361-87"></a>  tinyobj::ObjReaderConfig readerConfig;</span>
<span id="cb361-88"><a href="viewer4.html#cb361-88"></a>  readerConfig.mtl_search_path = basePath;  <span class="co">// Path to material files</span></span>
<span id="cb361-89"><a href="viewer4.html#cb361-89"></a></span>
<span id="cb361-90"><a href="viewer4.html#cb361-90"></a>  tinyobj::ObjReader reader;</span>
<span id="cb361-91"><a href="viewer4.html#cb361-91"></a></span>
<span id="cb361-92"><a href="viewer4.html#cb361-92"></a>  <span class="cf">if</span> (!reader.ParseFromFile(path.data(), readerConfig)) {</span>
<span id="cb361-93"><a href="viewer4.html#cb361-93"></a>    <span class="cf">if</span> (!reader.Error().empty()) {</span>
<span id="cb361-94"><a href="viewer4.html#cb361-94"></a>      <span class="cf">throw</span> abcg::Exception{abcg::Exception::Runtime(</span>
<span id="cb361-95"><a href="viewer4.html#cb361-95"></a>          fmt::format(<span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st"> (</span><span class="sc">{}</span><span class="st">)&quot;</span>, path, reader.Error()))};</span>
<span id="cb361-96"><a href="viewer4.html#cb361-96"></a>    }</span>
<span id="cb361-97"><a href="viewer4.html#cb361-97"></a>    <span class="cf">throw</span> abcg::Exception{</span>
<span id="cb361-98"><a href="viewer4.html#cb361-98"></a>        abcg::Exception::Runtime(fmt::format(<span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st">&quot;</span>, path))};</span>
<span id="cb361-99"><a href="viewer4.html#cb361-99"></a>  }</span>
<span id="cb361-100"><a href="viewer4.html#cb361-100"></a></span>
<span id="cb361-101"><a href="viewer4.html#cb361-101"></a>  <span class="cf">if</span> (!reader.Warning().empty()) {</span>
<span id="cb361-102"><a href="viewer4.html#cb361-102"></a>    fmt::print(<span class="st">&quot;Warning: </span><span class="sc">{}\n</span><span class="st">&quot;</span>, reader.Warning());</span>
<span id="cb361-103"><a href="viewer4.html#cb361-103"></a>  }</span>
<span id="cb361-104"><a href="viewer4.html#cb361-104"></a></span>
<span id="cb361-105"><a href="viewer4.html#cb361-105"></a>  <span class="at">const</span> <span class="kw">auto</span>&amp; attrib{reader.GetAttrib()};</span>
<span id="cb361-106"><a href="viewer4.html#cb361-106"></a>  <span class="at">const</span> <span class="kw">auto</span>&amp; shapes{reader.GetShapes()};</span>
<span id="cb361-107"><a href="viewer4.html#cb361-107"></a>  <span class="at">const</span> <span class="kw">auto</span>&amp; materials{reader.GetMaterials()};</span>
<span id="cb361-108"><a href="viewer4.html#cb361-108"></a></span>
<span id="cb361-109"><a href="viewer4.html#cb361-109"></a>  <span class="va">m_vertices</span>.clear();</span>
<span id="cb361-110"><a href="viewer4.html#cb361-110"></a>  <span class="va">m_indices</span>.clear();</span>
<span id="cb361-111"><a href="viewer4.html#cb361-111"></a></span>
<span id="cb361-112"><a href="viewer4.html#cb361-112"></a>  <span class="va">m_hasNormals</span> = <span class="kw">false</span>;</span>
<span id="cb361-113"><a href="viewer4.html#cb361-113"></a>  <span class="va">m_hasTexCoords</span> = <span class="kw">false</span>;</span>
<span id="cb361-114"><a href="viewer4.html#cb361-114"></a></span>
<span id="cb361-115"><a href="viewer4.html#cb361-115"></a>  <span class="co">// A key:value map with key=Vertex and value=index</span></span>
<span id="cb361-116"><a href="viewer4.html#cb361-116"></a>  <span class="bu">std::</span>unordered_map&lt;Vertex, GLuint&gt; hash{};</span>
<span id="cb361-117"><a href="viewer4.html#cb361-117"></a></span>
<span id="cb361-118"><a href="viewer4.html#cb361-118"></a>  <span class="co">// Loop over shapes</span></span>
<span id="cb361-119"><a href="viewer4.html#cb361-119"></a>  <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span>&amp; shape : shapes) {</span>
<span id="cb361-120"><a href="viewer4.html#cb361-120"></a>    <span class="co">// Loop over indices</span></span>
<span id="cb361-121"><a href="viewer4.html#cb361-121"></a>    <span class="cf">for</span> (<span class="at">const</span> <span class="kw">auto</span> offset : iter::range(shape.mesh.indices.size())) {</span>
<span id="cb361-122"><a href="viewer4.html#cb361-122"></a>      <span class="co">// Access to vertex</span></span>
<span id="cb361-123"><a href="viewer4.html#cb361-123"></a>      <span class="at">const</span> tinyobj::<span class="dt">index_t</span> index{shape.mesh.indices.at(offset)};</span>
<span id="cb361-124"><a href="viewer4.html#cb361-124"></a></span>
<span id="cb361-125"><a href="viewer4.html#cb361-125"></a>      <span class="co">// Vertex position</span></span>
<span id="cb361-126"><a href="viewer4.html#cb361-126"></a>      <span class="at">const</span> <span class="dt">int</span> startIndex{<span class="dv">3</span> * index.vertex_index};</span>
<span id="cb361-127"><a href="viewer4.html#cb361-127"></a>      <span class="at">const</span> <span class="dt">float</span> vx{attrib.vertices.at(startIndex + <span class="dv">0</span>)};</span>
<span id="cb361-128"><a href="viewer4.html#cb361-128"></a>      <span class="at">const</span> <span class="dt">float</span> vy{attrib.vertices.at(startIndex + <span class="dv">1</span>)};</span>
<span id="cb361-129"><a href="viewer4.html#cb361-129"></a>      <span class="at">const</span> <span class="dt">float</span> vz{attrib.vertices.at(startIndex + <span class="dv">2</span>)};</span>
<span id="cb361-130"><a href="viewer4.html#cb361-130"></a></span>
<span id="cb361-131"><a href="viewer4.html#cb361-131"></a>      <span class="co">// Vertex normal</span></span>
<span id="cb361-132"><a href="viewer4.html#cb361-132"></a>      <span class="dt">float</span> nx{};</span>
<span id="cb361-133"><a href="viewer4.html#cb361-133"></a>      <span class="dt">float</span> ny{};</span>
<span id="cb361-134"><a href="viewer4.html#cb361-134"></a>      <span class="dt">float</span> nz{};</span>
<span id="cb361-135"><a href="viewer4.html#cb361-135"></a>      <span class="cf">if</span> (index.normal_index &gt;= <span class="dv">0</span>) {</span>
<span id="cb361-136"><a href="viewer4.html#cb361-136"></a>        <span class="va">m_hasNormals</span> = <span class="kw">true</span>;</span>
<span id="cb361-137"><a href="viewer4.html#cb361-137"></a>        <span class="at">const</span> <span class="dt">int</span> normalStartIndex{<span class="dv">3</span> * index.normal_index};</span>
<span id="cb361-138"><a href="viewer4.html#cb361-138"></a>        nx = attrib.normals.at(normalStartIndex + <span class="dv">0</span>);</span>
<span id="cb361-139"><a href="viewer4.html#cb361-139"></a>        ny = attrib.normals.at(normalStartIndex + <span class="dv">1</span>);</span>
<span id="cb361-140"><a href="viewer4.html#cb361-140"></a>        nz = attrib.normals.at(normalStartIndex + <span class="dv">2</span>);</span>
<span id="cb361-141"><a href="viewer4.html#cb361-141"></a>      }</span>
<span id="cb361-142"><a href="viewer4.html#cb361-142"></a></span>
<span id="cb361-143"><a href="viewer4.html#cb361-143"></a>      <span class="co">// Vertex texture coordinates</span></span>
<span id="cb361-144"><a href="viewer4.html#cb361-144"></a>      <span class="dt">float</span> tu{};</span>
<span id="cb361-145"><a href="viewer4.html#cb361-145"></a>      <span class="dt">float</span> tv{};</span>
<span id="cb361-146"><a href="viewer4.html#cb361-146"></a>      <span class="cf">if</span> (index.texcoord_index &gt;= <span class="dv">0</span>) {</span>
<span id="cb361-147"><a href="viewer4.html#cb361-147"></a>        <span class="va">m_hasTexCoords</span> = <span class="kw">true</span>;</span>
<span id="cb361-148"><a href="viewer4.html#cb361-148"></a>        <span class="at">const</span> <span class="dt">int</span> texCoordsStartIndex{<span class="dv">2</span> * index.texcoord_index};</span>
<span id="cb361-149"><a href="viewer4.html#cb361-149"></a>        tu = attrib.texcoords.at(texCoordsStartIndex + <span class="dv">0</span>);</span>
<span id="cb361-150"><a href="viewer4.html#cb361-150"></a>        tv = attrib.texcoords.at(texCoordsStartIndex + <span class="dv">1</span>);</span>
<span id="cb361-151"><a href="viewer4.html#cb361-151"></a>      }</span>
<span id="cb361-152"><a href="viewer4.html#cb361-152"></a></span>
<span id="cb361-153"><a href="viewer4.html#cb361-153"></a>      Vertex vertex{};</span>
<span id="cb361-154"><a href="viewer4.html#cb361-154"></a>      vertex.position = {vx, vy, vz};</span>
<span id="cb361-155"><a href="viewer4.html#cb361-155"></a>      vertex.normal = {nx, ny, nz};</span>
<span id="cb361-156"><a href="viewer4.html#cb361-156"></a>      vertex.texCoord = {tu, tv};</span>
<span id="cb361-157"><a href="viewer4.html#cb361-157"></a></span>
<span id="cb361-158"><a href="viewer4.html#cb361-158"></a>      <span class="co">// If hash doesn&#39;t contain this vertex</span></span>
<span id="cb361-159"><a href="viewer4.html#cb361-159"></a>      <span class="cf">if</span> (hash.count(vertex) == <span class="dv">0</span>) {</span>
<span id="cb361-160"><a href="viewer4.html#cb361-160"></a>        <span class="co">// Add this index (size of m_vertices)</span></span>
<span id="cb361-161"><a href="viewer4.html#cb361-161"></a>        hash[vertex] = <span class="va">m_vertices</span>.size();</span>
<span id="cb361-162"><a href="viewer4.html#cb361-162"></a>        <span class="co">// Add this vertex</span></span>
<span id="cb361-163"><a href="viewer4.html#cb361-163"></a>        <span class="va">m_vertices</span>.push_back(vertex);</span>
<span id="cb361-164"><a href="viewer4.html#cb361-164"></a>      }</span>
<span id="cb361-165"><a href="viewer4.html#cb361-165"></a></span>
<span id="cb361-166"><a href="viewer4.html#cb361-166"></a>      <span class="va">m_indices</span>.push_back(hash[vertex]);</span>
<span id="cb361-167"><a href="viewer4.html#cb361-167"></a>    }</span>
<span id="cb361-168"><a href="viewer4.html#cb361-168"></a>  }</span>
<span id="cb361-169"><a href="viewer4.html#cb361-169"></a></span>
<span id="cb361-170"><a href="viewer4.html#cb361-170"></a>  <span class="co">// Use properties of first material, if available</span></span>
<span id="cb361-171"><a href="viewer4.html#cb361-171"></a>  <span class="cf">if</span> (!materials.empty()) {</span>
<span id="cb361-172"><a href="viewer4.html#cb361-172"></a>    <span class="at">const</span> <span class="kw">auto</span>&amp; mat{materials.at(<span class="dv">0</span>)};  <span class="co">// First material</span></span>
<span id="cb361-173"><a href="viewer4.html#cb361-173"></a>    <span class="va">m_Ka</span> = glm::vec4(mat.ambient[<span class="dv">0</span>], mat.ambient[<span class="dv">1</span>], mat.ambient[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb361-174"><a href="viewer4.html#cb361-174"></a>    <span class="va">m_Kd</span> = glm::vec4(mat.diffuse[<span class="dv">0</span>], mat.diffuse[<span class="dv">1</span>], mat.diffuse[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb361-175"><a href="viewer4.html#cb361-175"></a>    <span class="va">m_Ks</span> = glm::vec4(mat.specular[<span class="dv">0</span>], mat.specular[<span class="dv">1</span>], mat.specular[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb361-176"><a href="viewer4.html#cb361-176"></a>    <span class="va">m_shininess</span> = mat.shininess;</span>
<span id="cb361-177"><a href="viewer4.html#cb361-177"></a></span>
<span id="cb361-178"><a href="viewer4.html#cb361-178"></a>    <span class="cf">if</span> (!mat.diffuse_texname.empty())</span>
<span id="cb361-179"><a href="viewer4.html#cb361-179"></a>      loadDiffuseTexture(basePath + mat.diffuse_texname);</span>
<span id="cb361-180"><a href="viewer4.html#cb361-180"></a>  } <span class="cf">else</span> {</span>
<span id="cb361-181"><a href="viewer4.html#cb361-181"></a>    <span class="co">// Default values</span></span>
<span id="cb361-182"><a href="viewer4.html#cb361-182"></a>    <span class="va">m_Ka</span> = {<span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb361-183"><a href="viewer4.html#cb361-183"></a>    <span class="va">m_Kd</span> = {<span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb361-184"><a href="viewer4.html#cb361-184"></a>    <span class="va">m_Ks</span> = {<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb361-185"><a href="viewer4.html#cb361-185"></a>    <span class="va">m_shininess</span> = <span class="fl">25.0</span><span class="bu">f</span>;</span>
<span id="cb361-186"><a href="viewer4.html#cb361-186"></a>  }</span>
<span id="cb361-187"><a href="viewer4.html#cb361-187"></a></span>
<span id="cb361-188"><a href="viewer4.html#cb361-188"></a>  <span class="cf">if</span> (standardize) {</span>
<span id="cb361-189"><a href="viewer4.html#cb361-189"></a>    <span class="kw">this</span>-&gt;standardize();</span>
<span id="cb361-190"><a href="viewer4.html#cb361-190"></a>  }</span>
<span id="cb361-191"><a href="viewer4.html#cb361-191"></a></span>
<span id="cb361-192"><a href="viewer4.html#cb361-192"></a>  <span class="cf">if</span> (!<span class="va">m_hasNormals</span>) {</span>
<span id="cb361-193"><a href="viewer4.html#cb361-193"></a>    computeNormals();</span>
<span id="cb361-194"><a href="viewer4.html#cb361-194"></a>  }</span>
<span id="cb361-195"><a href="viewer4.html#cb361-195"></a></span>
<span id="cb361-196"><a href="viewer4.html#cb361-196"></a>  createBuffers();</span>
<span id="cb361-197"><a href="viewer4.html#cb361-197"></a>}</span></code></pre></div>
<p>Note que, logo no início da função, definimos um objeto <code>readerConfig</code> (linha 87) que é utilizado como argumento de <code>ObjReader::ParseFromFile</code> da TinyObjLoader (linha 92) para informar o diretório onde estão os arquivos de materiais. Por padrão, esse caminho é o mesmo diretório onde está o arquivo OBJ:</p>
<div class="sourceCode" id="cb362" startFrom="84"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 83;"><span id="cb362-84"><a href="viewer4.html#cb362-84"></a><span class="dt">void</span> Model::loadObj(<span class="bu">std::</span>string_view path, <span class="dt">bool</span> standardize) {</span>
<span id="cb362-85"><a href="viewer4.html#cb362-85"></a>  <span class="kw">auto</span> basePath{<span class="bu">std::</span>filesystem<span class="bu">::</span>path{path}.parent_path().string() + <span class="st">&quot;/&quot;</span>};</span>
<span id="cb362-86"><a href="viewer4.html#cb362-86"></a></span>
<span id="cb362-87"><a href="viewer4.html#cb362-87"></a>  tinyobj::ObjReaderConfig readerConfig;</span>
<span id="cb362-88"><a href="viewer4.html#cb362-88"></a>  readerConfig.mtl_search_path = basePath;  <span class="co">// Path to material files</span></span>
<span id="cb362-89"><a href="viewer4.html#cb362-89"></a></span>
<span id="cb362-90"><a href="viewer4.html#cb362-90"></a>  tinyobj::ObjReader reader;</span>
<span id="cb362-91"><a href="viewer4.html#cb362-91"></a></span>
<span id="cb362-92"><a href="viewer4.html#cb362-92"></a>  <span class="cf">if</span> (!reader.ParseFromFile(path.data(), readerConfig)) {</span>
<span id="cb362-93"><a href="viewer4.html#cb362-93"></a>    <span class="cf">if</span> (!reader.Error().empty()) {</span>
<span id="cb362-94"><a href="viewer4.html#cb362-94"></a>      <span class="cf">throw</span> abcg::Exception{abcg::Exception::Runtime(</span>
<span id="cb362-95"><a href="viewer4.html#cb362-95"></a>          fmt::format(<span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st"> (</span><span class="sc">{}</span><span class="st">)&quot;</span>, path, reader.Error()))};</span>
<span id="cb362-96"><a href="viewer4.html#cb362-96"></a>    }</span>
<span id="cb362-97"><a href="viewer4.html#cb362-97"></a>    <span class="cf">throw</span> abcg::Exception{</span>
<span id="cb362-98"><a href="viewer4.html#cb362-98"></a>        abcg::Exception::Runtime(fmt::format(<span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st">&quot;</span>, path))};</span>
<span id="cb362-99"><a href="viewer4.html#cb362-99"></a>  }</span></code></pre></div>
<p>Nas linhas 170 a 186, as propriedades do primeiro material são utilizadas. Se não houver nenhum material, valores padrão são utilizados:</p>
<div class="sourceCode" id="cb363" startFrom="170"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 169;"><span id="cb363-170"><a href="viewer4.html#cb363-170"></a>  <span class="co">// Use properties of first material, if available</span></span>
<span id="cb363-171"><a href="viewer4.html#cb363-171"></a>  <span class="cf">if</span> (!materials.empty()) {</span>
<span id="cb363-172"><a href="viewer4.html#cb363-172"></a>    <span class="at">const</span> <span class="kw">auto</span>&amp; mat{materials.at(<span class="dv">0</span>)};  <span class="co">// First material</span></span>
<span id="cb363-173"><a href="viewer4.html#cb363-173"></a>    <span class="va">m_Ka</span> = glm::vec4(mat.ambient[<span class="dv">0</span>], mat.ambient[<span class="dv">1</span>], mat.ambient[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb363-174"><a href="viewer4.html#cb363-174"></a>    <span class="va">m_Kd</span> = glm::vec4(mat.diffuse[<span class="dv">0</span>], mat.diffuse[<span class="dv">1</span>], mat.diffuse[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb363-175"><a href="viewer4.html#cb363-175"></a>    <span class="va">m_Ks</span> = glm::vec4(mat.specular[<span class="dv">0</span>], mat.specular[<span class="dv">1</span>], mat.specular[<span class="dv">2</span>], <span class="dv">1</span>);</span>
<span id="cb363-176"><a href="viewer4.html#cb363-176"></a>    <span class="va">m_shininess</span> = mat.shininess;</span>
<span id="cb363-177"><a href="viewer4.html#cb363-177"></a></span>
<span id="cb363-178"><a href="viewer4.html#cb363-178"></a>    <span class="cf">if</span> (!mat.diffuse_texname.empty())</span>
<span id="cb363-179"><a href="viewer4.html#cb363-179"></a>      loadDiffuseTexture(basePath + mat.diffuse_texname);</span>
<span id="cb363-180"><a href="viewer4.html#cb363-180"></a>  } <span class="cf">else</span> {</span>
<span id="cb363-181"><a href="viewer4.html#cb363-181"></a>    <span class="co">// Default values</span></span>
<span id="cb363-182"><a href="viewer4.html#cb363-182"></a>    <span class="va">m_Ka</span> = {<span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">0.1</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb363-183"><a href="viewer4.html#cb363-183"></a>    <span class="va">m_Kd</span> = {<span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">0.7</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb363-184"><a href="viewer4.html#cb363-184"></a>    <span class="va">m_Ks</span> = {<span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>, <span class="fl">1.0</span><span class="bu">f</span>};</span>
<span id="cb363-185"><a href="viewer4.html#cb363-185"></a>    <span class="va">m_shininess</span> = <span class="fl">25.0</span><span class="bu">f</span>;</span>
<span id="cb363-186"><a href="viewer4.html#cb363-186"></a>  }</span></code></pre></div>
<p>Durante a leitura dos atributos dos vértices, <code>Model::loadObj</code> também verifica se a malha contém coordenadas de textura. Isso é feito nas linhas 143 a 151:</p>
<div class="sourceCode" id="cb364" startFrom="143"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 142;"><span id="cb364-143"><a href="viewer4.html#cb364-143"></a>      <span class="co">// Vertex texture coordinates</span></span>
<span id="cb364-144"><a href="viewer4.html#cb364-144"></a>      <span class="dt">float</span> tu{};</span>
<span id="cb364-145"><a href="viewer4.html#cb364-145"></a>      <span class="dt">float</span> tv{};</span>
<span id="cb364-146"><a href="viewer4.html#cb364-146"></a>      <span class="cf">if</span> (index.texcoord_index &gt;= <span class="dv">0</span>) {</span>
<span id="cb364-147"><a href="viewer4.html#cb364-147"></a>        <span class="va">m_hasTexCoords</span> = <span class="kw">true</span>;</span>
<span id="cb364-148"><a href="viewer4.html#cb364-148"></a>        <span class="at">const</span> <span class="dt">int</span> texCoordsStartIndex{<span class="dv">2</span> * index.texcoord_index};</span>
<span id="cb364-149"><a href="viewer4.html#cb364-149"></a>        tu = attrib.texcoords.at(texCoordsStartIndex + <span class="dv">0</span>);</span>
<span id="cb364-150"><a href="viewer4.html#cb364-150"></a>        tv = attrib.texcoords.at(texCoordsStartIndex + <span class="dv">1</span>);</span>
<span id="cb364-151"><a href="viewer4.html#cb364-151"></a>      }</span></code></pre></div>
<p>Se o vértice contém coordenadas de textura (linha 146), o flag <code>m_hasTexCoords</code> é definido como <code>true</code> e as coordenadas são carregadas em <code>tu</code> e <code>tv</code>. Se o arquivo OBJ não tiver coordenadas de textura, <code>tu</code> e <code>tv</code> serão zero para todos os vértices.</p>
<p>A estrutura <code>Vertex</code> é criada com o novo atributo de coordenadas de textura:</p>
<div class="sourceCode" id="cb365" startFrom="153"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 152;"><span id="cb365-153"><a href="viewer4.html#cb365-153"></a>      Vertex vertex{};</span>
<span id="cb365-154"><a href="viewer4.html#cb365-154"></a>      vertex.position = {vx, vy, vz};</span>
<span id="cb365-155"><a href="viewer4.html#cb365-155"></a>      vertex.normal = {nx, ny, nz};</span>
<span id="cb365-156"><a href="viewer4.html#cb365-156"></a>      vertex.texCoord = {tu, tv};</span></code></pre></div>
<p><code>texCoord</code> é um novo atributo de <code>Vertex</code> (um <code>glm::vec2</code>), criado de forma semelhante ao modo como criamos o atributo <code>normal</code> no projeto <code>viewer2</code> (seção <a href="viewer2.html#viewer2">9.5</a>), isto é, usamos o atributo como chave de hashing e carregamos seus dados no formato de um VBO de dados intercalados.</p>
</div>
<div id="renderizando" class="section level3 unnumbered">
<h3>Renderizando</h3>
<p>Em <code>Model::render</code> (chamado em <code>OpenGLWindow::paintGL</code>), incluímos a ativação da textura no pipeline. A definição completa ficará como a seguir:</p>
<div class="sourceCode" id="cb366" startFrom="199"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 198;"><span id="cb366-199"><a href="viewer4.html#cb366-199"></a><span class="dt">void</span> Model::render(<span class="dt">int</span> numTriangles) <span class="at">const</span> {</span>
<span id="cb366-200"><a href="viewer4.html#cb366-200"></a>  abcg::glBindVertexArray(<span class="va">m_VAO</span>);</span>
<span id="cb366-201"><a href="viewer4.html#cb366-201"></a></span>
<span id="cb366-202"><a href="viewer4.html#cb366-202"></a>  abcg::glActiveTexture(GL_TEXTURE0);</span>
<span id="cb366-203"><a href="viewer4.html#cb366-203"></a>  abcg::glBindTexture(GL_TEXTURE_2D, <span class="va">m_diffuseTexture</span>);</span>
<span id="cb366-204"><a href="viewer4.html#cb366-204"></a></span>
<span id="cb366-205"><a href="viewer4.html#cb366-205"></a>  <span class="co">// Set minification and magnification parameters</span></span>
<span id="cb366-206"><a href="viewer4.html#cb366-206"></a>  abcg::glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);</span>
<span id="cb366-207"><a href="viewer4.html#cb366-207"></a>  abcg::glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span>
<span id="cb366-208"><a href="viewer4.html#cb366-208"></a></span>
<span id="cb366-209"><a href="viewer4.html#cb366-209"></a>  <span class="co">// Set texture wrapping parameters</span></span>
<span id="cb366-210"><a href="viewer4.html#cb366-210"></a>  abcg::glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span>
<span id="cb366-211"><a href="viewer4.html#cb366-211"></a>  abcg::glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span>
<span id="cb366-212"><a href="viewer4.html#cb366-212"></a></span>
<span id="cb366-213"><a href="viewer4.html#cb366-213"></a>  <span class="at">const</span> <span class="kw">auto</span> numIndices{(numTriangles &lt; <span class="dv">0</span>) ? <span class="va">m_indices</span>.size()</span>
<span id="cb366-214"><a href="viewer4.html#cb366-214"></a>                                           : numTriangles * <span class="dv">3</span>};</span>
<span id="cb366-215"><a href="viewer4.html#cb366-215"></a></span>
<span id="cb366-216"><a href="viewer4.html#cb366-216"></a>  abcg::glDrawElements(GL_TRIANGLES, <span class="kw">static_cast</span>&lt;GLsizei&gt;(numIndices),</span>
<span id="cb366-217"><a href="viewer4.html#cb366-217"></a>                       GL_UNSIGNED_INT, <span class="kw">nullptr</span>);</span>
<span id="cb366-218"><a href="viewer4.html#cb366-218"></a></span>
<span id="cb366-219"><a href="viewer4.html#cb366-219"></a>  abcg::glBindVertexArray(<span class="dv">0</span>);</span>
<span id="cb366-220"><a href="viewer4.html#cb366-220"></a>}</span></code></pre></div>
<p>Na linha 202, a função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glActiveTexture.xhtml"><code>glActiveTexture</code></a> é chamada para ativar a primeira “unidade de textura” (<code>GL_TEXTURE0</code>). O número de unidades ativas corresponde ao número de texturas diferentes que poderão ser utilizadas ao mesmo tempo na execução do programa de shader. Podemos ativar pelo menos 80 unidades de textura no OpenGL para desktop, e 32 no OpenGL ES (usado pelo WebGL), mas o número pode ser maior dependendo da implementação do driver. Como queremos manter as coisas simples, nosso visualizador por enquanto só utilizará uma unidade de textura. Nas próximas versões veremos como usar mais unidades.</p>
<p>Após a ativação da unidade de textura, a função <code>glBindTexture</code> é chamada para ligar o identificar de textura à unidade recém ativada.</p>
<p>Nas linha 205 a 211, a função <code>glTexParameteri</code> é chamada para configurar os filtros de textura e modos de empacotamento. Os valores aqui utilizados são os valores padrão do OpenGL.</p>
<p>Isso é tudo para configurar a texturização. O restante agora é feito nos shaders. O projeto <code>viewer4</code> define dois novos shaders com suporte a texturas: <code>texture.vert</code> e <code>texture.frag</code>. Esses shaders são bem similares aos shaders do modelo de Blinn–Phong.</p>
<div class="infobox">
<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1.4em;width:1.4em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#555;overflow:visible;position:relative;"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>
<div class="infoboxtitle">
Observação
</div>
<p>Para o conteúdo de <code>assets</code> ficar mais organizado, a partir desta versão do visualizador, as texturas ficarão armazenadas em <code>assets/maps</code>, e os shaders ficarão armazenados em <code>assets/shaders</code>. Os arquivos <code>.obj</code> continuam na pasta <code>assets</code>, agora junto também com os arquivos <code>.mtl</code>.</p>
</div>
<div id="texture.vert" class="section level4 unnumbered">
<h4>texture.vert</h4>
<p>O código completo do shader é mostrado a seguir:</p>
<div class="sourceCode" id="cb367" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb367-1"><a href="viewer4.html#cb367-1"></a><span class="pp">#version 410</span></span>
<span id="cb367-2"><a href="viewer4.html#cb367-2"></a></span>
<span id="cb367-3"><a href="viewer4.html#cb367-3"></a><span class="kw">layout</span>(<span class="dt">location</span> = <span class="dv">0</span>) <span class="dt">in</span> <span class="dt">vec3</span> inPosition;</span>
<span id="cb367-4"><a href="viewer4.html#cb367-4"></a><span class="kw">layout</span>(<span class="dt">location</span> = <span class="dv">1</span>) <span class="dt">in</span> <span class="dt">vec3</span> inNormal;</span>
<span id="cb367-5"><a href="viewer4.html#cb367-5"></a><span class="kw">layout</span>(<span class="dt">location</span> = <span class="dv">2</span>) <span class="dt">in</span> <span class="dt">vec2</span> inTexCoord;</span>
<span id="cb367-6"><a href="viewer4.html#cb367-6"></a></span>
<span id="cb367-7"><a href="viewer4.html#cb367-7"></a><span class="kw">uniform</span> <span class="dt">mat4</span> modelMatrix;</span>
<span id="cb367-8"><a href="viewer4.html#cb367-8"></a><span class="kw">uniform</span> <span class="dt">mat4</span> viewMatrix;</span>
<span id="cb367-9"><a href="viewer4.html#cb367-9"></a><span class="kw">uniform</span> <span class="dt">mat4</span> projMatrix;</span>
<span id="cb367-10"><a href="viewer4.html#cb367-10"></a><span class="kw">uniform</span> <span class="dt">mat3</span> normalMatrix;</span>
<span id="cb367-11"><a href="viewer4.html#cb367-11"></a></span>
<span id="cb367-12"><a href="viewer4.html#cb367-12"></a><span class="kw">uniform</span> <span class="dt">vec4</span> lightDirWorldSpace;</span>
<span id="cb367-13"><a href="viewer4.html#cb367-13"></a></span>
<span id="cb367-14"><a href="viewer4.html#cb367-14"></a><span class="dt">out</span> <span class="dt">vec3</span> fragV;</span>
<span id="cb367-15"><a href="viewer4.html#cb367-15"></a><span class="dt">out</span> <span class="dt">vec3</span> fragL;</span>
<span id="cb367-16"><a href="viewer4.html#cb367-16"></a><span class="dt">out</span> <span class="dt">vec3</span> fragN;</span>
<span id="cb367-17"><a href="viewer4.html#cb367-17"></a><span class="dt">out</span> <span class="dt">vec2</span> fragTexCoord;</span>
<span id="cb367-18"><a href="viewer4.html#cb367-18"></a><span class="dt">out</span> <span class="dt">vec3</span> fragPObj;</span>
<span id="cb367-19"><a href="viewer4.html#cb367-19"></a><span class="dt">out</span> <span class="dt">vec3</span> fragNObj;</span>
<span id="cb367-20"><a href="viewer4.html#cb367-20"></a></span>
<span id="cb367-21"><a href="viewer4.html#cb367-21"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb367-22"><a href="viewer4.html#cb367-22"></a>  <span class="dt">vec3</span> P = (viewMatrix * modelMatrix * <span class="dt">vec4</span>(inPosition, <span class="fl">1.0</span>)).<span class="fu">xyz</span>;</span>
<span id="cb367-23"><a href="viewer4.html#cb367-23"></a>  <span class="dt">vec3</span> N = normalMatrix * inNormal;</span>
<span id="cb367-24"><a href="viewer4.html#cb367-24"></a>  <span class="dt">vec3</span> L = -(viewMatrix * lightDirWorldSpace).<span class="fu">xyz</span>;</span>
<span id="cb367-25"><a href="viewer4.html#cb367-25"></a></span>
<span id="cb367-26"><a href="viewer4.html#cb367-26"></a>  fragL = L;</span>
<span id="cb367-27"><a href="viewer4.html#cb367-27"></a>  fragV = -P;</span>
<span id="cb367-28"><a href="viewer4.html#cb367-28"></a>  fragN = N;</span>
<span id="cb367-29"><a href="viewer4.html#cb367-29"></a>  fragTexCoord = inTexCoord;</span>
<span id="cb367-30"><a href="viewer4.html#cb367-30"></a>  fragPObj = inPosition;</span>
<span id="cb367-31"><a href="viewer4.html#cb367-31"></a>  fragNObj = inNormal;</span>
<span id="cb367-32"><a href="viewer4.html#cb367-32"></a></span>
<span id="cb367-33"><a href="viewer4.html#cb367-33"></a>  <span class="bu">gl_Position</span> = projMatrix * <span class="dt">vec4</span>(P, <span class="fl">1.0</span>);</span>
<span id="cb367-34"><a href="viewer4.html#cb367-34"></a>}</span></code></pre></div>
<p>Esse código contém algumas poucas modificações em relação ao conteúdo de <code>blinnphong.vert</code>.</p>
<p>Observe como agora temos o atributo de entrada <code>inTexCoord</code> (linha 5) contendo as coordenadas de textura lidas do arquivo OBJ.</p>
<p>O vertex shader não faz nenhum processamento com as coordenadas de textura e simplesmente passa-as adiante para o fragment shader através do atributo de saída <code>fragTexCoord</code> (linha 17).</p>
<p>O vertex shader também possui dois outros atributos adicionais de saída:</p>
<ul>
<li><code>fragPObj</code> (linha 18) é a posição do vértice no espaço do objeto (isto é, uma cópia de <code>inPosition</code>);</li>
<li><code>fragNObj</code> (linha 19) é o vetor normal no espaço do objeto (isto é, uma cópia de <code>inNormal</code>).</li>
</ul>
<p>Esses atributos são utilizados para calcular, no fragment shader, as coordenadas de textura do mapeamento triplanar, cilíndrico ou esférico (o vetor normal só é utilizado no mapeamento triplanar). Se o mapeamento utilizado é aquele fornecido pelo arquivo OBJ, isto é, o mapeamento determinado pelas coordenada de textura de <code>inTexCoord</code>, então os atributos <code>fragPObj</code> e <code>fragNObj</code> não são utilizados.</p>
</div>
<div id="texture.frag" class="section level4 unnumbered">
<h4>texture.frag</h4>
<p>O código completo do shader é mostrado a seguir. Vamos analisá-lo parte por parte.</p>
<div class="sourceCode" id="cb368" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb368-1"><a href="viewer4.html#cb368-1"></a><span class="pp">#version 410</span></span>
<span id="cb368-2"><a href="viewer4.html#cb368-2"></a></span>
<span id="cb368-3"><a href="viewer4.html#cb368-3"></a><span class="dt">in</span> <span class="dt">vec3</span> fragN;</span>
<span id="cb368-4"><a href="viewer4.html#cb368-4"></a><span class="dt">in</span> <span class="dt">vec3</span> fragL;</span>
<span id="cb368-5"><a href="viewer4.html#cb368-5"></a><span class="dt">in</span> <span class="dt">vec3</span> fragV;</span>
<span id="cb368-6"><a href="viewer4.html#cb368-6"></a><span class="dt">in</span> <span class="dt">vec2</span> fragTexCoord;</span>
<span id="cb368-7"><a href="viewer4.html#cb368-7"></a><span class="dt">in</span> <span class="dt">vec3</span> fragPObj;</span>
<span id="cb368-8"><a href="viewer4.html#cb368-8"></a><span class="dt">in</span> <span class="dt">vec3</span> fragNObj;</span>
<span id="cb368-9"><a href="viewer4.html#cb368-9"></a></span>
<span id="cb368-10"><a href="viewer4.html#cb368-10"></a><span class="co">// Light properties</span></span>
<span id="cb368-11"><a href="viewer4.html#cb368-11"></a><span class="kw">uniform</span> <span class="dt">vec4</span> Ia, Id, Is;</span>
<span id="cb368-12"><a href="viewer4.html#cb368-12"></a></span>
<span id="cb368-13"><a href="viewer4.html#cb368-13"></a><span class="co">// Material properties</span></span>
<span id="cb368-14"><a href="viewer4.html#cb368-14"></a><span class="kw">uniform</span> <span class="dt">vec4</span> Ka, Kd, Ks;</span>
<span id="cb368-15"><a href="viewer4.html#cb368-15"></a><span class="kw">uniform</span> <span class="dt">float</span> shininess;</span>
<span id="cb368-16"><a href="viewer4.html#cb368-16"></a></span>
<span id="cb368-17"><a href="viewer4.html#cb368-17"></a><span class="co">// Diffuse texture sampler</span></span>
<span id="cb368-18"><a href="viewer4.html#cb368-18"></a><span class="kw">uniform</span> <span class="dt">sampler2D</span> diffuseTex;</span>
<span id="cb368-19"><a href="viewer4.html#cb368-19"></a></span>
<span id="cb368-20"><a href="viewer4.html#cb368-20"></a><span class="co">// Mapping mode</span></span>
<span id="cb368-21"><a href="viewer4.html#cb368-21"></a><span class="co">// 0: triplanar; 1: cylindrical; 2: spherical; 3: from mesh</span></span>
<span id="cb368-22"><a href="viewer4.html#cb368-22"></a><span class="kw">uniform</span> <span class="dt">int</span> mappingMode;</span>
<span id="cb368-23"><a href="viewer4.html#cb368-23"></a></span>
<span id="cb368-24"><a href="viewer4.html#cb368-24"></a><span class="dt">out</span> <span class="dt">vec4</span> outColor;</span>
<span id="cb368-25"><a href="viewer4.html#cb368-25"></a></span>
<span id="cb368-26"><a href="viewer4.html#cb368-26"></a><span class="co">// Blinn-Phong reflection model</span></span>
<span id="cb368-27"><a href="viewer4.html#cb368-27"></a><span class="dt">vec4</span> <span class="fu">BlinnPhong</span>(<span class="dt">vec3</span> N, <span class="dt">vec3</span> L, <span class="dt">vec3</span> V, <span class="dt">vec2</span> texCoord) {</span>
<span id="cb368-28"><a href="viewer4.html#cb368-28"></a>  N = <span class="bu">normalize</span>(N);</span>
<span id="cb368-29"><a href="viewer4.html#cb368-29"></a>  L = <span class="bu">normalize</span>(L);</span>
<span id="cb368-30"><a href="viewer4.html#cb368-30"></a></span>
<span id="cb368-31"><a href="viewer4.html#cb368-31"></a>  <span class="co">// Compute lambertian term</span></span>
<span id="cb368-32"><a href="viewer4.html#cb368-32"></a>  <span class="dt">float</span> lambertian = <span class="bu">max</span>(<span class="bu">dot</span>(N, L), <span class="fl">0.0</span>);</span>
<span id="cb368-33"><a href="viewer4.html#cb368-33"></a></span>
<span id="cb368-34"><a href="viewer4.html#cb368-34"></a>  <span class="co">// Compute specular term</span></span>
<span id="cb368-35"><a href="viewer4.html#cb368-35"></a>  <span class="dt">float</span> specular = <span class="fl">0.0</span>;</span>
<span id="cb368-36"><a href="viewer4.html#cb368-36"></a>  <span class="kw">if</span> (lambertian &gt; <span class="fl">0.0</span>) {</span>
<span id="cb368-37"><a href="viewer4.html#cb368-37"></a>    V = <span class="bu">normalize</span>(V);</span>
<span id="cb368-38"><a href="viewer4.html#cb368-38"></a>    <span class="dt">vec3</span> H = <span class="bu">normalize</span>(L + V);</span>
<span id="cb368-39"><a href="viewer4.html#cb368-39"></a>    <span class="dt">float</span> angle = <span class="bu">max</span>(<span class="bu">dot</span>(H, N), <span class="fl">0.0</span>);</span>
<span id="cb368-40"><a href="viewer4.html#cb368-40"></a>    specular = <span class="bu">pow</span>(angle, shininess);</span>
<span id="cb368-41"><a href="viewer4.html#cb368-41"></a>  }</span>
<span id="cb368-42"><a href="viewer4.html#cb368-42"></a></span>
<span id="cb368-43"><a href="viewer4.html#cb368-43"></a>  <span class="dt">vec4</span> map_Kd = <span class="bu">texture</span>(diffuseTex, texCoord);</span>
<span id="cb368-44"><a href="viewer4.html#cb368-44"></a>  <span class="dt">vec4</span> map_Ka = map_Kd;</span>
<span id="cb368-45"><a href="viewer4.html#cb368-45"></a></span>
<span id="cb368-46"><a href="viewer4.html#cb368-46"></a>  <span class="dt">vec4</span> diffuseColor = map_Kd * Kd * Id * lambertian;</span>
<span id="cb368-47"><a href="viewer4.html#cb368-47"></a>  <span class="dt">vec4</span> specularColor = Ks * Is * specular;</span>
<span id="cb368-48"><a href="viewer4.html#cb368-48"></a>  <span class="dt">vec4</span> ambientColor = map_Ka * Ka * Ia;</span>
<span id="cb368-49"><a href="viewer4.html#cb368-49"></a></span>
<span id="cb368-50"><a href="viewer4.html#cb368-50"></a>  <span class="kw">return</span> ambientColor + diffuseColor + specularColor;</span>
<span id="cb368-51"><a href="viewer4.html#cb368-51"></a>}</span>
<span id="cb368-52"><a href="viewer4.html#cb368-52"></a></span>
<span id="cb368-53"><a href="viewer4.html#cb368-53"></a><span class="co">// Planar mapping</span></span>
<span id="cb368-54"><a href="viewer4.html#cb368-54"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingX</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> <span class="dt">vec2</span>(<span class="fl">1.0</span> - P.<span class="fu">z</span>, P.<span class="fu">y</span>); }</span>
<span id="cb368-55"><a href="viewer4.html#cb368-55"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingY</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> <span class="dt">vec2</span>(P.<span class="fu">x</span>, <span class="fl">1.0</span> - P.<span class="fu">z</span>); }</span>
<span id="cb368-56"><a href="viewer4.html#cb368-56"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingZ</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> P.<span class="fu">xy</span>; }</span>
<span id="cb368-57"><a href="viewer4.html#cb368-57"></a></span>
<span id="cb368-58"><a href="viewer4.html#cb368-58"></a><span class="pp">#define PI 3.14159265358979323846</span></span>
<span id="cb368-59"><a href="viewer4.html#cb368-59"></a></span>
<span id="cb368-60"><a href="viewer4.html#cb368-60"></a><span class="co">// Cylindrical mapping</span></span>
<span id="cb368-61"><a href="viewer4.html#cb368-61"></a><span class="dt">vec2</span> <span class="fu">CylindricalMapping</span>(<span class="dt">vec3</span> P) {</span>
<span id="cb368-62"><a href="viewer4.html#cb368-62"></a>  <span class="dt">float</span> longitude = <span class="bu">atan</span>(P.<span class="fu">x</span>, P.<span class="fu">z</span>);</span>
<span id="cb368-63"><a href="viewer4.html#cb368-63"></a>  <span class="dt">float</span> height = P.<span class="fu">y</span>;</span>
<span id="cb368-64"><a href="viewer4.html#cb368-64"></a></span>
<span id="cb368-65"><a href="viewer4.html#cb368-65"></a>  <span class="dt">float</span> u = longitude / (<span class="fl">2.0</span> * PI) + <span class="fl">0.5</span>;  <span class="co">// From [-pi, pi] to [0, 1]</span></span>
<span id="cb368-66"><a href="viewer4.html#cb368-66"></a>  <span class="dt">float</span> v = height - <span class="fl">0.5</span>;                  <span class="co">// Base at y = -0.5</span></span>
<span id="cb368-67"><a href="viewer4.html#cb368-67"></a></span>
<span id="cb368-68"><a href="viewer4.html#cb368-68"></a>  <span class="kw">return</span> <span class="dt">vec2</span>(u, v);</span>
<span id="cb368-69"><a href="viewer4.html#cb368-69"></a>}</span>
<span id="cb368-70"><a href="viewer4.html#cb368-70"></a></span>
<span id="cb368-71"><a href="viewer4.html#cb368-71"></a><span class="co">// Spherical mapping</span></span>
<span id="cb368-72"><a href="viewer4.html#cb368-72"></a><span class="dt">vec2</span> <span class="fu">SphericalMapping</span>(<span class="dt">vec3</span> P) {</span>
<span id="cb368-73"><a href="viewer4.html#cb368-73"></a>  <span class="dt">float</span> longitude = <span class="bu">atan</span>(P.<span class="fu">x</span>, P.<span class="fu">z</span>);</span>
<span id="cb368-74"><a href="viewer4.html#cb368-74"></a>  <span class="dt">float</span> latitude = <span class="bu">asin</span>(P.<span class="fu">y</span> / <span class="bu">length</span>(P));</span>
<span id="cb368-75"><a href="viewer4.html#cb368-75"></a></span>
<span id="cb368-76"><a href="viewer4.html#cb368-76"></a>  <span class="dt">float</span> u = longitude / (<span class="fl">2.0</span> * PI) + <span class="fl">0.5</span>;  <span class="co">// From [-pi, pi] to [0, 1]</span></span>
<span id="cb368-77"><a href="viewer4.html#cb368-77"></a>  <span class="dt">float</span> v = latitude / PI + <span class="fl">0.5</span>;           <span class="co">// From [-pi/2, pi/2] to [0, 1]</span></span>
<span id="cb368-78"><a href="viewer4.html#cb368-78"></a></span>
<span id="cb368-79"><a href="viewer4.html#cb368-79"></a>  <span class="kw">return</span> <span class="dt">vec2</span>(u, v);</span>
<span id="cb368-80"><a href="viewer4.html#cb368-80"></a>}</span>
<span id="cb368-81"><a href="viewer4.html#cb368-81"></a></span>
<span id="cb368-82"><a href="viewer4.html#cb368-82"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb368-83"><a href="viewer4.html#cb368-83"></a>  <span class="dt">vec4</span> color;</span>
<span id="cb368-84"><a href="viewer4.html#cb368-84"></a></span>
<span id="cb368-85"><a href="viewer4.html#cb368-85"></a>  <span class="kw">if</span> (mappingMode == <span class="dv">0</span>) {</span>
<span id="cb368-86"><a href="viewer4.html#cb368-86"></a>    <span class="co">// Triplanar mapping</span></span>
<span id="cb368-87"><a href="viewer4.html#cb368-87"></a></span>
<span id="cb368-88"><a href="viewer4.html#cb368-88"></a>    <span class="co">// Sample with x planar mapping</span></span>
<span id="cb368-89"><a href="viewer4.html#cb368-89"></a>    <span class="dt">vec2</span> texCoord1 = <span class="fu">PlanarMappingX</span>(fragPObj);</span>
<span id="cb368-90"><a href="viewer4.html#cb368-90"></a>    <span class="dt">vec4</span> color1 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord1);</span>
<span id="cb368-91"><a href="viewer4.html#cb368-91"></a></span>
<span id="cb368-92"><a href="viewer4.html#cb368-92"></a>    <span class="co">// Sample with y planar mapping</span></span>
<span id="cb368-93"><a href="viewer4.html#cb368-93"></a>    <span class="dt">vec2</span> texCoord2 = <span class="fu">PlanarMappingY</span>(fragPObj);</span>
<span id="cb368-94"><a href="viewer4.html#cb368-94"></a>    <span class="dt">vec4</span> color2 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord2);</span>
<span id="cb368-95"><a href="viewer4.html#cb368-95"></a></span>
<span id="cb368-96"><a href="viewer4.html#cb368-96"></a>    <span class="co">// Sample with z planar mapping</span></span>
<span id="cb368-97"><a href="viewer4.html#cb368-97"></a>    <span class="dt">vec2</span> texCoord3 = <span class="fu">PlanarMappingZ</span>(fragPObj);</span>
<span id="cb368-98"><a href="viewer4.html#cb368-98"></a>    <span class="dt">vec4</span> color3 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord3);</span>
<span id="cb368-99"><a href="viewer4.html#cb368-99"></a></span>
<span id="cb368-100"><a href="viewer4.html#cb368-100"></a>    <span class="co">// Compute average based on normal</span></span>
<span id="cb368-101"><a href="viewer4.html#cb368-101"></a>    <span class="dt">vec3</span> weight = <span class="bu">abs</span>(<span class="bu">normalize</span>(fragNObj));</span>
<span id="cb368-102"><a href="viewer4.html#cb368-102"></a>    color = color1 * weight.<span class="fu">x</span> + color2 * weight.<span class="fu">y</span> + color3 * weight.<span class="fu">z</span>;</span>
<span id="cb368-103"><a href="viewer4.html#cb368-103"></a>  } <span class="kw">else</span> {</span>
<span id="cb368-104"><a href="viewer4.html#cb368-104"></a>    <span class="dt">vec2</span> texCoord;</span>
<span id="cb368-105"><a href="viewer4.html#cb368-105"></a>    <span class="kw">if</span> (mappingMode == <span class="dv">1</span>) {</span>
<span id="cb368-106"><a href="viewer4.html#cb368-106"></a>      <span class="co">// Cylindrical mapping</span></span>
<span id="cb368-107"><a href="viewer4.html#cb368-107"></a>      texCoord = <span class="fu">CylindricalMapping</span>(fragPObj);</span>
<span id="cb368-108"><a href="viewer4.html#cb368-108"></a>    } <span class="kw">else</span> <span class="kw">if</span> (mappingMode == <span class="dv">2</span>) {</span>
<span id="cb368-109"><a href="viewer4.html#cb368-109"></a>      <span class="co">// Spherical mapping</span></span>
<span id="cb368-110"><a href="viewer4.html#cb368-110"></a>      texCoord = <span class="fu">SphericalMapping</span>(fragPObj);</span>
<span id="cb368-111"><a href="viewer4.html#cb368-111"></a>    } <span class="kw">else</span> <span class="kw">if</span> (mappingMode == <span class="dv">3</span>) {</span>
<span id="cb368-112"><a href="viewer4.html#cb368-112"></a>      <span class="co">// From mesh</span></span>
<span id="cb368-113"><a href="viewer4.html#cb368-113"></a>      texCoord = fragTexCoord;</span>
<span id="cb368-114"><a href="viewer4.html#cb368-114"></a>    }</span>
<span id="cb368-115"><a href="viewer4.html#cb368-115"></a>    color = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord);</span>
<span id="cb368-116"><a href="viewer4.html#cb368-116"></a>  }</span>
<span id="cb368-117"><a href="viewer4.html#cb368-117"></a></span>
<span id="cb368-118"><a href="viewer4.html#cb368-118"></a>  <span class="kw">if</span> (<span class="bu">gl_FrontFacing</span>) {</span>
<span id="cb368-119"><a href="viewer4.html#cb368-119"></a>    outColor = color;</span>
<span id="cb368-120"><a href="viewer4.html#cb368-120"></a>  } <span class="kw">else</span> {</span>
<span id="cb368-121"><a href="viewer4.html#cb368-121"></a>    <span class="dt">float</span> i = (color.<span class="fu">r</span> + color.<span class="fu">g</span> + color.<span class="fu">b</span>) / <span class="fl">3.0</span>;</span>
<span id="cb368-122"><a href="viewer4.html#cb368-122"></a>    outColor = <span class="dt">vec4</span>(i, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.0</span>);</span>
<span id="cb368-123"><a href="viewer4.html#cb368-123"></a>  }</span>
<span id="cb368-124"><a href="viewer4.html#cb368-124"></a>}</span></code></pre></div>
<p>A primeira mudança em relação ao shader <code>blinnphong.frag</code> é o número de atributos de entrada, que agora inclui os atributos <code>fragTexCoord</code>, <code>fragPObj</code> e <code>fragNObj</code> da saída do vertex shader:</p>
<div class="sourceCode" id="cb369" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb369-1"><a href="viewer4.html#cb369-1"></a><span class="dt">in</span> <span class="dt">vec3</span> fragN;</span>
<span id="cb369-2"><a href="viewer4.html#cb369-2"></a><span class="dt">in</span> <span class="dt">vec3</span> fragL;</span>
<span id="cb369-3"><a href="viewer4.html#cb369-3"></a><span class="dt">in</span> <span class="dt">vec3</span> fragV;</span>
<span id="cb369-4"><a href="viewer4.html#cb369-4"></a><span class="dt">in</span> <span class="dt">vec2</span> fragTexCoord;</span>
<span id="cb369-5"><a href="viewer4.html#cb369-5"></a><span class="dt">in</span> <span class="dt">vec3</span> fragPObj;</span>
<span id="cb369-6"><a href="viewer4.html#cb369-6"></a><span class="dt">in</span> <span class="dt">vec3</span> fragNObj;</span></code></pre></div>
<p>Há também duas novas variáveis uniformes:</p>
<div class="sourceCode" id="cb370" startFrom="17"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 16;"><span id="cb370-17"><a href="viewer4.html#cb370-17"></a><span class="co">// Diffuse texture sampler</span></span>
<span id="cb370-18"><a href="viewer4.html#cb370-18"></a><span class="kw">uniform</span> <span class="dt">sampler2D</span> diffuseTex;</span>
<span id="cb370-19"><a href="viewer4.html#cb370-19"></a></span>
<span id="cb370-20"><a href="viewer4.html#cb370-20"></a><span class="co">// Mapping mode</span></span>
<span id="cb370-21"><a href="viewer4.html#cb370-21"></a><span class="co">// 0: triplanar; 1: cylindrical; 2: spherical; 3: from mesh</span></span>
<span id="cb370-22"><a href="viewer4.html#cb370-22"></a><span class="kw">uniform</span> <span class="dt">int</span> mappingMode;</span></code></pre></div>
<ul>
<li><code>diffuseTex</code> é um <strong>amostrador de textura 2D</strong> (<code>sampler2D</code>) que acessa a primeira unidade de textura (<code>GL_TEXTURE0</code>) ativada com <code>glActiveTexture</code> em <code>Model::render</code>. É através desse amostrador que acessamos os texels da textura difusa.</li>
<li><code>mappingMode</code> é um inteiro que identifica o modo de mapeamento escolhido pelo usuário. Esse valor é determinado pelo índice da caixa de combinação “UV mapping” da ImGui. O padrão é <code>3</code> para arquivos OBJ que possuem coordenadas de textura, e <code>0</code> quando as coordenadas de textura não foram encontradas.</li>
</ul>
<div class="notebox">
<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1.4em;width:1.4em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1f5386;overflow:visible;position:relative;"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>
<div class="noteboxtitle">
Importante
</div>
<p>O pipeline associa <code>diffuseTex</code> à unidade de textura <code>GL_TEXTURE0</code> pois o valor dessa variável uniforme é definido como <code>0</code> no código em C++. Isso é feito na linha 108 de <code>OpenGLWindow::paintGL</code> junto com a definição das outras variáveis uniformes:</p>
<div class="sourceCode" id="cb371" startFrom="101"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 100;"><span id="cb371-101"><a href="viewer4.html#cb371-101"></a>  <span class="at">const</span> GLint diffuseTexLoc{abcg::glGetUniformLocation(program, <span class="st">&quot;diffuseTex&quot;</span>)};</span>
<span id="cb371-102"><a href="viewer4.html#cb371-102"></a>  <span class="at">const</span> GLint mappingModeLoc{</span>
<span id="cb371-103"><a href="viewer4.html#cb371-103"></a>      abcg::glGetUniformLocation(program, <span class="st">&quot;mappingMode&quot;</span>)};</span>
<span id="cb371-104"><a href="viewer4.html#cb371-104"></a></span>
<span id="cb371-105"><a href="viewer4.html#cb371-105"></a>  <span class="co">// Set uniform variables used by every scene object</span></span>
<span id="cb371-106"><a href="viewer4.html#cb371-106"></a>  abcg::glUniformMatrix4fv(viewMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_viewMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb371-107"><a href="viewer4.html#cb371-107"></a>  abcg::glUniformMatrix4fv(projMatrixLoc, <span class="dv">1</span>, GL_FALSE, &amp;<span class="va">m_projMatrix</span>[<span class="dv">0</span>][<span class="dv">0</span>]);</span>
<span id="cb371-108"><a href="viewer4.html#cb371-108"></a>  abcg::glUniform1i(diffuseTexLoc, <span class="dv">0</span>);</span>
<span id="cb371-109"><a href="viewer4.html#cb371-109"></a>  abcg::glUniform1i(mappingModeLoc, <span class="va">m_mappingMode</span>);</span></code></pre></div>
</div>
<p>A definição da função <code>BlinnPhong</code> é ligeiramente diferente daquela do shader <code>blinnphong.frag</code>:</p>
<div class="sourceCode" id="cb372" startFrom="26"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 25;"><span id="cb372-26"><a href="viewer4.html#cb372-26"></a><span class="co">// Blinn-Phong reflection model</span></span>
<span id="cb372-27"><a href="viewer4.html#cb372-27"></a><span class="dt">vec4</span> <span class="fu">BlinnPhong</span>(<span class="dt">vec3</span> N, <span class="dt">vec3</span> L, <span class="dt">vec3</span> V, <span class="dt">vec2</span> texCoord) {</span>
<span id="cb372-28"><a href="viewer4.html#cb372-28"></a>  N = <span class="bu">normalize</span>(N);</span>
<span id="cb372-29"><a href="viewer4.html#cb372-29"></a>  L = <span class="bu">normalize</span>(L);</span>
<span id="cb372-30"><a href="viewer4.html#cb372-30"></a></span>
<span id="cb372-31"><a href="viewer4.html#cb372-31"></a>  <span class="co">// Compute lambertian term</span></span>
<span id="cb372-32"><a href="viewer4.html#cb372-32"></a>  <span class="dt">float</span> lambertian = <span class="bu">max</span>(<span class="bu">dot</span>(N, L), <span class="fl">0.0</span>);</span>
<span id="cb372-33"><a href="viewer4.html#cb372-33"></a></span>
<span id="cb372-34"><a href="viewer4.html#cb372-34"></a>  <span class="co">// Compute specular term</span></span>
<span id="cb372-35"><a href="viewer4.html#cb372-35"></a>  <span class="dt">float</span> specular = <span class="fl">0.0</span>;</span>
<span id="cb372-36"><a href="viewer4.html#cb372-36"></a>  <span class="kw">if</span> (lambertian &gt; <span class="fl">0.0</span>) {</span>
<span id="cb372-37"><a href="viewer4.html#cb372-37"></a>    V = <span class="bu">normalize</span>(V);</span>
<span id="cb372-38"><a href="viewer4.html#cb372-38"></a>    <span class="dt">vec3</span> H = <span class="bu">normalize</span>(L + V);</span>
<span id="cb372-39"><a href="viewer4.html#cb372-39"></a>    <span class="dt">float</span> angle = <span class="bu">max</span>(<span class="bu">dot</span>(H, N), <span class="fl">0.0</span>);</span>
<span id="cb372-40"><a href="viewer4.html#cb372-40"></a>    specular = <span class="bu">pow</span>(angle, shininess);</span>
<span id="cb372-41"><a href="viewer4.html#cb372-41"></a>  }</span>
<span id="cb372-42"><a href="viewer4.html#cb372-42"></a></span>
<span id="cb372-43"><a href="viewer4.html#cb372-43"></a>  <span class="dt">vec4</span> map_Kd = <span class="bu">texture</span>(diffuseTex, texCoord);</span>
<span id="cb372-44"><a href="viewer4.html#cb372-44"></a>  <span class="dt">vec4</span> map_Ka = map_Kd;</span>
<span id="cb372-45"><a href="viewer4.html#cb372-45"></a></span>
<span id="cb372-46"><a href="viewer4.html#cb372-46"></a>  <span class="dt">vec4</span> diffuseColor = map_Kd * Kd * Id * lambertian;</span>
<span id="cb372-47"><a href="viewer4.html#cb372-47"></a>  <span class="dt">vec4</span> specularColor = Ks * Is * specular;</span>
<span id="cb372-48"><a href="viewer4.html#cb372-48"></a>  <span class="dt">vec4</span> ambientColor = map_Ka * Ka * Ia;</span>
<span id="cb372-49"><a href="viewer4.html#cb372-49"></a></span>
<span id="cb372-50"><a href="viewer4.html#cb372-50"></a>  <span class="kw">return</span> ambientColor + diffuseColor + specularColor;</span>
<span id="cb372-51"><a href="viewer4.html#cb372-51"></a>}</span></code></pre></div>
<p>Agora, a função tem o parâmetro adicional de coordenadas de textura <code>texCoord</code> (linha 27).</p>
<p>Até a linha 41, o código é igual ao anterior.</p>
<p>A linha 43 contém o código utilizado para amostrar a textura difusa. A função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/texture.xhtml"><code>texture</code></a> recebe como argumentos o amostrador de textura (<code>diffuseTex</code>) e as coordenadas de textura (<code>texCoord</code>). O resultado é a cor RGBA amostrada na posição dada, usando o modo de filtragem e modo de empacotamento definidos pelo código C++ antes da renderização.</p>
<p>Como estamos amostrando uma textura difusa, a cor da textura (<code>map_Kd</code>) é multiplicada por <code>Kd * Id * lambertian</code> para compor a componente difusa final (linha 46).</p>
<p>Também criamos uma cor ambiente <code>map_Ka</code> (linha 44) que multiplica as componentes de reflexão ambiente (linha 48). Nesse caso, consideramos que <code>map_Ka</code> é igual a <code>map_Kd</code>, pois geralmente é esse o caso (a textura difusa é também a textura ambiente). Entretanto, é possível que um material defina uma textura diferente para a componente ambiente. Nesse caso teríamos de mudar o shader para incluir um outro amostrador específico para <code>map_Ka</code>.</p>
<p>Além da função <code>BlinnPhong</code>, o shader também define as funções de geração de coordenadas de textura usando mapeamento planar (<code>PlanarMappingX</code>, <code>PlanarMappingY</code>, <code>PlanarMappingZ</code>), cilíndrico (<code>CylindricalMapping</code>) e esférico (<code>SphericalMapping</code>):</p>
<div class="sourceCode" id="cb373" startFrom="53"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 52;"><span id="cb373-53"><a href="viewer4.html#cb373-53"></a><span class="co">// Planar mapping</span></span>
<span id="cb373-54"><a href="viewer4.html#cb373-54"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingX</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> <span class="dt">vec2</span>(<span class="fl">1.0</span> - P.<span class="fu">z</span>, P.<span class="fu">y</span>); }</span>
<span id="cb373-55"><a href="viewer4.html#cb373-55"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingY</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> <span class="dt">vec2</span>(P.<span class="fu">x</span>, <span class="fl">1.0</span> - P.<span class="fu">z</span>); }</span>
<span id="cb373-56"><a href="viewer4.html#cb373-56"></a><span class="dt">vec2</span> <span class="fu">PlanarMappingZ</span>(<span class="dt">vec3</span> P) { <span class="kw">return</span> P.<span class="fu">xy</span>; }</span>
<span id="cb373-57"><a href="viewer4.html#cb373-57"></a></span>
<span id="cb373-58"><a href="viewer4.html#cb373-58"></a><span class="pp">#define PI 3.14159265358979323846</span></span>
<span id="cb373-59"><a href="viewer4.html#cb373-59"></a></span>
<span id="cb373-60"><a href="viewer4.html#cb373-60"></a><span class="co">// Cylindrical mapping</span></span>
<span id="cb373-61"><a href="viewer4.html#cb373-61"></a><span class="dt">vec2</span> <span class="fu">CylindricalMapping</span>(<span class="dt">vec3</span> P) {</span>
<span id="cb373-62"><a href="viewer4.html#cb373-62"></a>  <span class="dt">float</span> longitude = <span class="bu">atan</span>(P.<span class="fu">x</span>, P.<span class="fu">z</span>);</span>
<span id="cb373-63"><a href="viewer4.html#cb373-63"></a>  <span class="dt">float</span> height = P.<span class="fu">y</span>;</span>
<span id="cb373-64"><a href="viewer4.html#cb373-64"></a></span>
<span id="cb373-65"><a href="viewer4.html#cb373-65"></a>  <span class="dt">float</span> u = longitude / (<span class="fl">2.0</span> * PI) + <span class="fl">0.5</span>;  <span class="co">// From [-pi, pi] to [0, 1]</span></span>
<span id="cb373-66"><a href="viewer4.html#cb373-66"></a>  <span class="dt">float</span> v = height - <span class="fl">0.5</span>;                  <span class="co">// Base at y = -0.5</span></span>
<span id="cb373-67"><a href="viewer4.html#cb373-67"></a></span>
<span id="cb373-68"><a href="viewer4.html#cb373-68"></a>  <span class="kw">return</span> <span class="dt">vec2</span>(u, v);</span>
<span id="cb373-69"><a href="viewer4.html#cb373-69"></a>}</span>
<span id="cb373-70"><a href="viewer4.html#cb373-70"></a></span>
<span id="cb373-71"><a href="viewer4.html#cb373-71"></a><span class="co">// Spherical mapping</span></span>
<span id="cb373-72"><a href="viewer4.html#cb373-72"></a><span class="dt">vec2</span> <span class="fu">SphericalMapping</span>(<span class="dt">vec3</span> P) {</span>
<span id="cb373-73"><a href="viewer4.html#cb373-73"></a>  <span class="dt">float</span> longitude = <span class="bu">atan</span>(P.<span class="fu">x</span>, P.<span class="fu">z</span>);</span>
<span id="cb373-74"><a href="viewer4.html#cb373-74"></a>  <span class="dt">float</span> latitude = <span class="bu">asin</span>(P.<span class="fu">y</span> / <span class="bu">length</span>(P));</span>
<span id="cb373-75"><a href="viewer4.html#cb373-75"></a></span>
<span id="cb373-76"><a href="viewer4.html#cb373-76"></a>  <span class="dt">float</span> u = longitude / (<span class="fl">2.0</span> * PI) + <span class="fl">0.5</span>;  <span class="co">// From [-pi, pi] to [0, 1]</span></span>
<span id="cb373-77"><a href="viewer4.html#cb373-77"></a>  <span class="dt">float</span> v = latitude / PI + <span class="fl">0.5</span>;           <span class="co">// From [-pi/2, pi/2] to [0, 1]</span></span>
<span id="cb373-78"><a href="viewer4.html#cb373-78"></a></span>
<span id="cb373-79"><a href="viewer4.html#cb373-79"></a>  <span class="kw">return</span> <span class="dt">vec2</span>(u, v);</span>
<span id="cb373-80"><a href="viewer4.html#cb373-80"></a>}</span></code></pre></div>
<p>Todas as funções recebem como parâmetro a posição do ponto (<code>P</code>) e retornam as coordenadas de textura correspondentes ao mapeamento. O código reproduz as equações descritas na seção <a href="texmapping.html#texmapping">10.1</a>. A única exceção é o cálculo da componente <span class="math inline">\(v\)</span> do mapeamento cilíndrico (linha 66), que aqui é deslocada para fazer com que o cilindro tenha base em <span class="math inline">\(-0.5\)</span> em vez de <span class="math inline">\(0\)</span>. Assim, a textura fica centralizada verticalmente em objetos de raio unitário centralizados na origem, que é o nosso caso pois usamos a função <code>Model::standardize</code> após a leitura do arquivo OBJ.</p>
<p>As funções de geração de coordenadas de textura são chamadas em <code>main</code> de acordo com o valor de <code>mappingMode</code>:</p>
<div class="sourceCode" id="cb374" startFrom="82"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 81;"><span id="cb374-82"><a href="viewer4.html#cb374-82"></a><span class="dt">void</span> <span class="fu">main</span>() {</span>
<span id="cb374-83"><a href="viewer4.html#cb374-83"></a>  <span class="dt">vec4</span> color;</span>
<span id="cb374-84"><a href="viewer4.html#cb374-84"></a></span>
<span id="cb374-85"><a href="viewer4.html#cb374-85"></a>  <span class="kw">if</span> (mappingMode == <span class="dv">0</span>) {</span>
<span id="cb374-86"><a href="viewer4.html#cb374-86"></a>    <span class="co">// Triplanar mapping</span></span>
<span id="cb374-87"><a href="viewer4.html#cb374-87"></a></span>
<span id="cb374-88"><a href="viewer4.html#cb374-88"></a>    <span class="co">// Sample with x planar mapping</span></span>
<span id="cb374-89"><a href="viewer4.html#cb374-89"></a>    <span class="dt">vec2</span> texCoord1 = <span class="fu">PlanarMappingX</span>(fragPObj);</span>
<span id="cb374-90"><a href="viewer4.html#cb374-90"></a>    <span class="dt">vec4</span> color1 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord1);</span>
<span id="cb374-91"><a href="viewer4.html#cb374-91"></a></span>
<span id="cb374-92"><a href="viewer4.html#cb374-92"></a>    <span class="co">// Sample with y planar mapping</span></span>
<span id="cb374-93"><a href="viewer4.html#cb374-93"></a>    <span class="dt">vec2</span> texCoord2 = <span class="fu">PlanarMappingY</span>(fragPObj);</span>
<span id="cb374-94"><a href="viewer4.html#cb374-94"></a>    <span class="dt">vec4</span> color2 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord2);</span>
<span id="cb374-95"><a href="viewer4.html#cb374-95"></a></span>
<span id="cb374-96"><a href="viewer4.html#cb374-96"></a>    <span class="co">// Sample with z planar mapping</span></span>
<span id="cb374-97"><a href="viewer4.html#cb374-97"></a>    <span class="dt">vec2</span> texCoord3 = <span class="fu">PlanarMappingZ</span>(fragPObj);</span>
<span id="cb374-98"><a href="viewer4.html#cb374-98"></a>    <span class="dt">vec4</span> color3 = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord3);</span>
<span id="cb374-99"><a href="viewer4.html#cb374-99"></a></span>
<span id="cb374-100"><a href="viewer4.html#cb374-100"></a>    <span class="co">// Compute average based on normal</span></span>
<span id="cb374-101"><a href="viewer4.html#cb374-101"></a>    <span class="dt">vec3</span> weight = <span class="bu">abs</span>(<span class="bu">normalize</span>(fragNObj));</span>
<span id="cb374-102"><a href="viewer4.html#cb374-102"></a>    color = color1 * weight.<span class="fu">x</span> + color2 * weight.<span class="fu">y</span> + color3 * weight.<span class="fu">z</span>;</span>
<span id="cb374-103"><a href="viewer4.html#cb374-103"></a>  } <span class="kw">else</span> {</span>
<span id="cb374-104"><a href="viewer4.html#cb374-104"></a>    <span class="dt">vec2</span> texCoord;</span>
<span id="cb374-105"><a href="viewer4.html#cb374-105"></a>    <span class="kw">if</span> (mappingMode == <span class="dv">1</span>) {</span>
<span id="cb374-106"><a href="viewer4.html#cb374-106"></a>      <span class="co">// Cylindrical mapping</span></span>
<span id="cb374-107"><a href="viewer4.html#cb374-107"></a>      texCoord = <span class="fu">CylindricalMapping</span>(fragPObj);</span>
<span id="cb374-108"><a href="viewer4.html#cb374-108"></a>    } <span class="kw">else</span> <span class="kw">if</span> (mappingMode == <span class="dv">2</span>) {</span>
<span id="cb374-109"><a href="viewer4.html#cb374-109"></a>      <span class="co">// Spherical mapping</span></span>
<span id="cb374-110"><a href="viewer4.html#cb374-110"></a>      texCoord = <span class="fu">SphericalMapping</span>(fragPObj);</span>
<span id="cb374-111"><a href="viewer4.html#cb374-111"></a>    } <span class="kw">else</span> <span class="kw">if</span> (mappingMode == <span class="dv">3</span>) {</span>
<span id="cb374-112"><a href="viewer4.html#cb374-112"></a>      <span class="co">// From mesh</span></span>
<span id="cb374-113"><a href="viewer4.html#cb374-113"></a>      texCoord = fragTexCoord;</span>
<span id="cb374-114"><a href="viewer4.html#cb374-114"></a>    }</span>
<span id="cb374-115"><a href="viewer4.html#cb374-115"></a>    color = <span class="fu">BlinnPhong</span>(fragN, fragL, fragV, texCoord);</span>
<span id="cb374-116"><a href="viewer4.html#cb374-116"></a>  }</span>
<span id="cb374-117"><a href="viewer4.html#cb374-117"></a></span>
<span id="cb374-118"><a href="viewer4.html#cb374-118"></a>  <span class="kw">if</span> (<span class="bu">gl_FrontFacing</span>) {</span>
<span id="cb374-119"><a href="viewer4.html#cb374-119"></a>    outColor = color;</span>
<span id="cb374-120"><a href="viewer4.html#cb374-120"></a>  } <span class="kw">else</span> {</span>
<span id="cb374-121"><a href="viewer4.html#cb374-121"></a>    <span class="dt">float</span> i = (color.<span class="fu">r</span> + color.<span class="fu">g</span> + color.<span class="fu">b</span>) / <span class="fl">3.0</span>;</span>
<span id="cb374-122"><a href="viewer4.html#cb374-122"></a>    outColor = <span class="dt">vec4</span>(i, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.0</span>);</span>
<span id="cb374-123"><a href="viewer4.html#cb374-123"></a>  }</span>
<span id="cb374-124"><a href="viewer4.html#cb374-124"></a>}</span></code></pre></div>
<p>Observe, no mapeamento triplanar (linhas 86–102), como a textura é amostrada três vezes (linhas 88–98) e então combinada em uma média ponderada pelo valor absoluto das componentes do vetor normal (linhas 101–102).</p>
<div class="infobox">
<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1.4em;width:1.4em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#555;overflow:visible;position:relative;"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>
<div class="infoboxtitle">
Observação
</div>
<p>No mapeamento triplanar, não seria necessário chamar <code>BlinnPhong</code> três vezes, pois a iluminação sem a textura é a mesma nas três chamadas.</p>
<p>O código ficaria mais eficiente se <code>BlinnPhong</code> retornasse uma estrutura contendo as componentes ambiente, difusa e especular separadas. Poderíamos então criar uma outra função só para fazer a amostragem da textura difusa e compor a cor final.</p>
</div>
<p>Se <code>mappingMode</code> é <code>3</code>, então nenhuma função de mapeamento é chamada e as coordenadas de textura utilizadas em <code>BlinnPhong</code> são aquelas contidas em <code>fragTexCoord</code>, pois essas são as coordenadas de textura interpoladas a partir das coordenadas definidas nos vértices.</p>
<p>Isso resume as modificações necessárias para habilitar a texturização. O restante do código contém modificações complementares relacionadas a conceitos que já foram abordados em projetos anteriores, como a mudança da interface da ImGui e a determinação de um ângulo e eixo de rotação inicial para o trackball virtual.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="31">
<li id="fn31"><p>Nosso visualizador suporta apenas um objeto por arquivo OBJ e, portanto, suporta apenas um material. Por isso, todos os arquivos OBJ que utilizaremos devem ter apenas um objeto e um material.<a href="viewer4.html#fnref31" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="texfiltering.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="normalmapping.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_float": true,
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
