<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.7 LookAt na prática | MCTA008-17 Computação Gráfica</title>
  <meta name="description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="7.7 LookAt na prática | MCTA008-17 Computação Gráfica" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  <meta name="github-repo" content="hbatagelo/cgbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.7 LookAt na prática | MCTA008-17 Computação Gráfica" />
  
  <meta name="twitter:description" content="Notas de aula de MCTA008-17 Computação Gráfica da Universidade Federal do ABC" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lookat.html"/>
<link rel="next" href="referências.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computação Gráfica</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Apresentação</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html"><i class="fa fa-check"></i>Pré-requisitos</a>
<ul>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#atividades-práticas"><i class="fa fa-check"></i>Atividades práticas</a></li>
<li class="chapter" data-level="" data-path="pré-requisitos.html"><a href="pré-requisitos.html#visualizando-este-site"><i class="fa fa-check"></i>Visualizando este site</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="config.html"><a href="config.html"><i class="fa fa-check"></i><b>1</b> Configuração do ambiente</a>
<ul>
<li class="chapter" data-level="1.1" data-path="linux.html"><a href="linux.html"><i class="fa fa-check"></i><b>1.1</b> Linux</a>
<ul>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#verificando-o-opengl"><i class="fa fa-check"></i>Verificando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#atualizando-o-gcc"><i class="fa fa-check"></i>Atualizando o GCC</a></li>
<li class="chapter" data-level="" data-path="linux.html"><a href="linux.html#instalando-o-emscripten"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="macos.html"><a href="macos.html"><i class="fa fa-check"></i><b>1.2</b> macOS</a>
<ul>
<li class="chapter" data-level="" data-path="macos.html"><a href="macos.html#instalando-o-emscripten-1"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="windows.html"><a href="windows.html"><i class="fa fa-check"></i><b>1.3</b> Windows</a>
<ul>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#verificando-o-opengl-1"><i class="fa fa-check"></i>Verificando o OpenGL</a></li>
<li class="chapter" data-level="" data-path="windows.html"><a href="windows.html#instalando-o-emscripten-2"><i class="fa fa-check"></i>Instalando o Emscripten</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="vscode.html"><a href="vscode.html"><i class="fa fa-check"></i><b>1.4</b> Visual Studio Code</a></li>
<li class="chapter" data-level="1.5" data-path="abcg.html"><a href="abcg.html"><i class="fa fa-check"></i><b>1.5</b> ABCg</a>
<ul>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#instalação"><i class="fa fa-check"></i>Instalação</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-na-linha-de-comando"><i class="fa fa-check"></i>Compilando na linha de comando</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-no-vs-code"><i class="fa fa-check"></i>Compilando no VS Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#depurando-no-vs-code"><i class="fa fa-check"></i>Depurando no VS Code</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#compilando-para-wasm"><i class="fa fa-check"></i>Compilando para WASM</a></li>
<li class="chapter" data-level="" data-path="abcg.html"><a href="abcg.html#revisão-de-c"><i class="fa fa-check"></i>Revisão de C++</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introdução</a>
<ul>
<li class="chapter" data-level="2.1" data-path="áreas-correlatas.html"><a href="áreas-correlatas.html"><i class="fa fa-check"></i><b>2.1</b> Áreas correlatas</a></li>
<li class="chapter" data-level="2.2" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html"><i class="fa fa-check"></i><b>2.2</b> Linha do tempo</a>
<ul>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section"><i class="fa fa-check"></i>1950</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-1"><i class="fa fa-check"></i>1960</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-2"><i class="fa fa-check"></i>1970</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-3"><i class="fa fa-check"></i>1980</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-4"><i class="fa fa-check"></i>1990</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-5"><i class="fa fa-check"></i>2000</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-6"><i class="fa fa-check"></i>2010</a></li>
<li class="chapter" data-level="" data-path="linha-do-tempo.html"><a href="linha-do-tempo.html#section-7"><i class="fa fa-check"></i>2020</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="firstapp.html"><a href="firstapp.html"><i class="fa fa-check"></i><b>2.3</b> Primeiro programa</a>
<ul>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#configuração-inicial"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#main.cpp"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#window.hpp"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#window.cpp"><i class="fa fa-check"></i>window.cpp</a></li>
<li class="chapter" data-level="" data-path="firstapp.html"><a href="firstapp.html#compilando-para-webassembly"><i class="fa fa-check"></i>Compilando para WebAssembly</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="tictactoe.html"><a href="tictactoe.html"><i class="fa fa-check"></i><b>2.4</b> Jogo da Velha</a>
<ul>
<li class="chapter" data-level="" data-path="tictactoe.html"><a href="tictactoe.html#configuração-inicial-1"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="tictactoe.html"><a href="tictactoe.html#main.cpp-1"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="tictactoe.html"><a href="tictactoe.html#window.hpp-1"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="tictactoe.html"><a href="tictactoe.html#window.cpp-1"><i class="fa fa-check"></i>window.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphicssystem.html"><a href="graphicssystem.html"><i class="fa fa-check"></i><b>3</b> Sistemas gráficos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lightcolor.html"><a href="lightcolor.html"><i class="fa fa-check"></i><b>3.1</b> Luz e cor</a>
<ul>
<li class="chapter" data-level="" data-path="lightcolor.html"><a href="lightcolor.html#visão-tricromática"><i class="fa fa-check"></i>Visão tricromática</a></li>
<li class="chapter" data-level="" data-path="lightcolor.html"><a href="lightcolor.html#modelos-de-cor"><i class="fa fa-check"></i>Modelos de cor</a></li>
<li class="chapter" data-level="" data-path="lightcolor.html"><a href="lightcolor.html#sistema-cie-1931"><i class="fa fa-check"></i>Sistema CIE 1931</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectorxraster.html"><a href="vectorxraster.html"><i class="fa fa-check"></i><b>3.2</b> Vetorial <em>x</em> matricial</a>
<ul>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-vetorial"><i class="fa fa-check"></i>Representação vetorial</a></li>
<li class="chapter" data-level="" data-path="vectorxraster.html"><a href="vectorxraster.html#representação-matricial"><i class="fa fa-check"></i>Representação matricial</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="es.html"><a href="es.html"><i class="fa fa-check"></i><b>3.3</b> Dispositivos de E/S</a>
<ul>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-entrada"><i class="fa fa-check"></i>Dispositivos de entrada</a></li>
<li class="chapter" data-level="" data-path="es.html"><a href="es.html#dispositivos-de-saída"><i class="fa fa-check"></i>Dispositivos de saída</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="framebuffer.html"><a href="framebuffer.html"><i class="fa fa-check"></i><b>3.4</b> Framebuffer</a>
<ul>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#screen-tearing"><i class="fa fa-check"></i>Screen tearing</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#vsync"><i class="fa fa-check"></i>Vsync</a></li>
<li class="chapter" data-level="" data-path="framebuffer.html"><a href="framebuffer.html#multiple-buffering"><i class="fa fa-check"></i>Multiple buffering</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="sierpinski.html"><a href="sierpinski.html"><i class="fa fa-check"></i><b>3.5</b> Triângulo de Sierpinski</a>
<ul>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#configuração-inicial-2"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#main.cpp-2"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#window.hpp-2"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="sierpinski.html"><a href="sierpinski.html#window.cpp-2"><i class="fa fa-check"></i>window.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>4</b> Pipeline gráfico</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dados-gráficos.html"><a href="dados-gráficos.html"><i class="fa fa-check"></i><b>4.1</b> Dados gráficos</a></li>
<li class="chapter" data-level="4.2" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html"><i class="fa fa-check"></i><b>4.2</b> Ray casting <em>x</em> rasterização</a>
<ul>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#ray-casting"><i class="fa fa-check"></i>Ray casting</a></li>
<li class="chapter" data-level="" data-path="ray-casting-x-rasterização.html"><a href="ray-casting-x-rasterização.html#rasterização"><i class="fa fa-check"></i>Rasterização</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="glpipeline.html"><a href="glpipeline.html"><i class="fa fa-check"></i><b>4.3</b> Pipeline do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#aplicação"><i class="fa fa-check"></i>Aplicação</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#vertex-shader"><i class="fa fa-check"></i>Vertex shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#montagem-de-primitivas"><i class="fa fa-check"></i>Montagem de primitivas</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#recorte"><i class="fa fa-check"></i>Recorte</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#rasterização-1"><i class="fa fa-check"></i>Rasterização</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#fragment-shader"><i class="fa fa-check"></i>Fragment shader</a></li>
<li class="chapter" data-level="" data-path="glpipeline.html"><a href="glpipeline.html#operações-de-fragmentos"><i class="fa fa-check"></i>Operações de fragmentos</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="coloredtriangles.html"><a href="coloredtriangles.html"><i class="fa fa-check"></i><b>4.4</b> Triângulos coloridos</a>
<ul>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#configuração-inicial-3"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#main.cpp-3"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#window.hpp-3"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#window.cpp-3"><i class="fa fa-check"></i>window.cpp</a></li>
<li class="chapter" data-level="" data-path="coloredtriangles.html"><a href="coloredtriangles.html#ajustando-a-taxa-de-atualização"><i class="fa fa-check"></i>Ajustando a taxa de atualização</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="game.html"><a href="game.html"><i class="fa fa-check"></i><b>5</b> Desenvolvendo um jogo 2D</a>
<ul>
<li class="chapter" data-level="5.1" data-path="regularpolygons.html"><a href="regularpolygons.html"><i class="fa fa-check"></i><b>5.1</b> Polígonos regulares</a>
<ul>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#configuração-inicial-4"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#main.cpp-4"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#window.hpp-4"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="regularpolygons.html"><a href="regularpolygons.html#window.cpp-4"><i class="fa fa-check"></i>window.cpp</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="asteroids.html"><a href="asteroids.html"><i class="fa fa-check"></i><b>5.2</b> Asteroids</a>
<ul>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#organização-do-projeto"><i class="fa fa-check"></i>Organização do projeto</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#configuração-inicial-5"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#nave"><i class="fa fa-check"></i>Nave</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#estrelas"><i class="fa fa-check"></i>Estrelas</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#asteroides"><i class="fa fa-check"></i>Asteroides</a></li>
<li class="chapter" data-level="" data-path="asteroids.html"><a href="asteroids.html#tiros-e-colisões"><i class="fa fa-check"></i>Tiros e colisões</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="geometry.html"><a href="geometry.html"><i class="fa fa-check"></i><b>6</b> Espaços e geometria</a>
<ul>
<li class="chapter" data-level="6.1" data-path="vector.html"><a href="vector.html"><i class="fa fa-check"></i><b>6.1</b> Espaço vetorial</a>
<ul>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#combinação-e-independência-linear"><i class="fa fa-check"></i>Combinação e independência linear</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#dimensão-e-base"><i class="fa fa-check"></i>Dimensão e base</a></li>
<li class="chapter" data-level="" data-path="vector.html"><a href="vector.html#vetores-geométricos"><i class="fa fa-check"></i>Vetores geométricos</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="affine.html"><a href="affine.html"><i class="fa fa-check"></i><b>6.2</b> Espaço afim</a>
<ul>
<li class="chapter" data-level="" data-path="affine.html"><a href="affine.html#combinação-afim"><i class="fa fa-check"></i>Combinação afim</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="euclidean.html"><a href="euclidean.html"><i class="fa fa-check"></i><b>6.3</b> Espaço euclidiano</a>
<ul>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#quadro-de-referência"><i class="fa fa-check"></i>Quadro de referência</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-escalar"><i class="fa fa-check"></i>Produto escalar</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ortogonalidade"><i class="fa fa-check"></i>Ortogonalidade</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#comprimento-e-distância"><i class="fa fa-check"></i>Comprimento e distância</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#normalização"><i class="fa fa-check"></i>Normalização</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#ângulo-entre-vetores"><i class="fa fa-check"></i>Ângulo entre vetores</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#projeção-ortogonal"><i class="fa fa-check"></i>Projeção ortogonal</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#produto-vetorial"><i class="fa fa-check"></i>Produto vetorial</a></li>
<li class="chapter" data-level="" data-path="euclidean.html"><a href="euclidean.html#vetor-normal"><i class="fa fa-check"></i>Vetor normal</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="objmodel.html"><a href="objmodel.html"><i class="fa fa-check"></i><b>6.4</b> Lendo um modelo 3D</a>
<ul>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#orientação-e-face-culling"><i class="fa fa-check"></i>Orientação e face culling</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#configuração-inicial-6"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#main.cpp-6"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.vert"><i class="fa fa-check"></i>loadmodel.vert</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#loadmodel.frag"><i class="fa fa-check"></i>loadmodel.frag</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#window.hpp-6"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="objmodel.html"><a href="objmodel.html#window.cpp-6"><i class="fa fa-check"></i>window.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>7</b> Matrizes e transformações</a>
<ul>
<li class="chapter" data-level="7.1" data-path="matrix.html"><a href="matrix.html"><i class="fa fa-check"></i><b>7.1</b> Matrizes</a>
<ul>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-transposta"><i class="fa fa-check"></i>Matriz transposta</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-quadrada"><i class="fa fa-check"></i>Matriz quadrada</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-linhacoluna"><i class="fa fa-check"></i>Matriz linha/coluna</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-identidade"><i class="fa fa-check"></i>Matriz identidade</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#operações"><i class="fa fa-check"></i>Operações</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-inversa"><i class="fa fa-check"></i>Matriz inversa</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#matriz-ortogonal"><i class="fa fa-check"></i>Matriz ortogonal</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#propriedades"><i class="fa fa-check"></i>Propriedades</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#transformação-linear"><i class="fa fa-check"></i>Transformação linear</a></li>
<li class="chapter" data-level="" data-path="matrix.html"><a href="matrix.html#mudança-de-base"><i class="fa fa-check"></i>Mudança de base</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="homogeneous.html"><a href="homogeneous.html"><i class="fa fa-check"></i><b>7.2</b> Coordenadas homogêneas</a></li>
<li class="chapter" data-level="7.3" data-path="concat.html"><a href="concat.html"><i class="fa fa-check"></i><b>7.3</b> Concatenação de transformações</a></li>
<li class="chapter" data-level="7.4" data-path="transforms.html"><a href="transforms.html"><i class="fa fa-check"></i><b>7.4</b> Transformações</a>
<ul>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#identidade"><i class="fa fa-check"></i>Identidade</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#translação"><i class="fa fa-check"></i>Translação</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#escala"><i class="fa fa-check"></i>Escala</a></li>
<li class="chapter" data-level="" data-path="transforms.html"><a href="transforms.html#rotação"><i class="fa fa-check"></i>Rotação</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="glspaces.html"><a href="glspaces.html"><i class="fa fa-check"></i><b>7.5</b> Espaços do OpenGL</a>
<ul>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-objeto"><i class="fa fa-check"></i>Espaço do objeto</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-do-mundo"><i class="fa fa-check"></i>Espaço do mundo</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#espaço-da-câmera"><i class="fa fa-check"></i>Espaço da câmera</a></li>
<li class="chapter" data-level="" data-path="glspaces.html"><a href="glspaces.html#concatenação-das-matrizes-de-modelo-e-visão"><i class="fa fa-check"></i>Concatenação das matrizes de modelo e visão</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="lookat.html"><a href="lookat.html"><i class="fa fa-check"></i><b>7.6</b> Câmera LookAt</a>
<ul>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-n"><i class="fa fa-check"></i>Construindo o vetor n</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-u"><i class="fa fa-check"></i>Construindo o vetor u</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-o-vetor-v"><i class="fa fa-check"></i>Construindo o vetor v</a></li>
<li class="chapter" data-level="" data-path="lookat.html"><a href="lookat.html#construindo-a-matriz-de-visão"><i class="fa fa-check"></i>Construindo a matriz de visão</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="lookatproject.html"><a href="lookatproject.html"><i class="fa fa-check"></i><b>7.7</b> LookAt na prática</a>
<ul>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#configuração-inicial-7"><i class="fa fa-check"></i>Configuração inicial</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#main.cpp-7"><i class="fa fa-check"></i>main.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.vert"><i class="fa fa-check"></i>lookat.vert</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#lookat.frag"><i class="fa fa-check"></i>lookat.frag</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.hpp"><i class="fa fa-check"></i>camera.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#camera.cpp"><i class="fa fa-check"></i>camera.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#window.hpp-7"><i class="fa fa-check"></i>window.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#window.cpp-7"><i class="fa fa-check"></i>window.cpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.hpp"><i class="fa fa-check"></i>ground.hpp</a></li>
<li class="chapter" data-level="" data-path="lookatproject.html"><a href="lookatproject.html#ground.cpp"><i class="fa fa-check"></i>ground.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li>
<a href="https://github.com/hbatagelo/abcg" target="blank">ABCg no GitHub</a>
<br>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCTA008-17 Computação Gráfica</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lookatproject" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> LookAt na prática<a href="lookatproject.html#lookatproject" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nesta seção, seguiremos o passo a passo de desenvolvimento de uma aplicação que renderiza uma cena 3D do ponto de vista de uma câmera LookAt.</p>
<p>A cena 3D será composta por quatro instâncias do modelo “Stanford Bunny” dispostos sobre o plano <span class="math inline">\(xz\)</span> do espaço do mundo. A câmera LookAt simulará um observador em primeira pessoa. A figura <a href="lookatproject.html#fig:lookatproj1">7.31</a> mostra o posicionamento dos objetos e a localização inicial da câmera.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:lookatproj1"></span>
<img src="images/07_lookatproj1.png" alt="Objetos e elementos de cena dispostos no espaço do mundo."  />
<p class="caption">
Figura 7.31: Objetos e elementos de cena dispostos no espaço do mundo.
</p>
</div>
<p>Na figura acima, os vetores <span class="math inline">\(\hat{\mathbf{i}}\)</span>,<span class="math inline">\(\hat{\mathbf{j}}\)</span>,<span class="math inline">\(\hat{\mathbf{k}}\)</span> correspondem às direções dos eixos <span class="math inline">\(x\)</span>,<span class="math inline">\(y\)</span>,<span class="math inline">\(z\)</span> do quadro padrão com ponto de referência na origem <span class="math inline">\((0,0,0)\)</span>. Os vetores <span class="math inline">\(\hat{\mathbf{u}}\)</span>,<span class="math inline">\(\hat{\mathbf{v}}\)</span>,<span class="math inline">\(\hat{\mathbf{n}}\)</span> são os vetores de base do quadro da câmera com <span class="math inline">\(P_0=(0, 0.5, 2.5)\)</span>. A câmera está localizada na origem de seu quadro e está olhando na direção de seu eixo <span class="math inline">\(z\)</span> negativo.</p>
<ul>
<li>O <strong>coelho vermelho</strong> está na posição <span class="math inline">\((0,0,0)\)</span> do quadro padrão e tem escala de <span class="math inline">\(10\%\)</span> do tamanho original.</li>
<li>O <strong>coelho cinza</strong> está na posição <span class="math inline">\((-1,0,0)\)</span> do quadro padrão e está rodado em <span class="math inline">\(90^{\circ}\)</span> em torno do eixo <span class="math inline">\(y\)</span> de seu quadro local.</li>
<li>O <strong>coelho azul</strong> está na posição <span class="math inline">\((1,0,0)\)</span> do quadro padrão e está rodado em <span class="math inline">\(-90^{\circ}\)</span> em torno do eixo <span class="math inline">\(y\)</span> de seu quadro local.</li>
<li>O <strong>coelho amarelo</strong> está na posição <span class="math inline">\((0,0,-1)\)</span> do quadro padrão e está com sua orientação original.</li>
</ul>
<p>A posição e orientação da câmera podem ser modificadas através do teclado:</p>
<ul>
<li>As setas para cima/baixo (ou <code>W</code>/<code>S</code>) fazem a câmera ir para a frente e para trás ao longo da direção de visão (direção de <span class="math inline">\(\pm\hat{\mathbf{n}}\)</span>). Esse movimento de câmera é conhecido como <strong>dolly</strong> no jargão da cinematografia.</li>
<li>As setas para os lados (ou <code>A</code>/<code>D</code>) fazem a câmera girar em torno de seu eixo <span class="math inline">\(y\)</span> (vetor <span class="math inline">\(\hat{\mathbf{v}}\)</span>). Esse movimento é chamado de <strong>pan</strong>.</li>
<li>As teclas <code>Q</code>/<code>E</code> fazem a câmera deslizar para os lados (direção de <span class="math inline">\(\pm\hat{\mathbf{u}}\)</span>). Esse movimento é chamado de <strong>truck</strong> ou <strong>dolly lateral</strong>.</li>
</ul>
<p>Neste exemplo, a altura da câmera permanecerá sempre em <span class="math inline">\(y=0.5\)</span>.</p>
<p>O resultado ficará como a seguir:</p>
<iframe
  src="https://hbatagelo.github.io/abcgapps/lookat/index.html"
  allow="gamepad" frameborder="0" allowfullscreen="true" allowtransparency="true" emscriptenheight="740"
  ></iframe>
<div class="infobox">
<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1.4em;width:1.4em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#555;overflow:visible;position:relative;"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>
<div class="infoboxtitle">
Observação
</div>
<p>Para controlar a câmera usando o teclado é necessário abrir o <a href="https://hbatagelo.github.io/abcgapps/lookat/index.html">link original</a> e clicar na área de desenho. Desse modo a aplicação terá o foco do teclado.</p>
</div>
<div id="configuração-inicial-7" class="section level3 unnumbered hasAnchor">
<h3>Configuração inicial<a href="lookatproject.html#configuração-inicial-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>No arquivo <code>abcg/examples/CMakeLists.txt</code>, inclua a linha:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb261-1"><a href="lookatproject.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(lookat)</span></code></pre></div></li>
<li><p>Crie o subdiretório <code>abcg/examples/lookat</code> e o arquivo <code>abcg/examples/lookat/CMakeLists.txt</code> com o seguinte conteúdo:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb262-1"><a href="lookatproject.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="kw">project</span>(lookat)</span>
<span id="cb262-2"><a href="lookatproject.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="kw">add_executable</span>(<span class="dv">${PROJECT_NAME}</span> <span class="bn">camera.cpp</span> ground.cpp main.cpp window.cpp)</span>
<span id="cb262-3"><a href="lookatproject.html#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="fu">enable_abcg</span>(<span class="dv">${PROJECT_NAME}</span>)</span></code></pre></div></li>
<li><p>Crie os arquivos <code>camera.cpp</code>, <code>camera.hpp</code>, <code>ground.cpp</code>, <code>ground.hpp</code>, <code>main.cpp</code>, <code>window.cpp</code> e <code>window.hpp</code>.</p></li>
<li><p>Crie o subdiretório <code>abcg/examples/lookat/assets</code>. Dentro dele, crie os arquivos <code>lookat.frag</code> e <code>lookat.vert</code>. Além disso, baixe o arquivo <a href="https://hbatagelo.github.io/abcgapps/data/bunny.zip"><code>bunny.zip</code></a> e descompacte-o em <code>assets</code>.</p></li>
</ul>
<p>A estrutura de <code>abcg/examples/lookat</code> ficará assim:</p>
<pre><code>lookat/
│   CMakeLists.txt
│   camera.hpp
│   camera.cpp
│   ground.hpp
│   ground.cpp
│   main.cpp
│   window.hpp
│   window.cpp
│
└───assets/
    │   bunny.obj
    │   lookat.frag    
    └   lookat.vert</code></pre>
</div>
<div id="main.cpp-7" class="section level3 unnumbered hasAnchor">
<h3>main.cpp<a href="lookatproject.html#main.cpp-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exceto pelo título da janela, o conteúdo de <code>main.cpp</code> é o mesmo do projeto anterior:</p>
<div class="sourceCode" id="cb264" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb264-1"><a href="lookatproject.html#cb264-1"></a><span class="pp">#include </span><span class="im">&quot;window.hpp&quot;</span></span>
<span id="cb264-2"><a href="lookatproject.html#cb264-2"></a></span>
<span id="cb264-3"><a href="lookatproject.html#cb264-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb264-4"><a href="lookatproject.html#cb264-4"></a>  <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb264-5"><a href="lookatproject.html#cb264-5"></a>    abcg<span class="op">::</span>Application app<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">);</span></span>
<span id="cb264-6"><a href="lookatproject.html#cb264-6"></a></span>
<span id="cb264-7"><a href="lookatproject.html#cb264-7"></a>    Window window<span class="op">;</span></span>
<span id="cb264-8"><a href="lookatproject.html#cb264-8"></a>    window<span class="op">.</span>setOpenGLSettings<span class="op">({.</span>samples <span class="op">=</span> <span class="dv">4</span><span class="op">});</span></span>
<span id="cb264-9"><a href="lookatproject.html#cb264-9"></a>    window<span class="op">.</span>setWindowSettings<span class="op">({</span></span>
<span id="cb264-10"><a href="lookatproject.html#cb264-10"></a>        <span class="op">.</span>width <span class="op">=</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb264-11"><a href="lookatproject.html#cb264-11"></a>        <span class="op">.</span>height <span class="op">=</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb264-12"><a href="lookatproject.html#cb264-12"></a>        <span class="op">.</span>title <span class="op">=</span> <span class="st">&quot;LookAt Camera&quot;</span><span class="op">,</span></span>
<span id="cb264-13"><a href="lookatproject.html#cb264-13"></a>    <span class="op">});</span></span>
<span id="cb264-14"><a href="lookatproject.html#cb264-14"></a></span>
<span id="cb264-15"><a href="lookatproject.html#cb264-15"></a>    app<span class="op">.</span>run<span class="op">(</span>window<span class="op">);</span></span>
<span id="cb264-16"><a href="lookatproject.html#cb264-16"></a>  <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">std::</span>exception<span class="op"> </span><span class="at">const</span> <span class="op">&amp;</span>exception<span class="op">)</span> <span class="op">{</span></span>
<span id="cb264-17"><a href="lookatproject.html#cb264-17"></a>    fmt<span class="op">::</span>print<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;</span><span class="sc">{}\n</span><span class="st">&quot;</span><span class="op">,</span> exception<span class="op">.</span>what<span class="op">());</span></span>
<span id="cb264-18"><a href="lookatproject.html#cb264-18"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb264-19"><a href="lookatproject.html#cb264-19"></a>  <span class="op">}</span></span>
<span id="cb264-20"><a href="lookatproject.html#cb264-20"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb264-21"><a href="lookatproject.html#cb264-21"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="lookat.vert" class="section level3 unnumbered hasAnchor">
<h3>lookat.vert<a href="lookatproject.html#lookat.vert" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O vertex shader ficará como a seguir:</p>
<div class="sourceCode" id="cb265" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb265-1"><a href="lookatproject.html#cb265-1"></a><span class="pp">#version 300 es</span></span>
<span id="cb265-2"><a href="lookatproject.html#cb265-2"></a></span>
<span id="cb265-3"><a href="lookatproject.html#cb265-3"></a><span class="kw">layout</span><span class="op">(</span><span class="dt">location</span> <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="dt">in</span> <span class="dt">vec3</span> inPosition<span class="op">;</span></span>
<span id="cb265-4"><a href="lookatproject.html#cb265-4"></a></span>
<span id="cb265-5"><a href="lookatproject.html#cb265-5"></a><span class="kw">uniform</span> <span class="dt">vec4</span> color<span class="op">;</span></span>
<span id="cb265-6"><a href="lookatproject.html#cb265-6"></a><span class="kw">uniform</span> <span class="dt">mat4</span> modelMatrix<span class="op">;</span></span>
<span id="cb265-7"><a href="lookatproject.html#cb265-7"></a><span class="kw">uniform</span> <span class="dt">mat4</span> viewMatrix<span class="op">;</span></span>
<span id="cb265-8"><a href="lookatproject.html#cb265-8"></a><span class="kw">uniform</span> <span class="dt">mat4</span> projMatrix<span class="op">;</span></span>
<span id="cb265-9"><a href="lookatproject.html#cb265-9"></a></span>
<span id="cb265-10"><a href="lookatproject.html#cb265-10"></a><span class="dt">out</span> <span class="dt">vec4</span> fragColor<span class="op">;</span></span>
<span id="cb265-11"><a href="lookatproject.html#cb265-11"></a></span>
<span id="cb265-12"><a href="lookatproject.html#cb265-12"></a><span class="dt">void</span> <span class="fu">main</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb265-13"><a href="lookatproject.html#cb265-13"></a>  <span class="dt">vec4</span> posEyeSpace <span class="op">=</span> viewMatrix <span class="op">*</span> modelMatrix <span class="op">*</span> <span class="dt">vec4</span><span class="op">(</span>inPosition<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb265-14"><a href="lookatproject.html#cb265-14"></a></span>
<span id="cb265-15"><a href="lookatproject.html#cb265-15"></a>  <span class="dt">float</span> i <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> <span class="op">(-</span>posEyeSpace<span class="op">.</span><span class="fu">z</span> <span class="op">/</span> <span class="fl">5.0</span><span class="op">);</span></span>
<span id="cb265-16"><a href="lookatproject.html#cb265-16"></a>  fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>i<span class="op">,</span> i<span class="op">,</span> i<span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> color<span class="op">;</span></span>
<span id="cb265-17"><a href="lookatproject.html#cb265-17"></a></span>
<span id="cb265-18"><a href="lookatproject.html#cb265-18"></a>  <span class="bu">gl_Position</span> <span class="op">=</span> projMatrix <span class="op">*</span> posEyeSpace<span class="op">;</span></span>
<span id="cb265-19"><a href="lookatproject.html#cb265-19"></a><span class="op">}</span></span></code></pre></div>
<p>O atributo de entrada, <code>inPosition</code>, é a posição <span class="math inline">\((x,y,z)\)</span> do vértice. Vamos supor que estas coordenadas estão no <strong>espaço do objeto</strong>.</p>
<p>O atributo de saída, <code>fragColor</code>, é uma cor RGBA.</p>
<p>As variáveis uniformes são utilizadas para determinar a cor do objeto (<code>color</code>, na linha 5) e as matrizes <span class="math inline">\(4 \times 4\)</span> de transformação geométrica (linhas 6 a 8):</p>
<ul>
<li>Matriz de modelo: <code>modelMatrix</code>;</li>
<li>Matriz de visão: <code>viewMatrix</code>;</li>
<li>Matriz de projeção: <code>projMatrix</code>.</li>
</ul>
<p>Embora ainda não tenhamos visto a fundamentação teórica sobre a construção de uma matriz de projeção, vamos utilizar essa matriz desde já. Ela será necessária para obter o efeito de perspectiva e assim manter a ilusão de que a câmera LookAt é um observador dentro de um cenário 3D.</p>
<p>No código de <code>main</code>, a linha 13 transforma a posição de entrada usando as matrizes de modelo e visão. Para entendermos a ordem das transformações a partir do espaço do objeto, temos de ler os operandos da direita para a esquerda:</p>
<div class="sourceCode" id="cb266" startFrom="13"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 12;"><span id="cb266-13"><a href="lookatproject.html#cb266-13"></a>  <span class="dt">vec4</span> posEyeSpace <span class="op">=</span> viewMatrix <span class="op">*</span> modelMatrix <span class="op">*</span> <span class="dt">vec4</span><span class="op">(</span>inPosition<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
<p>Primeiro, <code>vec4(inPosition, 1)</code> produz a posição <span class="math inline">\((x,y,z,1)\)</span>, isto é, o ponto/vértice em coordenadas homogêneas que corresponde à posição <span class="math inline">\((x,y,z)\)</span> no espaço do objeto. Esse vértice é transformado, através do produto matricial, pela matriz de modelo <code>modelMatrix</code>. A transformação pela matriz de modelo converte coordenadas do espaço do objeto para o <strong>espaço do mundo</strong>. Em seguida há uma transformação pela matriz de visão <code>viewMatrix</code>. A matriz de visão converte coordenadas do espaço do mundo para coordenadas do <strong>espaço da câmera</strong>. Assim, o resultado armazenado em <code>posEyeSpace</code> é a posição do vértice no espaço da câmera.</p>
<p>Na linha 15, calculamos um valor <code>i</code> de intensidade de cor a partir da coordenada <span class="math inline">\(z\)</span> do vértice no espaço da câmera:</p>
<div class="sourceCode" id="cb267" startFrom="15"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 14;"><span id="cb267-15"><a href="lookatproject.html#cb267-15"></a>  <span class="dt">float</span> i <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> <span class="op">(-</span>posEyeSpace<span class="op">.</span><span class="fu">z</span> <span class="op">/</span> <span class="fl">5.0</span><span class="op">);</span></span></code></pre></div>
<p>Lembre-se que, no espaço da câmera, a câmera está olhando na direção de seu eixo <span class="math inline">\(z\)</span> negativo. Logo, do ponto de vista da câmera, todos os objetos à sua frente têm valor <span class="math inline">\(z\)</span> negativo. Ao fazermos <code>-PosEyeSpace.z</code>, tornamos esse valor positivo, correspondendo à distância entre o vértice e a câmera ao longo do eixo <span class="math inline">\(z\)</span>. A ideia aqui é transformar essa distância em um valor de intensidade de cor. A intensidade será máxima (1) se o objeto estiver o mais próximo possível da câmera (isto é, se estiver na mesma posição da câmera), e mínima (0) se estiver a 5 ou mais unidades de distância na direção de visão. Na linha 16, esse valor de intensidade é utilizado para multiplicar as componentes RGB da cor <code>color</code>.</p>
<div class="sourceCode" id="cb268" startFrom="16"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 15;"><span id="cb268-16"><a href="lookatproject.html#cb268-16"></a>  fragColor <span class="op">=</span> <span class="dt">vec4</span><span class="op">(</span>i<span class="op">,</span> i<span class="op">,</span> i<span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> color<span class="op">;</span></span></code></pre></div>
<p>Assim, quanto mais longe o objeto estiver da câmera, mais escuro ele ficará. A partir da distância 5, a intensidade fica negativa, mas nesse caso o OpenGL fixa automaticamente o valor de cor para zero, pois uma cor não pode ter intensidade negativa.</p>
<p>Na linha 18, <code>projMatrix * posEyeSpace</code> faz com que as coordenadas no espaço da câmera sejam convertidas para o <strong>espaço de recorte</strong>. É esse o resultado final armazenado em <code>gl_Position</code>:</p>
<div class="sourceCode" id="cb269" startFrom="18"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl" style="counter-reset: source-line 17;"><span id="cb269-18"><a href="lookatproject.html#cb269-18"></a>  <span class="bu">gl_Position</span> <span class="op">=</span> projMatrix <span class="op">*</span> posEyeSpace<span class="op">;</span></span></code></pre></div>
</div>
<div id="lookat.frag" class="section level3 unnumbered hasAnchor">
<h3>lookat.frag<a href="lookatproject.html#lookat.frag" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O conteúdo do fragment shader ficará assim:</p>
<div class="sourceCode" id="cb270" startFrom="1"><pre class="sourceCode numberSource glsl numberLines"><code class="sourceCode glsl"><span id="cb270-1"><a href="lookatproject.html#cb270-1"></a><span class="pp">#version 300 es</span></span>
<span id="cb270-2"><a href="lookatproject.html#cb270-2"></a></span>
<span id="cb270-3"><a href="lookatproject.html#cb270-3"></a><span class="dt">precision</span> <span class="dt">mediump</span> <span class="dt">float</span><span class="op">;</span></span>
<span id="cb270-4"><a href="lookatproject.html#cb270-4"></a></span>
<span id="cb270-5"><a href="lookatproject.html#cb270-5"></a><span class="dt">in</span> <span class="dt">vec4</span> fragColor<span class="op">;</span></span>
<span id="cb270-6"><a href="lookatproject.html#cb270-6"></a></span>
<span id="cb270-7"><a href="lookatproject.html#cb270-7"></a><span class="dt">out</span> <span class="dt">vec4</span> outColor<span class="op">;</span></span>
<span id="cb270-8"><a href="lookatproject.html#cb270-8"></a></span>
<span id="cb270-9"><a href="lookatproject.html#cb270-9"></a><span class="dt">void</span> <span class="fu">main</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb270-10"><a href="lookatproject.html#cb270-10"></a>  <span class="kw">if</span> <span class="op">(</span><span class="bu">gl_FrontFacing</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb270-11"><a href="lookatproject.html#cb270-11"></a>    outColor <span class="op">=</span> fragColor<span class="op">;</span></span>
<span id="cb270-12"><a href="lookatproject.html#cb270-12"></a>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb270-13"><a href="lookatproject.html#cb270-13"></a>    outColor <span class="op">=</span> fragColor <span class="op">*</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb270-14"><a href="lookatproject.html#cb270-14"></a>  <span class="op">}</span></span>
<span id="cb270-15"><a href="lookatproject.html#cb270-15"></a><span class="op">}</span></span></code></pre></div>
<p>Se o triângulo estiver orientado de frente para a câmera, a cor final do fragmento será a cor de entrada (<code>fragColor</code>). Caso contrário, a cor terá metade da intensidade original (a cor RGB é multiplicada por 0.5). Assim, se a câmera estiver dentro de um objeto, os triângulos serão desenhados com uma cor mais escura, pois estaremos vendo o lado de trás da malha triangular.</p>
</div>
<div id="camera.hpp" class="section level3 unnumbered hasAnchor">
<h3>camera.hpp<a href="lookatproject.html#camera.hpp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Neste arquivo definiremos a classe <code>Camera</code> que gerenciará a câmera LookAt. O conteúdo ficará como a seguir:</p>
<div class="sourceCode" id="cb271" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb271-1"><a href="lookatproject.html#cb271-1"></a><span class="pp">#ifndef CAMERA_HPP_</span></span>
<span id="cb271-2"><a href="lookatproject.html#cb271-2"></a><span class="pp">#define CAMERA_HPP_</span></span>
<span id="cb271-3"><a href="lookatproject.html#cb271-3"></a></span>
<span id="cb271-4"><a href="lookatproject.html#cb271-4"></a><span class="pp">#include </span><span class="im">&lt;glm/mat4x4.hpp&gt;</span></span>
<span id="cb271-5"><a href="lookatproject.html#cb271-5"></a><span class="pp">#include </span><span class="im">&lt;glm/vec3.hpp&gt;</span></span>
<span id="cb271-6"><a href="lookatproject.html#cb271-6"></a></span>
<span id="cb271-7"><a href="lookatproject.html#cb271-7"></a><span class="kw">class</span> Camera <span class="op">{</span></span>
<span id="cb271-8"><a href="lookatproject.html#cb271-8"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb271-9"><a href="lookatproject.html#cb271-9"></a>  <span class="dt">void</span> computeViewMatrix<span class="op">();</span></span>
<span id="cb271-10"><a href="lookatproject.html#cb271-10"></a>  <span class="dt">void</span> computeProjectionMatrix<span class="op">(</span>glm<span class="op">::</span>vec2 <span class="at">const</span> <span class="op">&amp;</span>size<span class="op">);</span></span>
<span id="cb271-11"><a href="lookatproject.html#cb271-11"></a></span>
<span id="cb271-12"><a href="lookatproject.html#cb271-12"></a>  <span class="dt">void</span> dolly<span class="op">(</span><span class="dt">float</span> speed<span class="op">);</span></span>
<span id="cb271-13"><a href="lookatproject.html#cb271-13"></a>  <span class="dt">void</span> truck<span class="op">(</span><span class="dt">float</span> speed<span class="op">);</span></span>
<span id="cb271-14"><a href="lookatproject.html#cb271-14"></a>  <span class="dt">void</span> pan<span class="op">(</span><span class="dt">float</span> speed<span class="op">);</span></span>
<span id="cb271-15"><a href="lookatproject.html#cb271-15"></a></span>
<span id="cb271-16"><a href="lookatproject.html#cb271-16"></a>  glm<span class="op">::</span>mat4 <span class="at">const</span> <span class="op">&amp;</span>getViewMatrix<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">m_viewMatrix</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb271-17"><a href="lookatproject.html#cb271-17"></a>  glm<span class="op">::</span>mat4 <span class="at">const</span> <span class="op">&amp;</span>getProjMatrix<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">m_projMatrix</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb271-18"><a href="lookatproject.html#cb271-18"></a></span>
<span id="cb271-19"><a href="lookatproject.html#cb271-19"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb271-20"><a href="lookatproject.html#cb271-20"></a>  glm<span class="op">::</span>vec3 <span class="va">m_eye</span><span class="op">{</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">2.5</span><span class="bu">f</span><span class="op">};</span> <span class="co">// Camera position</span></span>
<span id="cb271-21"><a href="lookatproject.html#cb271-21"></a>  glm<span class="op">::</span>vec3 <span class="va">m_at</span><span class="op">{</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">};</span>  <span class="co">// Look-at point</span></span>
<span id="cb271-22"><a href="lookatproject.html#cb271-22"></a>  glm<span class="op">::</span>vec3 <span class="va">m_up</span><span class="op">{</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">};</span>  <span class="co">// &quot;up&quot; direction</span></span>
<span id="cb271-23"><a href="lookatproject.html#cb271-23"></a></span>
<span id="cb271-24"><a href="lookatproject.html#cb271-24"></a>  <span class="co">// Matrix to change from world space to camera space</span></span>
<span id="cb271-25"><a href="lookatproject.html#cb271-25"></a>  glm<span class="op">::</span>mat4 <span class="va">m_viewMatrix</span><span class="op">;</span></span>
<span id="cb271-26"><a href="lookatproject.html#cb271-26"></a></span>
<span id="cb271-27"><a href="lookatproject.html#cb271-27"></a>  <span class="co">// Matrix to change from camera space to clip space</span></span>
<span id="cb271-28"><a href="lookatproject.html#cb271-28"></a>  glm<span class="op">::</span>mat4 <span class="va">m_projMatrix</span><span class="op">;</span></span>
<span id="cb271-29"><a href="lookatproject.html#cb271-29"></a><span class="op">};</span></span>
<span id="cb271-30"><a href="lookatproject.html#cb271-30"></a></span>
<span id="cb271-31"><a href="lookatproject.html#cb271-31"></a><span class="pp">#endif</span></span></code></pre></div>
<p>Observe, nas linhas 20 a 22, que a classe tem todos os atributos necessários para criar o quadro de uma câmera LookAt:</p>
<ul>
<li><code>m_eye</code>: posição da câmera <span class="math inline">\((0, 0.5, 2.5)\)</span>.</li>
<li><code>m_at</code>: posição para onde a câmera está olhando <span class="math inline">\((0, 0.5, 0)\)</span>.</li>
<li><code>m_up</code>: vetor de direção para cima <span class="math inline">\((0, 1, 0)\)</span>.</li>
</ul>
<p>Na linha 25 temos a matriz de visão (<code>m_viewMatrix</code>) que será calculada pela função <code>Camera::computeViewMatrix</code> declarada na linha 9.</p>
<p>Na linha 28 temos a matriz de projeção (<code>m_projMatrix</code>) que será calculada pela função <code>Camera::computeProjectionMatrix</code> declarada na linha 10.</p>
<p>As funções <code>Camera::dolly</code>, <code>Camera::truck</code> e <code>Camera::pan</code> serão chamadas a partir de <code>Window</code> em resposta à entrada do teclado. Internamente, essas funções modificarão as variáveis <code>m_eye</code> e <code>m_at</code>, fazendo a câmera mudar de posição e orientação.</p>
<p><code>Camera::getViewMatrix</code> e <code>Camera::getProjMatrix</code> são funções de acesso à matriz de visão e projeção.</p>
</div>
<div id="camera.cpp" class="section level3 unnumbered hasAnchor">
<h3>camera.cpp<a href="lookatproject.html#camera.cpp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A definição das funções membro de <code>Camera</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb272" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb272-1"><a href="lookatproject.html#cb272-1"></a><span class="pp">#include </span><span class="im">&quot;camera.hpp&quot;</span></span>
<span id="cb272-2"><a href="lookatproject.html#cb272-2"></a></span>
<span id="cb272-3"><a href="lookatproject.html#cb272-3"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span id="cb272-4"><a href="lookatproject.html#cb272-4"></a></span>
<span id="cb272-5"><a href="lookatproject.html#cb272-5"></a><span class="dt">void</span> Camera<span class="op">::</span>computeProjectionMatrix<span class="op">(</span>glm<span class="op">::</span>vec2 <span class="at">const</span> <span class="op">&amp;</span>size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb272-6"><a href="lookatproject.html#cb272-6"></a>  <span class="va">m_projMatrix</span> <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb272-7"><a href="lookatproject.html#cb272-7"></a>  <span class="kw">auto</span> <span class="at">const</span> aspect<span class="op">{</span>size<span class="op">.</span>x <span class="op">/</span> size<span class="op">.</span>y<span class="op">};</span></span>
<span id="cb272-8"><a href="lookatproject.html#cb272-8"></a>  <span class="va">m_projMatrix</span> <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">70.0</span><span class="bu">f</span><span class="op">),</span> aspect<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">5.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb272-9"><a href="lookatproject.html#cb272-9"></a><span class="op">}</span></span>
<span id="cb272-10"><a href="lookatproject.html#cb272-10"></a></span>
<span id="cb272-11"><a href="lookatproject.html#cb272-11"></a><span class="dt">void</span> Camera<span class="op">::</span>computeViewMatrix<span class="op">()</span> <span class="op">{</span></span>
<span id="cb272-12"><a href="lookatproject.html#cb272-12"></a>  <span class="va">m_viewMatrix</span> <span class="op">=</span> glm<span class="op">::</span>lookAt<span class="op">(</span><span class="va">m_eye</span><span class="op">,</span> <span class="va">m_at</span><span class="op">,</span> <span class="va">m_up</span><span class="op">);</span></span>
<span id="cb272-13"><a href="lookatproject.html#cb272-13"></a><span class="op">}</span></span>
<span id="cb272-14"><a href="lookatproject.html#cb272-14"></a></span>
<span id="cb272-15"><a href="lookatproject.html#cb272-15"></a><span class="dt">void</span> Camera<span class="op">::</span>dolly<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb272-16"><a href="lookatproject.html#cb272-16"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb272-17"><a href="lookatproject.html#cb272-17"></a>  <span class="kw">auto</span> <span class="at">const</span> forward<span class="op">{</span>glm<span class="op">::</span>normalize<span class="op">(</span><span class="va">m_at</span> <span class="op">-</span> <span class="va">m_eye</span><span class="op">)};</span></span>
<span id="cb272-18"><a href="lookatproject.html#cb272-18"></a></span>
<span id="cb272-19"><a href="lookatproject.html#cb272-19"></a>  <span class="co">// Move eye and center forward (speed &gt; 0) or backward (speed &lt; 0)</span></span>
<span id="cb272-20"><a href="lookatproject.html#cb272-20"></a>  <span class="va">m_eye</span> <span class="op">+=</span> forward <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb272-21"><a href="lookatproject.html#cb272-21"></a>  <span class="va">m_at</span> <span class="op">+=</span> forward <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb272-22"><a href="lookatproject.html#cb272-22"></a></span>
<span id="cb272-23"><a href="lookatproject.html#cb272-23"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb272-24"><a href="lookatproject.html#cb272-24"></a><span class="op">}</span></span>
<span id="cb272-25"><a href="lookatproject.html#cb272-25"></a></span>
<span id="cb272-26"><a href="lookatproject.html#cb272-26"></a><span class="dt">void</span> Camera<span class="op">::</span>truck<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb272-27"><a href="lookatproject.html#cb272-27"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb272-28"><a href="lookatproject.html#cb272-28"></a>  <span class="kw">auto</span> <span class="at">const</span> forward<span class="op">{</span>glm<span class="op">::</span>normalize<span class="op">(</span><span class="va">m_at</span> <span class="op">-</span> <span class="va">m_eye</span><span class="op">)};</span></span>
<span id="cb272-29"><a href="lookatproject.html#cb272-29"></a>  <span class="co">// Compute vector to the left</span></span>
<span id="cb272-30"><a href="lookatproject.html#cb272-30"></a>  <span class="kw">auto</span> <span class="at">const</span> left<span class="op">{</span>glm<span class="op">::</span>cross<span class="op">(</span><span class="va">m_up</span><span class="op">,</span> forward<span class="op">)};</span></span>
<span id="cb272-31"><a href="lookatproject.html#cb272-31"></a></span>
<span id="cb272-32"><a href="lookatproject.html#cb272-32"></a>  <span class="co">// Move eye and center to the left (speed &lt; 0) or to the right (speed &gt; 0)</span></span>
<span id="cb272-33"><a href="lookatproject.html#cb272-33"></a>  <span class="va">m_at</span> <span class="op">-=</span> left <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb272-34"><a href="lookatproject.html#cb272-34"></a>  <span class="va">m_eye</span> <span class="op">-=</span> left <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb272-35"><a href="lookatproject.html#cb272-35"></a></span>
<span id="cb272-36"><a href="lookatproject.html#cb272-36"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb272-37"><a href="lookatproject.html#cb272-37"></a><span class="op">}</span></span>
<span id="cb272-38"><a href="lookatproject.html#cb272-38"></a></span>
<span id="cb272-39"><a href="lookatproject.html#cb272-39"></a><span class="dt">void</span> Camera<span class="op">::</span>pan<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb272-40"><a href="lookatproject.html#cb272-40"></a>  glm<span class="op">::</span>mat4 transform<span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb272-41"><a href="lookatproject.html#cb272-41"></a></span>
<span id="cb272-42"><a href="lookatproject.html#cb272-42"></a>  <span class="co">// Rotate camera around its local y axis</span></span>
<span id="cb272-43"><a href="lookatproject.html#cb272-43"></a>  transform <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>transform<span class="op">,</span> <span class="va">m_eye</span><span class="op">);</span></span>
<span id="cb272-44"><a href="lookatproject.html#cb272-44"></a>  transform <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>transform<span class="op">,</span> <span class="op">-</span>speed<span class="op">,</span> <span class="va">m_up</span><span class="op">);</span></span>
<span id="cb272-45"><a href="lookatproject.html#cb272-45"></a>  transform <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>transform<span class="op">,</span> <span class="op">-</span><span class="va">m_eye</span><span class="op">);</span></span>
<span id="cb272-46"><a href="lookatproject.html#cb272-46"></a></span>
<span id="cb272-47"><a href="lookatproject.html#cb272-47"></a>  <span class="va">m_at</span> <span class="op">=</span> transform <span class="op">*</span> glm<span class="op">::</span>vec4<span class="op">(</span><span class="va">m_at</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb272-48"><a href="lookatproject.html#cb272-48"></a></span>
<span id="cb272-49"><a href="lookatproject.html#cb272-49"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb272-50"><a href="lookatproject.html#cb272-50"></a><span class="op">}</span></span></code></pre></div>
<p>No próximo capítulo, quando tivermos visto o conteúdo teórico sobre matrizes de projeção, descreveremos o funcionamento da função <code>Camera::computeProjectionMatrix</code>. Por enquanto, basta sabermos que ela calcula uma matriz de projeção perspectiva.</p>
<p>Em <code>Camera::computeViewMatrix</code>, chamamos a função <code>lookAt</code> da GLM usando os atributos da câmera:</p>
<div class="sourceCode" id="cb273" startFrom="11"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 10;"><span id="cb273-11"><a href="lookatproject.html#cb273-11"></a><span class="dt">void</span> Camera<span class="op">::</span>computeViewMatrix<span class="op">()</span> <span class="op">{</span></span>
<span id="cb273-12"><a href="lookatproject.html#cb273-12"></a>  <span class="va">m_viewMatrix</span> <span class="op">=</span> glm<span class="op">::</span>lookAt<span class="op">(</span><span class="va">m_eye</span><span class="op">,</span> <span class="va">m_at</span><span class="op">,</span> <span class="va">m_up</span><span class="op">);</span></span>
<span id="cb273-13"><a href="lookatproject.html#cb273-13"></a><span class="op">}</span></span></code></pre></div>
<p><code>Camera::computeViewMatrix</code> será chamada sempre que houver alguma alteração em <code>m_eye</code> ou <code>m_at</code>.</p>
<p>Em <code>Camera::dolly</code>, os pontos <code>m_eye</code> e <code>m_at</code> são deslocados para a frente ou para trás ao longo da direção de visão (vetor <code>forward</code>):</p>
<div class="sourceCode" id="cb274" startFrom="15"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb274-15"><a href="lookatproject.html#cb274-15"></a><span class="dt">void</span> Camera<span class="op">::</span>dolly<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb274-16"><a href="lookatproject.html#cb274-16"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb274-17"><a href="lookatproject.html#cb274-17"></a>  <span class="kw">auto</span> <span class="at">const</span> forward<span class="op">{</span>glm<span class="op">::</span>normalize<span class="op">(</span><span class="va">m_at</span> <span class="op">-</span> <span class="va">m_eye</span><span class="op">)};</span></span>
<span id="cb274-18"><a href="lookatproject.html#cb274-18"></a></span>
<span id="cb274-19"><a href="lookatproject.html#cb274-19"></a>  <span class="co">// Move eye and center forward (speed &gt; 0) or backward (speed &lt; 0)</span></span>
<span id="cb274-20"><a href="lookatproject.html#cb274-20"></a>  <span class="va">m_eye</span> <span class="op">+=</span> forward <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb274-21"><a href="lookatproject.html#cb274-21"></a>  <span class="va">m_at</span> <span class="op">+=</span> forward <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb274-22"><a href="lookatproject.html#cb274-22"></a></span>
<span id="cb274-23"><a href="lookatproject.html#cb274-23"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb274-24"><a href="lookatproject.html#cb274-24"></a><span class="op">}</span></span></code></pre></div>
<p>Veja que, ao final, <code>Camera::computeViewMatrix</code> é chamada para reconstruir a matriz de visão.</p>
<p><code>Camera::truck</code> funciona de forma parecida com <code>Camera::dolly</code>. Os pontos <code>m_eye</code> e <code>m_at</code> são deslocados nas laterais de acordo com a direção do vetor <code>left</code>. O vetor <code>left</code> é o produto vetorial entre o vetor <code>up</code> e o vetor <code>forward</code>.</p>
<div class="sourceCode" id="cb275" startFrom="26"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 25;"><span id="cb275-26"><a href="lookatproject.html#cb275-26"></a><span class="dt">void</span> Camera<span class="op">::</span>truck<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb275-27"><a href="lookatproject.html#cb275-27"></a>  <span class="co">// Compute forward vector (view direction)</span></span>
<span id="cb275-28"><a href="lookatproject.html#cb275-28"></a>  <span class="kw">auto</span> <span class="at">const</span> forward<span class="op">{</span>glm<span class="op">::</span>normalize<span class="op">(</span><span class="va">m_at</span> <span class="op">-</span> <span class="va">m_eye</span><span class="op">)};</span></span>
<span id="cb275-29"><a href="lookatproject.html#cb275-29"></a>  <span class="co">// Compute vector to the left</span></span>
<span id="cb275-30"><a href="lookatproject.html#cb275-30"></a>  <span class="kw">auto</span> <span class="at">const</span> left<span class="op">{</span>glm<span class="op">::</span>cross<span class="op">(</span><span class="va">m_up</span><span class="op">,</span> forward<span class="op">)};</span></span>
<span id="cb275-31"><a href="lookatproject.html#cb275-31"></a></span>
<span id="cb275-32"><a href="lookatproject.html#cb275-32"></a>  <span class="co">// Move eye and center to the left (speed &lt; 0) or to the right (speed &gt; 0)</span></span>
<span id="cb275-33"><a href="lookatproject.html#cb275-33"></a>  <span class="va">m_at</span> <span class="op">-=</span> left <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb275-34"><a href="lookatproject.html#cb275-34"></a>  <span class="va">m_eye</span> <span class="op">-=</span> left <span class="op">*</span> speed<span class="op">;</span></span>
<span id="cb275-35"><a href="lookatproject.html#cb275-35"></a></span>
<span id="cb275-36"><a href="lookatproject.html#cb275-36"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb275-37"><a href="lookatproject.html#cb275-37"></a><span class="op">}</span></span></code></pre></div>
<p><code>Camera::pan</code> faz o movimento de girar a câmera em torno de seu eixo <span class="math inline">\(y\)</span>. Isso é feito alterando apenas o ponto <code>m_at</code>:</p>
<div class="sourceCode" id="cb276" startFrom="39"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 38;"><span id="cb276-39"><a href="lookatproject.html#cb276-39"></a><span class="dt">void</span> Camera<span class="op">::</span>pan<span class="op">(</span><span class="dt">float</span> speed<span class="op">)</span> <span class="op">{</span></span>
<span id="cb276-40"><a href="lookatproject.html#cb276-40"></a>  glm<span class="op">::</span>mat4 transform<span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb276-41"><a href="lookatproject.html#cb276-41"></a></span>
<span id="cb276-42"><a href="lookatproject.html#cb276-42"></a>  <span class="co">// Rotate camera around its local y axis</span></span>
<span id="cb276-43"><a href="lookatproject.html#cb276-43"></a>  transform <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>transform<span class="op">,</span> <span class="va">m_eye</span><span class="op">);</span></span>
<span id="cb276-44"><a href="lookatproject.html#cb276-44"></a>  transform <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>transform<span class="op">,</span> <span class="op">-</span>speed<span class="op">,</span> <span class="va">m_up</span><span class="op">);</span></span>
<span id="cb276-45"><a href="lookatproject.html#cb276-45"></a>  transform <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>transform<span class="op">,</span> <span class="op">-</span><span class="va">m_eye</span><span class="op">);</span></span>
<span id="cb276-46"><a href="lookatproject.html#cb276-46"></a></span>
<span id="cb276-47"><a href="lookatproject.html#cb276-47"></a>  <span class="va">m_at</span> <span class="op">=</span> transform <span class="op">*</span> glm<span class="op">::</span>vec4<span class="op">(</span><span class="va">m_at</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb276-48"><a href="lookatproject.html#cb276-48"></a></span>
<span id="cb276-49"><a href="lookatproject.html#cb276-49"></a>  computeViewMatrix<span class="op">();</span></span>
<span id="cb276-50"><a href="lookatproject.html#cb276-50"></a><span class="op">}</span></span></code></pre></div>
<p>Após a linha 40, a matriz <code>transform</code> representa uma concatenação de transformações na forma:</p>
<p><span class="math display">\[
\mathbf{M}=\mathbf{I}.\mathbf{T}(\mathbf{p}_{\textrm{eye}}).\mathbf{R}_y(\theta).\mathbf{T}(-\mathbf{p}_{\textrm{eye}}).
\]</span></p>
<p>A ordem de aplicação das transformações é obtida lendo a expressão acima da direita para a esquerda (no código, lemos de baixo para cima, da linha 45 à linha 40):</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\mathbf{T}(-\mathbf{p}_{\textrm{eye}})\)</span> (linha 45) tem o efeito de transladar a câmera para a origem do mundo, isto é, faz o ponto <span class="math inline">\(\mathbf{p}_{\textrm{eye}}\)</span> virar a origem <span class="math inline">\(O\)</span>.</li>
<li><span class="math inline">\(\mathbf{R}_y(\theta)\)</span> (linha 44) roda a câmera em torno do eixo <span class="math inline">\(y\)</span> do mundo. Como a câmera agora está na origem, é como se a câmera fosse girada em torno de seu próprio eixo <span class="math inline">\(y\)</span>.</li>
<li><span class="math inline">\(\mathbf{T}(\mathbf{p}_{\textrm{eye}})\)</span> (linha 43) é a transformação inversa da primeira, isto é, faz a câmera voltar à sua posição original (mas note que, por causa do passo anterior, a orientação da câmera não é mais a orientação original).</li>
<li><span class="math inline">\(\mathbf{I}\)</span> é a matriz identidade (criada na linha 40).</li>
</ol>
<p>A linha 47 transforma <code>m_at</code> por <code>transform</code>. O resultado é rodar <code>m_at</code> em torno do eixo <span class="math inline">\(y\)</span> local da câmera.</p>
<div class="infobox">
<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1.4em;width:1.4em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#555;overflow:visible;position:relative;"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>
<div class="infoboxtitle">
Observação
</div>
<p>As operações da linha 40 até a linha 45 em <code>Camera::pan</code> são equivalentes ao pseudocódigo:</p>
<pre><code>transform = I;
transform = transform * T(m_eye);
transform = transform * Ry(-speed);
transform = transform * T(-m_eye);</code></pre>
<p>que é o mesmo que</p>
<pre><code>transform = I * T(m_eye) * Ry(-speed) * T(-m_eye);</code></pre>
<p>onde <code>I</code>, <code>Ry</code> e <code>T</code> são as matrizes de transformação identidade, rotação em <span class="math inline">\(y\)</span>, e translação.</p>
</div>
</div>
<div id="window.hpp-7" class="section level3 unnumbered hasAnchor">
<h3>window.hpp<a href="lookatproject.html#window.hpp-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Deixaremos a definição da classe <code>Window</code> como a seguir:</p>
<div class="sourceCode" id="cb279" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb279-1"><a href="lookatproject.html#cb279-1"></a><span class="pp">#ifndef WINDOW_HPP_</span></span>
<span id="cb279-2"><a href="lookatproject.html#cb279-2"></a><span class="pp">#define WINDOW_HPP_</span></span>
<span id="cb279-3"><a href="lookatproject.html#cb279-3"></a></span>
<span id="cb279-4"><a href="lookatproject.html#cb279-4"></a><span class="pp">#include </span><span class="im">&quot;abcgOpenGL.hpp&quot;</span></span>
<span id="cb279-5"><a href="lookatproject.html#cb279-5"></a></span>
<span id="cb279-6"><a href="lookatproject.html#cb279-6"></a><span class="pp">#include </span><span class="im">&quot;camera.hpp&quot;</span></span>
<span id="cb279-7"><a href="lookatproject.html#cb279-7"></a><span class="pp">#include </span><span class="im">&quot;ground.hpp&quot;</span></span>
<span id="cb279-8"><a href="lookatproject.html#cb279-8"></a></span>
<span id="cb279-9"><a href="lookatproject.html#cb279-9"></a><span class="kw">struct</span> Vertex <span class="op">{</span></span>
<span id="cb279-10"><a href="lookatproject.html#cb279-10"></a>  glm<span class="op">::</span>vec3 position<span class="op">;</span></span>
<span id="cb279-11"><a href="lookatproject.html#cb279-11"></a></span>
<span id="cb279-12"><a href="lookatproject.html#cb279-12"></a>  <span class="kw">friend</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">==(</span>Vertex <span class="at">const</span> <span class="op">&amp;,</span> Vertex <span class="at">const</span> <span class="op">&amp;)</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb279-13"><a href="lookatproject.html#cb279-13"></a><span class="op">};</span></span>
<span id="cb279-14"><a href="lookatproject.html#cb279-14"></a></span>
<span id="cb279-15"><a href="lookatproject.html#cb279-15"></a><span class="kw">class</span> Window <span class="op">:</span> <span class="kw">public</span> abcg<span class="op">::</span>OpenGLWindow <span class="op">{</span></span>
<span id="cb279-16"><a href="lookatproject.html#cb279-16"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb279-17"><a href="lookatproject.html#cb279-17"></a>  <span class="dt">void</span> onEvent<span class="op">(</span>SDL_Event <span class="at">const</span> <span class="op">&amp;</span>event<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-18"><a href="lookatproject.html#cb279-18"></a>  <span class="dt">void</span> onCreate<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-19"><a href="lookatproject.html#cb279-19"></a>  <span class="dt">void</span> onPaint<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-20"><a href="lookatproject.html#cb279-20"></a>  <span class="dt">void</span> onPaintUI<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-21"><a href="lookatproject.html#cb279-21"></a>  <span class="dt">void</span> onResize<span class="op">(</span>glm<span class="op">::</span>ivec2 <span class="at">const</span> <span class="op">&amp;</span>size<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-22"><a href="lookatproject.html#cb279-22"></a>  <span class="dt">void</span> onDestroy<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-23"><a href="lookatproject.html#cb279-23"></a>  <span class="dt">void</span> onUpdate<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb279-24"><a href="lookatproject.html#cb279-24"></a></span>
<span id="cb279-25"><a href="lookatproject.html#cb279-25"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb279-26"><a href="lookatproject.html#cb279-26"></a>  glm<span class="op">::</span>ivec2 <span class="va">m_viewportSize</span><span class="op">{};</span></span>
<span id="cb279-27"><a href="lookatproject.html#cb279-27"></a></span>
<span id="cb279-28"><a href="lookatproject.html#cb279-28"></a>  GLuint <span class="va">m_VAO</span><span class="op">{};</span></span>
<span id="cb279-29"><a href="lookatproject.html#cb279-29"></a>  GLuint <span class="va">m_VBO</span><span class="op">{};</span></span>
<span id="cb279-30"><a href="lookatproject.html#cb279-30"></a>  GLuint <span class="va">m_EBO</span><span class="op">{};</span></span>
<span id="cb279-31"><a href="lookatproject.html#cb279-31"></a>  GLuint <span class="va">m_program</span><span class="op">{};</span></span>
<span id="cb279-32"><a href="lookatproject.html#cb279-32"></a></span>
<span id="cb279-33"><a href="lookatproject.html#cb279-33"></a>  GLint <span class="va">m_viewMatrixLocation</span><span class="op">{};</span></span>
<span id="cb279-34"><a href="lookatproject.html#cb279-34"></a>  GLint <span class="va">m_projMatrixLocation</span><span class="op">{};</span></span>
<span id="cb279-35"><a href="lookatproject.html#cb279-35"></a>  GLint <span class="va">m_modelMatrixLocation</span><span class="op">{};</span></span>
<span id="cb279-36"><a href="lookatproject.html#cb279-36"></a>  GLint <span class="va">m_colorLocation</span><span class="op">{};</span></span>
<span id="cb279-37"><a href="lookatproject.html#cb279-37"></a></span>
<span id="cb279-38"><a href="lookatproject.html#cb279-38"></a>  Camera <span class="va">m_camera</span><span class="op">;</span></span>
<span id="cb279-39"><a href="lookatproject.html#cb279-39"></a>  <span class="dt">float</span> <span class="va">m_dollySpeed</span><span class="op">{};</span></span>
<span id="cb279-40"><a href="lookatproject.html#cb279-40"></a>  <span class="dt">float</span> <span class="va">m_truckSpeed</span><span class="op">{};</span></span>
<span id="cb279-41"><a href="lookatproject.html#cb279-41"></a>  <span class="dt">float</span> <span class="va">m_panSpeed</span><span class="op">{};</span></span>
<span id="cb279-42"><a href="lookatproject.html#cb279-42"></a></span>
<span id="cb279-43"><a href="lookatproject.html#cb279-43"></a>  Ground <span class="va">m_ground</span><span class="op">;</span></span>
<span id="cb279-44"><a href="lookatproject.html#cb279-44"></a></span>
<span id="cb279-45"><a href="lookatproject.html#cb279-45"></a>  <span class="bu">std::</span>vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> <span class="va">m_vertices</span><span class="op">;</span></span>
<span id="cb279-46"><a href="lookatproject.html#cb279-46"></a>  <span class="bu">std::</span>vector<span class="op">&lt;</span>GLuint<span class="op">&gt;</span> <span class="va">m_indices</span><span class="op">;</span></span>
<span id="cb279-47"><a href="lookatproject.html#cb279-47"></a></span>
<span id="cb279-48"><a href="lookatproject.html#cb279-48"></a>  <span class="dt">void</span> loadModelFromFile<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>path<span class="op">);</span></span>
<span id="cb279-49"><a href="lookatproject.html#cb279-49"></a><span class="op">};</span></span>
<span id="cb279-50"><a href="lookatproject.html#cb279-50"></a></span>
<span id="cb279-51"><a href="lookatproject.html#cb279-51"></a><span class="pp">#endif</span></span></code></pre></div>
<p>O código é semelhante ao dos projetos anteriores. As principais diferenças estão nas seguintes linhas:</p>
<ul>
<li>Linhas 6 e 7: inclusão dos cabeçalhos <code>camera.hpp</code> e <code>ground.hpp</code>;</li>
<li>Linhas 33 a 36: identificadores das variáveis <code>uniform</code> do vertex shader;</li>
<li>Linha 38: definição de um objeto da classe <code>Camera</code> para controlar a câmera LookAt;</li>
<li>Linhas 39 a 41: definição de variáveis de controle de velocidade de dolly, truck e pan;</li>
<li>Linha 43: definição de um objeto da classe <code>Ground</code> para desenhar o chão.</li>
</ul>
<p>Algumas coisas foram removidas em relação ao projeto <code>loadmodel</code>, como a variável que controlava o número de triângulos exibidos e a função <code>OpenGLWindow::standardize</code> que normalizava e centralizava o modelo no NDC. Dessa vez, o modelo armazenado no VBO será o modelo sem modificações, isto é, o modelo lido diretamente do arquivo. Para mudar a escala e posição do modelo, usaremos a matriz de modelo.</p>
</div>
<div id="window.cpp-7" class="section level3 unnumbered hasAnchor">
<h3>window.cpp<a href="lookatproject.html#window.cpp-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>No início de <code>window.cpp</code> fazemos a especialização explícita de <code>std::hash</code> para <code>Vertex</code>, como fizemos no projeto anterior:</p>
<div class="sourceCode" id="cb280" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb280-1"><a href="lookatproject.html#cb280-1"></a><span class="pp">#include </span><span class="im">&quot;window.hpp&quot;</span></span>
<span id="cb280-2"><a href="lookatproject.html#cb280-2"></a></span>
<span id="cb280-3"><a href="lookatproject.html#cb280-3"></a><span class="pp">#include </span><span class="im">&lt;unordered_map&gt;</span></span>
<span id="cb280-4"><a href="lookatproject.html#cb280-4"></a></span>
<span id="cb280-5"><a href="lookatproject.html#cb280-5"></a><span class="co">// Explicit specialization of std::hash for Vertex</span></span>
<span id="cb280-6"><a href="lookatproject.html#cb280-6"></a><span class="kw">template</span> <span class="op">&lt;&gt;</span> <span class="kw">struct</span> <span class="bu">std::</span>hash<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb280-7"><a href="lookatproject.html#cb280-7"></a>  <span class="dt">size_t</span> <span class="kw">operator</span><span class="op">()(</span>Vertex <span class="at">const</span> <span class="op">&amp;</span>vertex<span class="op">)</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb280-8"><a href="lookatproject.html#cb280-8"></a>    <span class="kw">auto</span> <span class="at">const</span> h1<span class="op">{</span><span class="bu">std::</span>hash<span class="op">&lt;</span>glm<span class="op">::</span>vec3<span class="op">&gt;()(</span>vertex<span class="op">.</span>position<span class="op">)};</span></span>
<span id="cb280-9"><a href="lookatproject.html#cb280-9"></a>    <span class="cf">return</span> h1<span class="op">;</span></span>
<span id="cb280-10"><a href="lookatproject.html#cb280-10"></a>  <span class="op">}</span></span>
<span id="cb280-11"><a href="lookatproject.html#cb280-11"></a><span class="op">};</span></span></code></pre></div>
<p>A definição de <code>Window::onEvent</code> vem a seguir:</p>
<div class="sourceCode" id="cb281" startFrom="13"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 12;"><span id="cb281-13"><a href="lookatproject.html#cb281-13"></a><span class="dt">void</span> Window<span class="op">::</span>onEvent<span class="op">(</span>SDL_Event <span class="at">const</span> <span class="op">&amp;</span>event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-14"><a href="lookatproject.html#cb281-14"></a>  <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>type <span class="op">==</span> SDL_KEYDOWN<span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-15"><a href="lookatproject.html#cb281-15"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_UP <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_w<span class="op">)</span></span>
<span id="cb281-16"><a href="lookatproject.html#cb281-16"></a>      <span class="va">m_dollySpeed</span> <span class="op">=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-17"><a href="lookatproject.html#cb281-17"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_DOWN <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_s<span class="op">)</span></span>
<span id="cb281-18"><a href="lookatproject.html#cb281-18"></a>      <span class="va">m_dollySpeed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-19"><a href="lookatproject.html#cb281-19"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_LEFT <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_a<span class="op">)</span></span>
<span id="cb281-20"><a href="lookatproject.html#cb281-20"></a>      <span class="va">m_panSpeed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-21"><a href="lookatproject.html#cb281-21"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_RIGHT <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_d<span class="op">)</span></span>
<span id="cb281-22"><a href="lookatproject.html#cb281-22"></a>      <span class="va">m_panSpeed</span> <span class="op">=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-23"><a href="lookatproject.html#cb281-23"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_q<span class="op">)</span></span>
<span id="cb281-24"><a href="lookatproject.html#cb281-24"></a>      <span class="va">m_truckSpeed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-25"><a href="lookatproject.html#cb281-25"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_e<span class="op">)</span></span>
<span id="cb281-26"><a href="lookatproject.html#cb281-26"></a>      <span class="va">m_truckSpeed</span> <span class="op">=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-27"><a href="lookatproject.html#cb281-27"></a>  <span class="op">}</span></span>
<span id="cb281-28"><a href="lookatproject.html#cb281-28"></a>  <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>type <span class="op">==</span> SDL_KEYUP<span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-29"><a href="lookatproject.html#cb281-29"></a>    <span class="cf">if</span> <span class="op">((</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_UP <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_w<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb281-30"><a href="lookatproject.html#cb281-30"></a>        <span class="va">m_dollySpeed</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-31"><a href="lookatproject.html#cb281-31"></a>      <span class="va">m_dollySpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-32"><a href="lookatproject.html#cb281-32"></a>    <span class="cf">if</span> <span class="op">((</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_DOWN <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_s<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb281-33"><a href="lookatproject.html#cb281-33"></a>        <span class="va">m_dollySpeed</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-34"><a href="lookatproject.html#cb281-34"></a>      <span class="va">m_dollySpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-35"><a href="lookatproject.html#cb281-35"></a>    <span class="cf">if</span> <span class="op">((</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_LEFT <span class="op">||</span> event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_a<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb281-36"><a href="lookatproject.html#cb281-36"></a>        <span class="va">m_panSpeed</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-37"><a href="lookatproject.html#cb281-37"></a>      <span class="va">m_panSpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-38"><a href="lookatproject.html#cb281-38"></a>    <span class="cf">if</span> <span class="op">((</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_RIGHT <span class="op">||</span></span>
<span id="cb281-39"><a href="lookatproject.html#cb281-39"></a>         event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_d<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb281-40"><a href="lookatproject.html#cb281-40"></a>        <span class="va">m_panSpeed</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-41"><a href="lookatproject.html#cb281-41"></a>      <span class="va">m_panSpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-42"><a href="lookatproject.html#cb281-42"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_q <span class="op">&amp;&amp;</span> <span class="va">m_truckSpeed</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-43"><a href="lookatproject.html#cb281-43"></a>      <span class="va">m_truckSpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-44"><a href="lookatproject.html#cb281-44"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>key<span class="op">.</span>keysym<span class="op">.</span>sym <span class="op">==</span> SDLK_e <span class="op">&amp;&amp;</span> <span class="va">m_truckSpeed</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb281-45"><a href="lookatproject.html#cb281-45"></a>      <span class="va">m_truckSpeed</span> <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb281-46"><a href="lookatproject.html#cb281-46"></a>  <span class="op">}</span></span>
<span id="cb281-47"><a href="lookatproject.html#cb281-47"></a><span class="op">}</span></span></code></pre></div>
<p>Os eventos de teclado são tratados de forma separada para as teclas pressionadas (<code>SDL_KEYDOWN</code>, linhas 14 a 27) e para as teclas liberadas (<code>SDL_KEYUP</code>, linhas 28 a 46).</p>
<p>Quando uma tecla é pressionada (setas ou <code>QEWASD</code>), a velocidade de dolly, pan ou truck é modificada para +1 ou -1. Quando a tecla é liberada, a velocidade correspondente volta para 0.</p>
<p>Vamos agora à definição de <code>Window::onCreate</code>, que também é bem parecida com a do projeto <code>loadmodel</code>:</p>
<div class="sourceCode" id="cb282" startFrom="49"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 48;"><span id="cb282-49"><a href="lookatproject.html#cb282-49"></a><span class="dt">void</span> Window<span class="op">::</span>onCreate<span class="op">()</span> <span class="op">{</span></span>
<span id="cb282-50"><a href="lookatproject.html#cb282-50"></a>  <span class="kw">auto</span> <span class="at">const</span> <span class="op">&amp;</span>assetsPath<span class="op">{</span>abcg<span class="op">::</span>Application<span class="op">::</span>getAssetsPath<span class="op">()};</span></span>
<span id="cb282-51"><a href="lookatproject.html#cb282-51"></a></span>
<span id="cb282-52"><a href="lookatproject.html#cb282-52"></a>  abcg<span class="op">::</span>glClearColor<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb282-53"><a href="lookatproject.html#cb282-53"></a></span>
<span id="cb282-54"><a href="lookatproject.html#cb282-54"></a>  <span class="co">// Enable depth buffering</span></span>
<span id="cb282-55"><a href="lookatproject.html#cb282-55"></a>  abcg<span class="op">::</span>glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span>
<span id="cb282-56"><a href="lookatproject.html#cb282-56"></a></span>
<span id="cb282-57"><a href="lookatproject.html#cb282-57"></a>  <span class="co">// Create program</span></span>
<span id="cb282-58"><a href="lookatproject.html#cb282-58"></a>  <span class="va">m_program</span> <span class="op">=</span></span>
<span id="cb282-59"><a href="lookatproject.html#cb282-59"></a>      abcg<span class="op">::</span>createOpenGLProgram<span class="op">({{.</span>source <span class="op">=</span> assetsPath <span class="op">+</span> <span class="st">&quot;lookat.vert&quot;</span><span class="op">,</span></span>
<span id="cb282-60"><a href="lookatproject.html#cb282-60"></a>                                  <span class="op">.</span>stage <span class="op">=</span> abcg<span class="op">::</span>ShaderStage<span class="op">::</span>Vertex<span class="op">},</span></span>
<span id="cb282-61"><a href="lookatproject.html#cb282-61"></a>                                 <span class="op">{.</span>source <span class="op">=</span> assetsPath <span class="op">+</span> <span class="st">&quot;lookat.frag&quot;</span><span class="op">,</span></span>
<span id="cb282-62"><a href="lookatproject.html#cb282-62"></a>                                  <span class="op">.</span>stage <span class="op">=</span> abcg<span class="op">::</span>ShaderStage<span class="op">::</span>Fragment<span class="op">}});</span></span>
<span id="cb282-63"><a href="lookatproject.html#cb282-63"></a></span>
<span id="cb282-64"><a href="lookatproject.html#cb282-64"></a>  <span class="va">m_ground</span><span class="op">.</span>create<span class="op">(</span><span class="va">m_program</span><span class="op">);</span></span>
<span id="cb282-65"><a href="lookatproject.html#cb282-65"></a></span>
<span id="cb282-66"><a href="lookatproject.html#cb282-66"></a>  <span class="co">// Get location of uniform variables</span></span>
<span id="cb282-67"><a href="lookatproject.html#cb282-67"></a>  <span class="va">m_viewMatrixLocation</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span><span class="va">m_program</span><span class="op">,</span> <span class="st">&quot;viewMatrix&quot;</span><span class="op">);</span></span>
<span id="cb282-68"><a href="lookatproject.html#cb282-68"></a>  <span class="va">m_projMatrixLocation</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span><span class="va">m_program</span><span class="op">,</span> <span class="st">&quot;projMatrix&quot;</span><span class="op">);</span></span>
<span id="cb282-69"><a href="lookatproject.html#cb282-69"></a>  <span class="va">m_modelMatrixLocation</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span><span class="va">m_program</span><span class="op">,</span> <span class="st">&quot;modelMatrix&quot;</span><span class="op">);</span></span>
<span id="cb282-70"><a href="lookatproject.html#cb282-70"></a>  <span class="va">m_colorLocation</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span><span class="va">m_program</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">);</span></span>
<span id="cb282-71"><a href="lookatproject.html#cb282-71"></a></span>
<span id="cb282-72"><a href="lookatproject.html#cb282-72"></a>  <span class="co">// Load model</span></span>
<span id="cb282-73"><a href="lookatproject.html#cb282-73"></a>  loadModelFromFile<span class="op">(</span>assetsPath <span class="op">+</span> <span class="st">&quot;bunny.obj&quot;</span><span class="op">);</span></span>
<span id="cb282-74"><a href="lookatproject.html#cb282-74"></a></span>
<span id="cb282-75"><a href="lookatproject.html#cb282-75"></a>  <span class="co">// Generate VBO</span></span>
<span id="cb282-76"><a href="lookatproject.html#cb282-76"></a>  abcg<span class="op">::</span>glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb282-77"><a href="lookatproject.html#cb282-77"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb282-78"><a href="lookatproject.html#cb282-78"></a>  abcg<span class="op">::</span>glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span></span>
<span id="cb282-79"><a href="lookatproject.html#cb282-79"></a>                     <span class="kw">sizeof</span><span class="op">(</span><span class="va">m_vertices</span><span class="op">.</span>at<span class="op">(</span><span class="dv">0</span><span class="op">))</span> <span class="op">*</span> <span class="va">m_vertices</span><span class="op">.</span>size<span class="op">(),</span></span>
<span id="cb282-80"><a href="lookatproject.html#cb282-80"></a>                     <span class="va">m_vertices</span><span class="op">.</span>data<span class="op">(),</span> GL_STATIC_DRAW<span class="op">);</span></span>
<span id="cb282-81"><a href="lookatproject.html#cb282-81"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb282-82"><a href="lookatproject.html#cb282-82"></a></span>
<span id="cb282-83"><a href="lookatproject.html#cb282-83"></a>  <span class="co">// Generate EBO</span></span>
<span id="cb282-84"><a href="lookatproject.html#cb282-84"></a>  abcg<span class="op">::</span>glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_EBO</span><span class="op">);</span></span>
<span id="cb282-85"><a href="lookatproject.html#cb282-85"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_EBO</span><span class="op">);</span></span>
<span id="cb282-86"><a href="lookatproject.html#cb282-86"></a>  abcg<span class="op">::</span>glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span></span>
<span id="cb282-87"><a href="lookatproject.html#cb282-87"></a>                     <span class="kw">sizeof</span><span class="op">(</span><span class="va">m_indices</span><span class="op">.</span>at<span class="op">(</span><span class="dv">0</span><span class="op">))</span> <span class="op">*</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span></span>
<span id="cb282-88"><a href="lookatproject.html#cb282-88"></a>                     <span class="va">m_indices</span><span class="op">.</span>data<span class="op">(),</span> GL_STATIC_DRAW<span class="op">);</span></span>
<span id="cb282-89"><a href="lookatproject.html#cb282-89"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb282-90"><a href="lookatproject.html#cb282-90"></a></span>
<span id="cb282-91"><a href="lookatproject.html#cb282-91"></a>  <span class="co">// Create VAO</span></span>
<span id="cb282-92"><a href="lookatproject.html#cb282-92"></a>  abcg<span class="op">::</span>glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb282-93"><a href="lookatproject.html#cb282-93"></a></span>
<span id="cb282-94"><a href="lookatproject.html#cb282-94"></a>  <span class="co">// Bind vertex attributes to current VAO</span></span>
<span id="cb282-95"><a href="lookatproject.html#cb282-95"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb282-96"><a href="lookatproject.html#cb282-96"></a></span>
<span id="cb282-97"><a href="lookatproject.html#cb282-97"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb282-98"><a href="lookatproject.html#cb282-98"></a>  <span class="kw">auto</span> <span class="at">const</span> positionAttribute<span class="op">{</span></span>
<span id="cb282-99"><a href="lookatproject.html#cb282-99"></a>      abcg<span class="op">::</span>glGetAttribLocation<span class="op">(</span><span class="va">m_program</span><span class="op">,</span> <span class="st">&quot;inPosition&quot;</span><span class="op">)};</span></span>
<span id="cb282-100"><a href="lookatproject.html#cb282-100"></a>  abcg<span class="op">::</span>glEnableVertexAttribArray<span class="op">(</span>positionAttribute<span class="op">);</span></span>
<span id="cb282-101"><a href="lookatproject.html#cb282-101"></a>  abcg<span class="op">::</span>glVertexAttribPointer<span class="op">(</span>positionAttribute<span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span></span>
<span id="cb282-102"><a href="lookatproject.html#cb282-102"></a>                              <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb282-103"><a href="lookatproject.html#cb282-103"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb282-104"><a href="lookatproject.html#cb282-104"></a></span>
<span id="cb282-105"><a href="lookatproject.html#cb282-105"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_EBO</span><span class="op">);</span></span>
<span id="cb282-106"><a href="lookatproject.html#cb282-106"></a></span>
<span id="cb282-107"><a href="lookatproject.html#cb282-107"></a>  <span class="co">// End of binding to current VAO</span></span>
<span id="cb282-108"><a href="lookatproject.html#cb282-108"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb282-109"><a href="lookatproject.html#cb282-109"></a><span class="op">}</span></span></code></pre></div>
<p>Em relação ao projeto anterior, modificamos o nomes dos shaders lidos (linhas 58 a 62) e chamamos <code>Ground::create</code> na linha 64 para inicializar o VAO/VBO do chão.</p>
<p>A definição de <code>Window::loadModelFromFile</code> é a mesma do projeto anterior:</p>
<div class="sourceCode" id="cb283" startFrom="111"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 110;"><span id="cb283-111"><a href="lookatproject.html#cb283-111"></a><span class="dt">void</span> Window<span class="op">::</span>loadModelFromFile<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb283-112"><a href="lookatproject.html#cb283-112"></a>  tinyobj<span class="op">::</span>ObjReader reader<span class="op">;</span></span>
<span id="cb283-113"><a href="lookatproject.html#cb283-113"></a></span>
<span id="cb283-114"><a href="lookatproject.html#cb283-114"></a>  <span class="cf">if</span> <span class="op">(!</span>reader<span class="op">.</span>ParseFromFile<span class="op">(</span>path<span class="op">.</span>data<span class="op">()))</span> <span class="op">{</span></span>
<span id="cb283-115"><a href="lookatproject.html#cb283-115"></a>    <span class="cf">if</span> <span class="op">(!</span>reader<span class="op">.</span>Error<span class="op">().</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb283-116"><a href="lookatproject.html#cb283-116"></a>      <span class="cf">throw</span> abcg<span class="op">::</span>RuntimeError<span class="op">(</span></span>
<span id="cb283-117"><a href="lookatproject.html#cb283-117"></a>          fmt<span class="op">::</span>format<span class="op">(</span><span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st"> (</span><span class="sc">{}</span><span class="st">)&quot;</span><span class="op">,</span> path<span class="op">,</span> reader<span class="op">.</span>Error<span class="op">()));</span></span>
<span id="cb283-118"><a href="lookatproject.html#cb283-118"></a>    <span class="op">}</span></span>
<span id="cb283-119"><a href="lookatproject.html#cb283-119"></a>    <span class="cf">throw</span> abcg<span class="op">::</span>RuntimeError<span class="op">(</span>fmt<span class="op">::</span>format<span class="op">(</span><span class="st">&quot;Failed to load model </span><span class="sc">{}</span><span class="st">&quot;</span><span class="op">,</span> path<span class="op">));</span></span>
<span id="cb283-120"><a href="lookatproject.html#cb283-120"></a>  <span class="op">}</span></span>
<span id="cb283-121"><a href="lookatproject.html#cb283-121"></a></span>
<span id="cb283-122"><a href="lookatproject.html#cb283-122"></a>  <span class="cf">if</span> <span class="op">(!</span>reader<span class="op">.</span>Warning<span class="op">().</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb283-123"><a href="lookatproject.html#cb283-123"></a>    fmt<span class="op">::</span>print<span class="op">(</span><span class="st">&quot;Warning: </span><span class="sc">{}\n</span><span class="st">&quot;</span><span class="op">,</span> reader<span class="op">.</span>Warning<span class="op">());</span></span>
<span id="cb283-124"><a href="lookatproject.html#cb283-124"></a>  <span class="op">}</span></span>
<span id="cb283-125"><a href="lookatproject.html#cb283-125"></a></span>
<span id="cb283-126"><a href="lookatproject.html#cb283-126"></a>  <span class="kw">auto</span> <span class="at">const</span> <span class="op">&amp;</span>attributes<span class="op">{</span>reader<span class="op">.</span>GetAttrib<span class="op">()};</span></span>
<span id="cb283-127"><a href="lookatproject.html#cb283-127"></a>  <span class="kw">auto</span> <span class="at">const</span> <span class="op">&amp;</span>shapes<span class="op">{</span>reader<span class="op">.</span>GetShapes<span class="op">()};</span></span>
<span id="cb283-128"><a href="lookatproject.html#cb283-128"></a></span>
<span id="cb283-129"><a href="lookatproject.html#cb283-129"></a>  <span class="va">m_vertices</span><span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb283-130"><a href="lookatproject.html#cb283-130"></a>  <span class="va">m_indices</span><span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb283-131"><a href="lookatproject.html#cb283-131"></a></span>
<span id="cb283-132"><a href="lookatproject.html#cb283-132"></a>  <span class="co">// A key:value map with key=Vertex and value=index</span></span>
<span id="cb283-133"><a href="lookatproject.html#cb283-133"></a>  <span class="bu">std::</span>unordered_map<span class="op">&lt;</span>Vertex<span class="op">,</span> GLuint<span class="op">&gt;</span> hash<span class="op">{};</span></span>
<span id="cb283-134"><a href="lookatproject.html#cb283-134"></a></span>
<span id="cb283-135"><a href="lookatproject.html#cb283-135"></a>  <span class="co">// Loop over shapes</span></span>
<span id="cb283-136"><a href="lookatproject.html#cb283-136"></a>  <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span> <span class="op">&amp;</span>shape <span class="op">:</span> shapes<span class="op">)</span> <span class="op">{</span></span>
<span id="cb283-137"><a href="lookatproject.html#cb283-137"></a>    <span class="co">// Loop over indices</span></span>
<span id="cb283-138"><a href="lookatproject.html#cb283-138"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span> offset <span class="op">:</span> iter<span class="op">::</span>range<span class="op">(</span>shape<span class="op">.</span>mesh<span class="op">.</span>indices<span class="op">.</span>size<span class="op">()))</span> <span class="op">{</span></span>
<span id="cb283-139"><a href="lookatproject.html#cb283-139"></a>      <span class="co">// Access to vertex</span></span>
<span id="cb283-140"><a href="lookatproject.html#cb283-140"></a>      <span class="kw">auto</span> <span class="at">const</span> index<span class="op">{</span>shape<span class="op">.</span>mesh<span class="op">.</span>indices<span class="op">.</span>at<span class="op">(</span>offset<span class="op">)};</span></span>
<span id="cb283-141"><a href="lookatproject.html#cb283-141"></a></span>
<span id="cb283-142"><a href="lookatproject.html#cb283-142"></a>      <span class="co">// Vertex position</span></span>
<span id="cb283-143"><a href="lookatproject.html#cb283-143"></a>      <span class="kw">auto</span> <span class="at">const</span> startIndex<span class="op">{</span><span class="dv">3</span> <span class="op">*</span> index<span class="op">.</span>vertex_index<span class="op">};</span></span>
<span id="cb283-144"><a href="lookatproject.html#cb283-144"></a>      <span class="kw">auto</span> <span class="at">const</span> vx<span class="op">{</span>attributes<span class="op">.</span>vertices<span class="op">.</span>at<span class="op">(</span>startIndex <span class="op">+</span> <span class="dv">0</span><span class="op">)};</span></span>
<span id="cb283-145"><a href="lookatproject.html#cb283-145"></a>      <span class="kw">auto</span> <span class="at">const</span> vy<span class="op">{</span>attributes<span class="op">.</span>vertices<span class="op">.</span>at<span class="op">(</span>startIndex <span class="op">+</span> <span class="dv">1</span><span class="op">)};</span></span>
<span id="cb283-146"><a href="lookatproject.html#cb283-146"></a>      <span class="kw">auto</span> <span class="at">const</span> vz<span class="op">{</span>attributes<span class="op">.</span>vertices<span class="op">.</span>at<span class="op">(</span>startIndex <span class="op">+</span> <span class="dv">2</span><span class="op">)};</span></span>
<span id="cb283-147"><a href="lookatproject.html#cb283-147"></a></span>
<span id="cb283-148"><a href="lookatproject.html#cb283-148"></a>      Vertex <span class="at">const</span> vertex<span class="op">{.</span>position <span class="op">=</span> <span class="op">{</span>vx<span class="op">,</span> vy<span class="op">,</span> vz<span class="op">}};</span></span>
<span id="cb283-149"><a href="lookatproject.html#cb283-149"></a></span>
<span id="cb283-150"><a href="lookatproject.html#cb283-150"></a>      <span class="co">// If map doesn&#39;t contain this vertex</span></span>
<span id="cb283-151"><a href="lookatproject.html#cb283-151"></a>      <span class="cf">if</span> <span class="op">(!</span>hash<span class="op">.</span>contains<span class="op">(</span>vertex<span class="op">))</span> <span class="op">{</span></span>
<span id="cb283-152"><a href="lookatproject.html#cb283-152"></a>        <span class="co">// Add this index (size of m_vertices)</span></span>
<span id="cb283-153"><a href="lookatproject.html#cb283-153"></a>        hash<span class="op">[</span>vertex<span class="op">]</span> <span class="op">=</span> <span class="va">m_vertices</span><span class="op">.</span>size<span class="op">();</span></span>
<span id="cb283-154"><a href="lookatproject.html#cb283-154"></a>        <span class="co">// Add this vertex</span></span>
<span id="cb283-155"><a href="lookatproject.html#cb283-155"></a>        <span class="va">m_vertices</span><span class="op">.</span>push_back<span class="op">(</span>vertex<span class="op">);</span></span>
<span id="cb283-156"><a href="lookatproject.html#cb283-156"></a>      <span class="op">}</span></span>
<span id="cb283-157"><a href="lookatproject.html#cb283-157"></a></span>
<span id="cb283-158"><a href="lookatproject.html#cb283-158"></a>      <span class="va">m_indices</span><span class="op">.</span>push_back<span class="op">(</span>hash<span class="op">[</span>vertex<span class="op">]);</span></span>
<span id="cb283-159"><a href="lookatproject.html#cb283-159"></a>    <span class="op">}</span></span>
<span id="cb283-160"><a href="lookatproject.html#cb283-160"></a>  <span class="op">}</span></span>
<span id="cb283-161"><a href="lookatproject.html#cb283-161"></a><span class="op">}</span></span></code></pre></div>
<p>Vamos à definição de <code>Window::onPaint</code>:</p>
<div class="sourceCode" id="cb284" startFrom="163"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 162;"><span id="cb284-163"><a href="lookatproject.html#cb284-163"></a><span class="dt">void</span> Window<span class="op">::</span>onPaint<span class="op">()</span> <span class="op">{</span></span>
<span id="cb284-164"><a href="lookatproject.html#cb284-164"></a>  <span class="co">// Clear color buffer and depth buffer</span></span>
<span id="cb284-165"><a href="lookatproject.html#cb284-165"></a>  abcg<span class="op">::</span>glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span>
<span id="cb284-166"><a href="lookatproject.html#cb284-166"></a></span>
<span id="cb284-167"><a href="lookatproject.html#cb284-167"></a>  abcg<span class="op">::</span>glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">m_viewportSize</span><span class="op">.</span>x<span class="op">,</span> <span class="va">m_viewportSize</span><span class="op">.</span>y<span class="op">);</span></span>
<span id="cb284-168"><a href="lookatproject.html#cb284-168"></a></span>
<span id="cb284-169"><a href="lookatproject.html#cb284-169"></a>  abcg<span class="op">::</span>glUseProgram<span class="op">(</span><span class="va">m_program</span><span class="op">);</span></span>
<span id="cb284-170"><a href="lookatproject.html#cb284-170"></a></span>
<span id="cb284-171"><a href="lookatproject.html#cb284-171"></a>  <span class="co">// Set uniform variables for viewMatrix and projMatrix</span></span>
<span id="cb284-172"><a href="lookatproject.html#cb284-172"></a>  <span class="co">// These matrices are used for every scene object</span></span>
<span id="cb284-173"><a href="lookatproject.html#cb284-173"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_viewMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span></span>
<span id="cb284-174"><a href="lookatproject.html#cb284-174"></a>                           <span class="op">&amp;</span><span class="va">m_camera</span><span class="op">.</span>getViewMatrix<span class="op">()[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-175"><a href="lookatproject.html#cb284-175"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_projMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span></span>
<span id="cb284-176"><a href="lookatproject.html#cb284-176"></a>                           <span class="op">&amp;</span><span class="va">m_camera</span><span class="op">.</span>getProjMatrix<span class="op">()[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-177"><a href="lookatproject.html#cb284-177"></a></span>
<span id="cb284-178"><a href="lookatproject.html#cb284-178"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb284-179"><a href="lookatproject.html#cb284-179"></a></span>
<span id="cb284-180"><a href="lookatproject.html#cb284-180"></a>  <span class="co">// Draw white bunny</span></span>
<span id="cb284-181"><a href="lookatproject.html#cb284-181"></a>  glm<span class="op">::</span>mat4 model<span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb284-182"><a href="lookatproject.html#cb284-182"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-183"><a href="lookatproject.html#cb284-183"></a>  model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">90.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb284-184"><a href="lookatproject.html#cb284-184"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-185"><a href="lookatproject.html#cb284-185"></a></span>
<span id="cb284-186"><a href="lookatproject.html#cb284-186"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-187"><a href="lookatproject.html#cb284-187"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb284-188"><a href="lookatproject.html#cb284-188"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb284-189"><a href="lookatproject.html#cb284-189"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb284-190"><a href="lookatproject.html#cb284-190"></a></span>
<span id="cb284-191"><a href="lookatproject.html#cb284-191"></a>  <span class="co">// Draw yellow bunny</span></span>
<span id="cb284-192"><a href="lookatproject.html#cb284-192"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb284-193"><a href="lookatproject.html#cb284-193"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-194"><a href="lookatproject.html#cb284-194"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-195"><a href="lookatproject.html#cb284-195"></a></span>
<span id="cb284-196"><a href="lookatproject.html#cb284-196"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-197"><a href="lookatproject.html#cb284-197"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb284-198"><a href="lookatproject.html#cb284-198"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb284-199"><a href="lookatproject.html#cb284-199"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb284-200"><a href="lookatproject.html#cb284-200"></a></span>
<span id="cb284-201"><a href="lookatproject.html#cb284-201"></a>  <span class="co">// Draw blue bunny</span></span>
<span id="cb284-202"><a href="lookatproject.html#cb284-202"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb284-203"><a href="lookatproject.html#cb284-203"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-204"><a href="lookatproject.html#cb284-204"></a>  model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(-</span><span class="fl">90.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb284-205"><a href="lookatproject.html#cb284-205"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-206"><a href="lookatproject.html#cb284-206"></a></span>
<span id="cb284-207"><a href="lookatproject.html#cb284-207"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-208"><a href="lookatproject.html#cb284-208"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb284-209"><a href="lookatproject.html#cb284-209"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb284-210"><a href="lookatproject.html#cb284-210"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb284-211"><a href="lookatproject.html#cb284-211"></a></span>
<span id="cb284-212"><a href="lookatproject.html#cb284-212"></a>  <span class="co">// Draw red bunny</span></span>
<span id="cb284-213"><a href="lookatproject.html#cb284-213"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb284-214"><a href="lookatproject.html#cb284-214"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb284-215"><a href="lookatproject.html#cb284-215"></a></span>
<span id="cb284-216"><a href="lookatproject.html#cb284-216"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb284-217"><a href="lookatproject.html#cb284-217"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.25</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.25</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb284-218"><a href="lookatproject.html#cb284-218"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb284-219"><a href="lookatproject.html#cb284-219"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb284-220"><a href="lookatproject.html#cb284-220"></a></span>
<span id="cb284-221"><a href="lookatproject.html#cb284-221"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb284-222"><a href="lookatproject.html#cb284-222"></a></span>
<span id="cb284-223"><a href="lookatproject.html#cb284-223"></a>  <span class="co">// Draw ground</span></span>
<span id="cb284-224"><a href="lookatproject.html#cb284-224"></a>  <span class="va">m_ground</span><span class="op">.</span>paint<span class="op">();</span></span>
<span id="cb284-225"><a href="lookatproject.html#cb284-225"></a></span>
<span id="cb284-226"><a href="lookatproject.html#cb284-226"></a>  abcg<span class="op">::</span>glUseProgram<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb284-227"><a href="lookatproject.html#cb284-227"></a><span class="op">}</span></span></code></pre></div>
<p>Nas linhas 173 a 176, o conteúdo das matrizes de visão e projeção é enviado às variáveis uniformes no shader:</p>
<div class="sourceCode" id="cb285" startFrom="171"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 170;"><span id="cb285-171"><a href="lookatproject.html#cb285-171"></a>  <span class="co">// Set uniform variables for viewMatrix and projMatrix</span></span>
<span id="cb285-172"><a href="lookatproject.html#cb285-172"></a>  <span class="co">// These matrices are used for every scene object</span></span>
<span id="cb285-173"><a href="lookatproject.html#cb285-173"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span>viewMatrixLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span></span>
<span id="cb285-174"><a href="lookatproject.html#cb285-174"></a>                           <span class="op">&amp;</span><span class="va">m_camera</span><span class="op">.</span><span class="va">m_viewMatrix</span><span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb285-175"><a href="lookatproject.html#cb285-175"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span>projMatrixLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span></span>
<span id="cb285-176"><a href="lookatproject.html#cb285-176"></a>                           <span class="op">&amp;</span><span class="va">m_camera</span><span class="op">.</span><span class="va">m_projMatrix</span><span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span></code></pre></div>
<p>Observe o uso da função <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glUniform.xhtml"><code>glUniformMatrix4fv</code></a>. Essa função tem a assinatura</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb286-1"><a href="lookatproject.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> glUniformMatrix4fv<span class="op">(</span>GLint location<span class="op">,</span></span>
<span id="cb286-2"><a href="lookatproject.html#cb286-2" aria-hidden="true" tabindex="-1"></a>                        GLsizei count<span class="op">,</span></span>
<span id="cb286-3"><a href="lookatproject.html#cb286-3" aria-hidden="true" tabindex="-1"></a>                        GLboolean transpose<span class="op">,</span></span>
<span id="cb286-4"><a href="lookatproject.html#cb286-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">const</span> GLfloat <span class="op">*</span>value<span class="op">);</span></span></code></pre></div>
<p>onde</p>
<ul>
<li><code>location</code> é o identificador de localização da variável uniforme no shader;</li>
<li><code>count</code> é o número de matrizes que queremos transferir à variável uniforme;</li>
<li><code>transpose</code> é um valor booleano que indica se queremos enviar a transposta da matriz;</li>
<li><code>value</code> é o ponteiro para o primeiro elemento do arranjo de elementos da matriz.</li>
</ul>
<p>A renderização do coelho branco é configurada nas linhas 181 a 189:</p>
<div class="sourceCode" id="cb287" startFrom="178"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 177;"><span id="cb287-178"><a href="lookatproject.html#cb287-178"></a>  <span class="co">// Draw white bunny</span></span>
<span id="cb287-179"><a href="lookatproject.html#cb287-179"></a>  glm<span class="op">::</span>mat4 model<span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb287-180"><a href="lookatproject.html#cb287-180"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb287-181"><a href="lookatproject.html#cb287-181"></a>  model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">90.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb287-182"><a href="lookatproject.html#cb287-182"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb287-183"><a href="lookatproject.html#cb287-183"></a></span>
<span id="cb287-184"><a href="lookatproject.html#cb287-184"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb287-185"><a href="lookatproject.html#cb287-185"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb287-186"><a href="lookatproject.html#cb287-186"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb287-187"><a href="lookatproject.html#cb287-187"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span></code></pre></div>
<p>Nas linhas 181 a 184 é criada a concatenação de transformações que forma a <strong>matriz de modelo</strong> (<code>model</code>). Para o coelho branco, essa concatenação é</p>
<p><span class="math display">\[
\mathbf{M}_{\textrm{model}}=\mathbf{I}.\mathbf{T}(-1,0,0).\mathbf{R}_y\left(\frac{\pi}{2}\right).\mathbf{S}(0.5, 0.5, 0.5).
\]</span>
Essas transformações servem para posicionar o modelo do coelho no mundo. Inicialmente o modelo está em seu quadro local, com posição e orientação definida no arquivo <code>bunny.obj</code>: na origem, sobre o plano <span class="math inline">\(y=0\)</span>, como vimos na figura <a href="glspaces.html#fig:glspace1">7.16</a>. As transformações são aplicadas da seguinte forma:</p>
<ul>
<li>Transformação de escala para reduzir o tamanho do coelho para <span class="math inline">\(50\%\)</span> de seu tamanho original (linha 184);</li>
<li>Rotação em <span class="math inline">\(90^{\circ}\)</span> em torno do eixo <span class="math inline">\(y\)</span> do espaço do objeto, que é o mesmo eixo <span class="math inline">\(y\)</span> do espaço do mundo (linha 183);</li>
<li>Translação pelo vetor <span class="math inline">\((-1,0,0)\)</span>, que posiciona o coelho em sua posição final na cena (linha 182);</li>
<li>Transformação identidade (linha 181).</li>
</ul>
<p>Na linha 186, a matriz de modelo é enviada à variável uniforme <code>m_modelMatrix</code> no vertex shader.</p>
<p>Na linha 187, a variável uniforme <code>color</code> é definida com <span class="math inline">\((1,1,1,1)\)</span> (branco) no vertex shader.</p>
<p>Na linha 188 é feita a chamada ao comando de renderização.</p>
<p>Observe como um procedimento semelhante é feito para os outros coelhos. Mudam apenas as transformações que serão usadas para criar a matriz <code>model</code>, e o valor de cor definido na variável uniforme <code>color</code>.</p>
<p>Para o coelho amarelo:</p>
<div class="sourceCode" id="cb288" startFrom="191"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 190;"><span id="cb288-191"><a href="lookatproject.html#cb288-191"></a>  <span class="co">// Draw yellow bunny</span></span>
<span id="cb288-192"><a href="lookatproject.html#cb288-192"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb288-193"><a href="lookatproject.html#cb288-193"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb288-194"><a href="lookatproject.html#cb288-194"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb288-195"><a href="lookatproject.html#cb288-195"></a></span>
<span id="cb288-196"><a href="lookatproject.html#cb288-196"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb288-197"><a href="lookatproject.html#cb288-197"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb288-198"><a href="lookatproject.html#cb288-198"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb288-199"><a href="lookatproject.html#cb288-199"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span></code></pre></div>
<p>Para o coelho azul:</p>
<div class="sourceCode" id="cb289" startFrom="201"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 200;"><span id="cb289-201"><a href="lookatproject.html#cb289-201"></a>  <span class="co">// Draw blue bunny</span></span>
<span id="cb289-202"><a href="lookatproject.html#cb289-202"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb289-203"><a href="lookatproject.html#cb289-203"></a>  model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb289-204"><a href="lookatproject.html#cb289-204"></a>  model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(-</span><span class="fl">90.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb289-205"><a href="lookatproject.html#cb289-205"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb289-206"><a href="lookatproject.html#cb289-206"></a></span>
<span id="cb289-207"><a href="lookatproject.html#cb289-207"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb289-208"><a href="lookatproject.html#cb289-208"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb289-209"><a href="lookatproject.html#cb289-209"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb289-210"><a href="lookatproject.html#cb289-210"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span></code></pre></div>
<p>Para o pequeno coelho vermelho:</p>
<div class="sourceCode" id="cb290" startFrom="212"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 211;"><span id="cb290-212"><a href="lookatproject.html#cb290-212"></a>  <span class="co">// Draw red bunny</span></span>
<span id="cb290-213"><a href="lookatproject.html#cb290-213"></a>  model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb290-214"><a href="lookatproject.html#cb290-214"></a>  model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">));</span></span>
<span id="cb290-215"><a href="lookatproject.html#cb290-215"></a></span>
<span id="cb290-216"><a href="lookatproject.html#cb290-216"></a>  abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLocation</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb290-217"><a href="lookatproject.html#cb290-217"></a>  abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLocation</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.25</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.25</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb290-218"><a href="lookatproject.html#cb290-218"></a>  abcg<span class="op">::</span>glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="va">m_indices</span><span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span></span>
<span id="cb290-219"><a href="lookatproject.html#cb290-219"></a>                       <span class="kw">nullptr</span><span class="op">);</span></span></code></pre></div>
<p>Note que todos os modelos foram renderizados com o mesmo VAO (linha 178), pois todos compartilham o mesmo VBO. É apenas a matriz de modelo que faz com que cada coelho tenha uma transformação diferente no cenário 3D.</p>
<p>Ao fim de <code>Window::onPaint</code> temos o seguinte código:</p>
<div class="sourceCode" id="cb291" startFrom="221"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 220;"><span id="cb291-221"><a href="lookatproject.html#cb291-221"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb291-222"><a href="lookatproject.html#cb291-222"></a></span>
<span id="cb291-223"><a href="lookatproject.html#cb291-223"></a>  <span class="co">// Draw ground</span></span>
<span id="cb291-224"><a href="lookatproject.html#cb291-224"></a>  <span class="va">m_ground</span><span class="op">.</span>paint<span class="op">();</span></span>
<span id="cb291-225"><a href="lookatproject.html#cb291-225"></a></span>
<span id="cb291-226"><a href="lookatproject.html#cb291-226"></a>  abcg<span class="op">::</span>glUseProgram<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div>
<p>Na linha 221, o VAO dos coelhos deixa de ser usado. Em seguida, na linha 224, o chão é desenhado. O chão tem seu próprio VAO, mas usa os mesmos shaders dos coelhos. É por isso que o programa de shader só é desabilitado na linha 226 com a chamada a <code>glUseProgram(0)</code>.</p>
<p>A definição de <code>Window::onPaintUI</code> e <code>Window::onResize</code> é dada a seguir:</p>
<div class="sourceCode" id="cb292" startFrom="229"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 228;"><span id="cb292-229"><a href="lookatproject.html#cb292-229"></a><span class="dt">void</span> Window<span class="op">::</span>onPaintUI<span class="op">()</span> <span class="op">{</span> abcg<span class="op">::</span>OpenGLWindow<span class="op">::</span>onPaintUI<span class="op">();</span> <span class="op">}</span></span>
<span id="cb292-230"><a href="lookatproject.html#cb292-230"></a></span>
<span id="cb292-231"><a href="lookatproject.html#cb292-231"></a><span class="dt">void</span> Window<span class="op">::</span>onResize<span class="op">(</span>glm<span class="op">::</span>ivec2 <span class="at">const</span> <span class="op">&amp;</span>size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb292-232"><a href="lookatproject.html#cb292-232"></a>  <span class="va">m_viewportSize</span> <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb292-233"><a href="lookatproject.html#cb292-233"></a>  <span class="va">m_camera</span><span class="op">.</span>computeProjectionMatrix<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb292-234"><a href="lookatproject.html#cb292-234"></a><span class="op">}</span></span></code></pre></div>
<p>A função <code>Camera::computeProjectioMatrix</code> é chamada dentro de <code>Window::onResize</code> para reconstruir a matriz de projeção. Os valores da matriz dependem do tamanho atual da janela.</p>
<p>A definição de <code>Window::destroy</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb293" startFrom="236"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 235;"><span id="cb293-236"><a href="lookatproject.html#cb293-236"></a><span class="dt">void</span> Window<span class="op">::</span>onDestroy<span class="op">()</span> <span class="op">{</span></span>
<span id="cb293-237"><a href="lookatproject.html#cb293-237"></a>  <span class="va">m_ground</span><span class="op">.</span>destroy<span class="op">();</span></span>
<span id="cb293-238"><a href="lookatproject.html#cb293-238"></a></span>
<span id="cb293-239"><a href="lookatproject.html#cb293-239"></a>  abcg<span class="op">::</span>glDeleteProgram<span class="op">(</span><span class="va">m_program</span><span class="op">);</span></span>
<span id="cb293-240"><a href="lookatproject.html#cb293-240"></a>  abcg<span class="op">::</span>glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_EBO</span><span class="op">);</span></span>
<span id="cb293-241"><a href="lookatproject.html#cb293-241"></a>  abcg<span class="op">::</span>glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb293-242"><a href="lookatproject.html#cb293-242"></a>  abcg<span class="op">::</span>glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb293-243"><a href="lookatproject.html#cb293-243"></a><span class="op">}</span></span></code></pre></div>
<p>Não há nada de muito novo nesse código, exceto a chamada a <code>Ground::destroy</code> para liberar o VAO e VBO do chão.</p>
<p>Finalmente, a definição de <code>Window::onUpdate</code> ficará como a seguir:</p>
<div class="sourceCode" id="cb294" startFrom="245"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 244;"><span id="cb294-245"><a href="lookatproject.html#cb294-245"></a><span class="dt">void</span> Window<span class="op">::</span>onUpdate<span class="op">()</span> <span class="op">{</span></span>
<span id="cb294-246"><a href="lookatproject.html#cb294-246"></a>  <span class="kw">auto</span> <span class="at">const</span> deltaTime<span class="op">{</span>gsl<span class="op">::</span>narrow_cast<span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;(</span>getDeltaTime<span class="op">())};</span></span>
<span id="cb294-247"><a href="lookatproject.html#cb294-247"></a></span>
<span id="cb294-248"><a href="lookatproject.html#cb294-248"></a>  <span class="co">// Update LookAt camera</span></span>
<span id="cb294-249"><a href="lookatproject.html#cb294-249"></a>  <span class="va">m_camera</span><span class="op">.</span>dolly<span class="op">(</span><span class="va">m_dollySpeed</span> <span class="op">*</span> deltaTime<span class="op">);</span></span>
<span id="cb294-250"><a href="lookatproject.html#cb294-250"></a>  <span class="va">m_camera</span><span class="op">.</span>truck<span class="op">(</span><span class="va">m_truckSpeed</span> <span class="op">*</span> deltaTime<span class="op">);</span></span>
<span id="cb294-251"><a href="lookatproject.html#cb294-251"></a>  <span class="va">m_camera</span><span class="op">.</span>pan<span class="op">(</span><span class="va">m_panSpeed</span> <span class="op">*</span> deltaTime<span class="op">);</span></span>
<span id="cb294-252"><a href="lookatproject.html#cb294-252"></a><span class="op">}</span></span></code></pre></div>
<p>Aqui, a posição e a orientação da câmera LookAt são atualizadas antes da chamada de <code>Window::onPaint</code>. As funções de movimentação da câmera são chamadas usando as variáveis de velocidade (<code>m_dollySpeed</code>, <code>m_truckSpeed</code>, <code>m_panSpeed</code>) que tiveram seus valores determinados em <code>Window::onEvent</code> de acordo com as teclas pressionadas.</p>
</div>
<div id="ground.hpp" class="section level3 unnumbered hasAnchor">
<h3>ground.hpp<a href="lookatproject.html#ground.hpp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A classe <code>Ground</code> é responsável pelo desenho do chão. Embora não seja uma classe derivada de <code>abcg::OpenGLWindow</code>, os nomes das funções são semelhantes (<code>create</code>, <code>paint</code> e <code>destroy</code>). Como vimos anteriormente, essas funções são chamadas nas respectivas funções de <code>Window</code>:</p>
<div class="sourceCode" id="cb295" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb295-1"><a href="lookatproject.html#cb295-1"></a><span class="pp">#ifndef GROUND_HPP_</span></span>
<span id="cb295-2"><a href="lookatproject.html#cb295-2"></a><span class="pp">#define GROUND_HPP_</span></span>
<span id="cb295-3"><a href="lookatproject.html#cb295-3"></a></span>
<span id="cb295-4"><a href="lookatproject.html#cb295-4"></a><span class="pp">#include </span><span class="im">&quot;abcgOpenGL.hpp&quot;</span></span>
<span id="cb295-5"><a href="lookatproject.html#cb295-5"></a></span>
<span id="cb295-6"><a href="lookatproject.html#cb295-6"></a><span class="kw">class</span> Ground <span class="op">{</span></span>
<span id="cb295-7"><a href="lookatproject.html#cb295-7"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb295-8"><a href="lookatproject.html#cb295-8"></a>  <span class="dt">void</span> create<span class="op">(</span>GLuint program<span class="op">);</span></span>
<span id="cb295-9"><a href="lookatproject.html#cb295-9"></a>  <span class="dt">void</span> paint<span class="op">();</span></span>
<span id="cb295-10"><a href="lookatproject.html#cb295-10"></a>  <span class="dt">void</span> destroy<span class="op">();</span></span>
<span id="cb295-11"><a href="lookatproject.html#cb295-11"></a></span>
<span id="cb295-12"><a href="lookatproject.html#cb295-12"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb295-13"><a href="lookatproject.html#cb295-13"></a>  GLuint <span class="va">m_VAO</span><span class="op">{};</span></span>
<span id="cb295-14"><a href="lookatproject.html#cb295-14"></a>  GLuint <span class="va">m_VBO</span><span class="op">{};</span></span>
<span id="cb295-15"><a href="lookatproject.html#cb295-15"></a></span>
<span id="cb295-16"><a href="lookatproject.html#cb295-16"></a>  GLint <span class="va">m_modelMatrixLoc</span><span class="op">{};</span></span>
<span id="cb295-17"><a href="lookatproject.html#cb295-17"></a>  GLint <span class="va">m_colorLoc</span><span class="op">{};</span></span>
<span id="cb295-18"><a href="lookatproject.html#cb295-18"></a><span class="op">};</span></span>
<span id="cb295-19"><a href="lookatproject.html#cb295-19"></a></span>
<span id="cb295-20"><a href="lookatproject.html#cb295-20"></a><span class="pp">#endif</span></span></code></pre></div>
<p><code>Ground::create</code> recebe como parâmetro o identificador de um programa de shader já existente. Assim, o chão pode usar os mesmos shaders dos coelhos.</p>
<p>Em <code>Ground::paint</code>, veremos que o chão é desenhado como um padrão de xadrez. Como é um padrão composto por quadriláteros, o VBO não precisa ser a malha geométrica do chão inteiro, mas apenas um quadrilátero de tamanho unitário. Esse quadrilátero será desenhado várias vezes para formar um ladrilho com padrão de xadrez.</p>
</div>
<div id="ground.cpp" class="section level3 unnumbered hasAnchor">
<h3>ground.cpp<a href="lookatproject.html#ground.cpp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Vamos começar com a definição de <code>Ground::create</code>:</p>
<div class="sourceCode" id="cb296" startFrom="1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb296-1"><a href="lookatproject.html#cb296-1"></a><span class="pp">#include </span><span class="im">&quot;ground.hpp&quot;</span></span>
<span id="cb296-2"><a href="lookatproject.html#cb296-2"></a></span>
<span id="cb296-3"><a href="lookatproject.html#cb296-3"></a><span class="dt">void</span> Ground<span class="op">::</span>create<span class="op">(</span>GLuint program<span class="op">)</span> <span class="op">{</span></span>
<span id="cb296-4"><a href="lookatproject.html#cb296-4"></a>  <span class="co">// Unit quad on the xz plane</span></span>
<span id="cb296-5"><a href="lookatproject.html#cb296-5"></a>  <span class="bu">std::</span>array<span class="op">&lt;</span>glm<span class="op">::</span>vec3<span class="op">,</span> <span class="dv">4</span><span class="op">&gt;</span> vertices<span class="op">{{{-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">+</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">},</span></span>
<span id="cb296-6"><a href="lookatproject.html#cb296-6"></a>                                     <span class="op">{-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">},</span></span>
<span id="cb296-7"><a href="lookatproject.html#cb296-7"></a>                                     <span class="op">{+</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">+</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">},</span></span>
<span id="cb296-8"><a href="lookatproject.html#cb296-8"></a>                                     <span class="op">{+</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">}}};</span></span>
<span id="cb296-9"><a href="lookatproject.html#cb296-9"></a></span>
<span id="cb296-10"><a href="lookatproject.html#cb296-10"></a>  <span class="co">// Generate VBO</span></span>
<span id="cb296-11"><a href="lookatproject.html#cb296-11"></a>  abcg<span class="op">::</span>glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb296-12"><a href="lookatproject.html#cb296-12"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb296-13"><a href="lookatproject.html#cb296-13"></a>  abcg<span class="op">::</span>glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">.</span>data<span class="op">(),</span></span>
<span id="cb296-14"><a href="lookatproject.html#cb296-14"></a>                     GL_STATIC_DRAW<span class="op">);</span></span>
<span id="cb296-15"><a href="lookatproject.html#cb296-15"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb296-16"><a href="lookatproject.html#cb296-16"></a></span>
<span id="cb296-17"><a href="lookatproject.html#cb296-17"></a>  <span class="co">// Create VAO and bind vertex attributes</span></span>
<span id="cb296-18"><a href="lookatproject.html#cb296-18"></a>  abcg<span class="op">::</span>glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb296-19"><a href="lookatproject.html#cb296-19"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb296-20"><a href="lookatproject.html#cb296-20"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb296-21"><a href="lookatproject.html#cb296-21"></a>  <span class="kw">auto</span> <span class="at">const</span> positionAttribute<span class="op">{</span></span>
<span id="cb296-22"><a href="lookatproject.html#cb296-22"></a>      abcg<span class="op">::</span>glGetAttribLocation<span class="op">(</span>program<span class="op">,</span> <span class="st">&quot;inPosition&quot;</span><span class="op">)};</span></span>
<span id="cb296-23"><a href="lookatproject.html#cb296-23"></a>  abcg<span class="op">::</span>glEnableVertexAttribArray<span class="op">(</span>positionAttribute<span class="op">);</span></span>
<span id="cb296-24"><a href="lookatproject.html#cb296-24"></a>  abcg<span class="op">::</span>glVertexAttribPointer<span class="op">(</span>positionAttribute<span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb296-25"><a href="lookatproject.html#cb296-25"></a>                              <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb296-26"><a href="lookatproject.html#cb296-26"></a>  abcg<span class="op">::</span>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb296-27"><a href="lookatproject.html#cb296-27"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb296-28"><a href="lookatproject.html#cb296-28"></a></span>
<span id="cb296-29"><a href="lookatproject.html#cb296-29"></a>  <span class="co">// Save location of uniform variables</span></span>
<span id="cb296-30"><a href="lookatproject.html#cb296-30"></a>  <span class="va">m_modelMatrixLoc</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span>program<span class="op">,</span> <span class="st">&quot;modelMatrix&quot;</span><span class="op">);</span></span>
<span id="cb296-31"><a href="lookatproject.html#cb296-31"></a>  <span class="va">m_colorLoc</span> <span class="op">=</span> abcg<span class="op">::</span>glGetUniformLocation<span class="op">(</span>program<span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">);</span></span>
<span id="cb296-32"><a href="lookatproject.html#cb296-32"></a><span class="op">}</span></span></code></pre></div>
<p>No início da função, definimos os vértices de um quadrilátero de tamanho unitário centralizado no plano <span class="math inline">\(xz\)</span>. Em seguida, criamos o VBO e fazemos a ligação do VBO com o atributo <code>inPosition</code> do shader <code>program</code>. Por fim, salvamos a localização das variáveis uniformes que serão utilizadas em <code>Ground::paint</code>.</p>
<p>A propósito, eis o código de <code>Ground::paint</code>:</p>
<div class="sourceCode" id="cb297" startFrom="34"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 33;"><span id="cb297-34"><a href="lookatproject.html#cb297-34"></a><span class="dt">void</span> Ground<span class="op">::</span>paint<span class="op">()</span> <span class="op">{</span></span>
<span id="cb297-35"><a href="lookatproject.html#cb297-35"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb297-36"><a href="lookatproject.html#cb297-36"></a></span>
<span id="cb297-37"><a href="lookatproject.html#cb297-37"></a>  <span class="co">// Draw a grid of 2N+1 x 2N+1 tiles on the xz plane, centered around the</span></span>
<span id="cb297-38"><a href="lookatproject.html#cb297-38"></a>  <span class="co">// origin</span></span>
<span id="cb297-39"><a href="lookatproject.html#cb297-39"></a>  <span class="kw">auto</span> <span class="at">const</span> N<span class="op">{</span><span class="dv">5</span><span class="op">};</span></span>
<span id="cb297-40"><a href="lookatproject.html#cb297-40"></a>  <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span> z <span class="op">:</span> iter<span class="op">::</span>range<span class="op">(-</span>N<span class="op">,</span> N <span class="op">+</span> <span class="dv">1</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb297-41"><a href="lookatproject.html#cb297-41"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> <span class="at">const</span> x <span class="op">:</span> iter<span class="op">::</span>range<span class="op">(-</span>N<span class="op">,</span> N <span class="op">+</span> <span class="dv">1</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb297-42"><a href="lookatproject.html#cb297-42"></a>      <span class="co">// Set model matrix as a translation matrix</span></span>
<span id="cb297-43"><a href="lookatproject.html#cb297-43"></a>      glm<span class="op">::</span>mat4 model<span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb297-44"><a href="lookatproject.html#cb297-44"></a>      model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span>x<span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> z<span class="op">));</span></span>
<span id="cb297-45"><a href="lookatproject.html#cb297-45"></a>      abcg<span class="op">::</span>glUniformMatrix4fv<span class="op">(</span><span class="va">m_modelMatrixLoc</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>model<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb297-46"><a href="lookatproject.html#cb297-46"></a></span>
<span id="cb297-47"><a href="lookatproject.html#cb297-47"></a>      <span class="co">// Set color (checkerboard pattern)</span></span>
<span id="cb297-48"><a href="lookatproject.html#cb297-48"></a>      <span class="kw">auto</span> <span class="at">const</span> gray<span class="op">{(</span>z <span class="op">+</span> x<span class="op">)</span> <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">1.0</span><span class="bu">f</span> <span class="op">:</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb297-49"><a href="lookatproject.html#cb297-49"></a>      abcg<span class="op">::</span>glUniform4f<span class="op">(</span><span class="va">m_colorLoc</span><span class="op">,</span> gray<span class="op">,</span> gray<span class="op">,</span> gray<span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb297-50"><a href="lookatproject.html#cb297-50"></a></span>
<span id="cb297-51"><a href="lookatproject.html#cb297-51"></a>      abcg<span class="op">::</span>glDrawArrays<span class="op">(</span>GL_TRIANGLE_STRIP<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb297-52"><a href="lookatproject.html#cb297-52"></a>    <span class="op">}</span></span>
<span id="cb297-53"><a href="lookatproject.html#cb297-53"></a>  <span class="op">}</span></span>
<span id="cb297-54"><a href="lookatproject.html#cb297-54"></a></span>
<span id="cb297-55"><a href="lookatproject.html#cb297-55"></a>  abcg<span class="op">::</span>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb297-56"><a href="lookatproject.html#cb297-56"></a><span class="op">}</span></span></code></pre></div>
<p>Aqui, desenhamos uma grade de 11x11 quadriláteros (variando <span class="math inline">\(z\)</span> e <span class="math inline">\(x\)</span> de -5 a 5). Cada quadrilátero é transladado através de uma matriz de modelo e então desenhado com <code>glDrawArrays</code> usando a primitiva <code>GL_TRIANGLE_STRIP</code>. A cor utilizada – configurada pela variável uniforme do shader – é modificada de acordo com a paridade das coordenadas da grade de modo a formar o padrão de xadrez.</p>
<p>Em <code>Ground::destroy</code>, o VBO e o VAO são liberados:</p>
<div class="sourceCode" id="cb298" startFrom="58"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 57;"><span id="cb298-58"><a href="lookatproject.html#cb298-58"></a><span class="dt">void</span> Ground<span class="op">::</span>destroy<span class="op">()</span> <span class="op">{</span></span>
<span id="cb298-59"><a href="lookatproject.html#cb298-59"></a>  abcg<span class="op">::</span>glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VBO</span><span class="op">);</span></span>
<span id="cb298-60"><a href="lookatproject.html#cb298-60"></a>  abcg<span class="op">::</span>glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span><span class="va">m_VAO</span><span class="op">);</span></span>
<span id="cb298-61"><a href="lookatproject.html#cb298-61"></a><span class="op">}</span></span></code></pre></div>
<p>Como o programa de shader é o mesmo dos coelhos, o responsável pela liberação dos shaders é <code>Window</code>, como já vimos em <code>Window::onDestroy</code>.</p>
<p>Isso conclui o projeto <code>lookat</code>. Baixe o código completo a partir <a href="https://hbatagelo.github.io/abcgapps/src/lookat.zip">deste link</a>.</p>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="lookat.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referências.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toc_float": true,
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
